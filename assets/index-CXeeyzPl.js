(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}})();const St="vite-refactor/6.1.0",wt="https://your-make-webhook-url.com/your-unique-path",he="marnthara.input.v6.1",qt=500,J={name:"‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ‡∏Ç‡∏ß‡∏±‡∏ç‡∏§‡∏î‡∏µ",address:"‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 257 ‡∏°.6 ‡∏ï.‡∏´‡∏ô‡∏≠‡∏á‡πÇ‡∏û‡∏£‡∏á ‡∏≠.‡∏®‡∏£‡∏µ‡∏°‡∏´‡∏≤‡πÇ‡∏û‡∏ò‡∏¥ ‡∏à.‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ 25140",phone:"‡πÇ‡∏ó‡∏£ 087-985-3832 (‡∏®‡∏¥‡∏£‡∏¥‡∏Ç‡∏ß‡∏±‡∏ç ‡∏ô‡∏≤‡∏Ñ‡∏∞‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)",taxId:"1250100194164",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏∑‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},$t=1.19599,kt={ROLL_WIDTH_M:.53},ye={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200,2300,2400,2500,2600,2700,2800,2900,3e3],sheer:[1e3,1100,1200,1300,1400,1500],louis:[2200,2300,2400,2500,2600,2700,2800,2900,3e3,3100,3200,3300,3400,3500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö:0,‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},H={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},m={orderForm:"#orderForm",roomsContainer:"#rooms",toastContainer:"#toast-container",printableContent:"#printable-content",filterStatusBar:"#filterStatusBar",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",undoBtn:"#undoBtn",themeToggleBtn:"#themeToggleBtn",overviewBtn:"#overviewBtn",copyTextBtn:"#copyTextBtn",visualReportsBtn:"#visualReportsBtn",exportPdfBtn:"#exportPdfBtn",submitBtn:"#submitBtn",importBtn:"#importBtn",exportBtn:"#exportBtn",importFavsBtn:"#importFavsBtn",exportFavsBtn:"#exportFavsBtn",clearItemsBtn:"#clearItemsBtn",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",quickNavBtnText:"#quickNavBtnText",toggleAllRoomsBtn:"#toggleAllRoomsBtn",suspendedItemsBtn:"#suspendedItemsBtn",suspendedCountBadge:"#suspendedCountBadge",originalTotal:"#originalTotal",grandTotal:"#grandTotal",fileImporter:"#fileImporter",favImporter:"#favImporter",customerCard:"#customerDetailsCard",customerNameInput:"#customer_name",customerPhoneInput:"#customer_phone",customerAddressInput:"#customer_address",room:".room-card",roomTpl:"#roomTpl",roomNameInput:'input[name="room_name"]',roomNameDisplay:"[data-room-name-display]",roomBrief:"[data-room-brief]",allItemsContainer:"[data-all-items]",roomDefaultsBtn:'[data-act="open-room-defaults"]',itemCard:".item-card",itemDetailsMore:".item-details-more",itemGrid:".item-grid",itemTitle:"[data-item-title]",toggleDetailsBtn:'[data-act="toggle-more-details"]',setTpl:"#setTpl",setWidthInput:'input[name="width_m"]',setHeightInput:'input[name="height_m"]',setStyleSelect:'select[name="set_style"]',setFabricVariantSelect:'select[name="fabric_variant"]',setPricePerMSelect:'select[name="set_price_per_m"]',setSheerPricePerMSelect:'select[name="sheer_price_per_m"]',setLouisPricePerMSelect:'select[name="louis_price_per_m"]',setFabricCodeInput:'input[name="fabric_code"]',setSheerCodeInput:'input[name="sheer_fabric_code"]',setOpeningStyleSelect:'select[name="opening_style"]',setAdjustmentSideSelect:'select[name="adjustment_side"]',setTrackColorInput:'input[name="track_color"]',setBracketColorInput:'input[name="bracket_color"]',setFinialColorInput:'input[name="finial_color"]',setGrommetColorInput:'input[name="grommet_color"]',setLouisValanceInput:'input[name="louis_valance"]',setLouisTasselsInput:'input[name="louis_tassels"]',setNotesInput:'input[name="notes"]',wallpaperTpl:"#wallpaperTpl",wallTpl:"#wallTpl",wallHeightInput:'[name="wallpaper_height_m"]',wallCodeInput:'[name="wallpaper_code"]',wallPriceRollInput:'[name="wallpaper_price_roll"]',wallInstallCostInput:'[name="wallpaper_install_cost"]',wallNotesInput:'[name="wallpaper_notes"]',wallWidthInput:'[name="wall_width_m"]',areaBasedTpl:"#areaBasedTpl",areaBasedItem:".area-based-item",areaWidthInput:'[name="area_width_m"]',areaHeightInput:'[name="area_height_m"]',areaPriceSqydInput:'[name="area_price_sqyd"]',areaCodeInput:'[name="area_code"]',areaNotesInput:'[name="area_notes"]',modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",discountModal:"#discountModal",discountSubtotal:"#discountSubtotal",discountPercent:"#discountPercent",discountAmount:"#discountAmount",discountFinalTotal:"#discountFinalTotal",discountTypeInput:"#discount_type",discountValueInput:"#discount_value",copyOptionsModal:"#copyOptionsModal",visualReportsModal:"#visualReportsModal",lookbookModal:"#lookbookModal",lookbookModalBody:"#lookbookModalBody",exportOptionsModal:"#exportOptionsModal",pdfOptionsModal:"#pdfOptionsModal",exportPdfWithDetailsBtn:"#exportPdfWithDetailsBtn",exportPdfWithoutDetailsBtn:"#exportPdfWithoutDetailsBtn",itemTypeModal:"#itemTypeModal",itemTypeModalTitle:"#itemTypeModalTitle",hardwareModal:"#hardwareModal",modalTrackColor:'[name="modal_track_color"]',modalBracketColor:'[name="modal_bracket_color"]',modalFinialColor:'[name="modal_finial_color"]',modalGrommetColor:'[name="modal_grommet_color"]',modalLouisValance:'[name="modal_louis_valance"]',modalLouisTassels:'[name="modal_louis_tassels"]',trackColorGroup:"#trackColorGroup",bracketColorGroup:"#bracketColorGroup",finialColorGroup:"#finialColorGroup",grommetColorGroup:"#grommetColorGroup",louisValanceGroup:"#louisValanceGroup",louisTasselGroup:"#louisTasselGroup",hardwareApplyToRoomBtn:"#hardwareApplyToRoom",favoritesConflictModal:"#favoritesConflictModal",favoritesModal:"#favoritesModal",favoritesModalTitle:"#favoritesModalTitle",favoritesModalBody:"#favoritesModalBody",favSearchInput:"#favSearchInput",favSelectorItemTpl:"#favSelectorItemTpl",favInput:"input[data-favorite-type]",favManagerModal:"#favManagerModal",favManagerTitle:"#favManagerTitle",favManagerBody:"#favManagerBody",favManagerItemTpl:"#favManagerItemTpl",favManagerEditBtn:'#favManagerModal [data-act="edit-selected-fav"]',favManagerDelBtn:'#favManagerModal [data-act="del-selected-fav"]',favAddModal:"#favAddModal",favAddCodeInput:'[name="fav_code_add"]',favAddPriceInput:'[name="fav_price_add"]',favEditModal:"#favEditModal",favEditCodeInput:'[name="fav_code_edit"]',favEditPriceInput:'[name="fav_price_edit"]',roomDefaultsModal:"#roomDefaultsModal",roomDefaultsForm:"#roomDefaultsForm",roomDefaultsApplyBtn:"#roomDefaultsApplyBtn",roomDefaultsConfirmBtn:"#roomDefaultsConfirmBtn",roomDefaultsCancelBtn:"#roomDefaultsCancelBtn",overviewModal:"#overviewModal",overviewModalHeader:"#overviewModalHeader",overviewModalBody:"#overviewModalBody"},_=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const r=parseFloat(e);return Number.isFinite(r)?r:0},Y=e=>{const r=_(e);return r>0?r.toFixed(2):""},We=e=>{const r=e.target,l=r.value.trim();if(l===""){r.value="";return}let o=_(l);if(o<=0){r.value="";return}l.includes(".")||(o=o/100),r.value=Y(o)},ee=(e,r=2,l=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:l?2:r,maximumFractionDigits:l?2:r}):"0",A=(e,r=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:r,maximumFractionDigits:r}):"0",ve=(e,r=150)=>{let l;return(...o)=>{clearTimeout(l),l=setTimeout(()=>e(...o),r)}},xt=(e,r=200)=>{let l=0,o;return(...t)=>{const n=new Date().getTime();o&&(clearTimeout(o),o=null),n-l>=r?(l=n,e(...t)):o=setTimeout(()=>{l=new Date().getTime(),e(...t),o=null},r-(n-l))}},I=e=>e?e.replace(/[<>"'&]/g,r=>{switch(r){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;";default:return r}}):"",at=e=>e?e.replace(/[<>:"/\\|?*]/g,"").replace(/[\s\n\t]+/g,"_").substring(0,100):"file";function Mt(e){if(e=_(e),e===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";if(e<0||e>99999999999999e-2)return"N/A";const r=["‡∏®‡∏π‡∏ô‡∏¢‡πå","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤","‡∏™‡∏¥‡∏ö"],l=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];e=parseFloat(e.toFixed(2));let o=Math.floor(e),t=Math.round((e-o)*100);const n=s=>{if(s===0)return"";let c="";const d=String(s);for(let i=0;i<d.length;i++){const f=d[i],u=d.length-i-1;f!=="0"&&(u===1&&f==="1"?c+=l[u]:u===1&&f==="2"?c+="‡∏¢‡∏µ‡πà"+l[u]:u===0&&f==="1"&&d.length>1?c+="‡πÄ‡∏≠‡πá‡∏î":c+=r[parseInt(f)]+l[u])}return c};let a="";if(o>0){const s=Math.floor(o/1e6),c=o%1e6;s>0&&(a+=n(s)+"‡∏•‡πâ‡∏≤‡∏ô"),a+=n(c),a+="‡∏ö‡∏≤‡∏ó"}else a="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó";return t===0?a+="‡∏ñ‡πâ‡∏ß‡∏ô":a+=n(t)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå",a}const Ve="marnthara.favorites.v4",_e={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function le(){try{const e=localStorage.getItem(Ve);return e?{..._e,...JSON.parse(e)}:_e}catch(e){return console.error("Failed to parse favorites from localStorage",e),_e}}function Ie(e){try{localStorage.setItem(Ve,JSON.stringify(e))}catch(r){console.error("Failed to save favorites to localStorage",r)}}function Je(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const r={..._e,...e};return Ie(r),!0}function Re(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for merge."),0;const r=le();let l=0;for(const o in e)Object.hasOwnProperty.call(e,o)&&Array.isArray(e[o])&&(r[o]||(r[o]=[]),e[o].forEach(t=>{t&&t.code&&t.hasOwnProperty("price")?r[o].some(a=>a.code===t.code)||(r[o].push({code:t.code,price:t.price}),l++):console.warn(`Skipping invalid favorite item during merge for type ${o}:`,t)}),r[o].sort((t,n)=>t.code.localeCompare(n.code)));return l>0&&Ie(r),l}function Ye(e,r,l){const o=le(),t=r?.trim();if(!t)return console.error(`Attempted to add favorite with empty code for type: ${e}`),!1;if(typeof l!="number"||isNaN(l)||l<0)return console.error(`Attempted to add favorite with invalid price (${l}) for code ${t}`),!1;if(!Object.hasOwnProperty.call(_e,e))return console.error(`Attempted to add favorite to an invalid type: ${e}`),!1;o[e]||(o[e]=[]);const n=o[e],a=n.find(s=>s.code===t);return a?a.price=l:n.push({code:t,price:l}),n.sort((s,c)=>s.code.localeCompare(c.code)),Ie(o),!0}function Qe(e,r){const l=le(),o=r?.trim();if(!l[e]||!o)return!1;const t=l[e].findIndex(n=>n.code===o);return t>-1?(l[e].splice(t,1),Ie(l),!0):!1}function It(){localStorage.removeItem(Ve),console.log("All favorites have been cleared.")}function W(){const e=le(),r={app_version:St,customer_name:document.querySelector(m.customerNameInput)?.value||"",customer_phone:document.querySelector(m.customerPhoneInput)?.value||"",customer_address:document.querySelector(m.customerAddressInput)?.value||"",customer_card_open:document.querySelector(m.customerCard)?.open,discount:{type:document.querySelector(m.discountTypeInput)?.value||"amount",value:_(document.querySelector(m.discountValueInput)?.value)},rooms:[],favorites:e};return document.querySelectorAll(m.room).forEach(l=>{const o={id:l.id,room_name:l.querySelector(m.roomNameInput)?.value||"",is_suspended:l.classList.contains("is-suspended"),is_open:l.open,room_defaults:JSON.parse(l.dataset.roomDefaults||"{}"),items:[]};l.querySelector(m.allItemsContainer)?.childNodes.forEach(t=>{if(t.nodeType!==1||!t.matches(m.itemCard))return;if(t.classList.contains("placeholder-item")){const s={type:"placeholder",is_suspended:t.classList.contains("is-suspended"),width_m:_(t.dataset.widthM),height_m:_(t.dataset.heightM)};o.items.push(s);return}const n=t.dataset.type;if(!n)return;let a={type:n,is_suspended:t.classList.contains("is-suspended")};if(n==="set")Object.assign(a,{width_m:_(t.querySelector(m.setWidthInput)?.value),height_m:_(t.querySelector(m.setHeightInput)?.value),style:t.querySelector(m.setStyleSelect)?.value||"",fabric_variant:t.querySelector(m.setFabricVariantSelect)?.value||"",price_per_m_raw:_(t.querySelector(m.setPricePerMSelect)?.value),sheer_price_per_m:_(t.querySelector(m.setSheerPricePerMSelect)?.value),louis_price_per_m:_(t.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:t.querySelector(m.setFabricCodeInput)?.value||"",sheer_fabric_code:t.querySelector(m.setSheerCodeInput)?.value||"",opening_style:t.querySelector(m.setOpeningStyleSelect)?.value||"",adjustment_side:t.querySelector(m.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:t.querySelector(m.setTrackColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:t.querySelector(m.setBracketColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:t.querySelector(m.setFinialColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:t.querySelector(m.setGrommetColorInput)?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:t.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:t.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:t.querySelector(m.setNotesInput)?.value||""});else if(n==="wallpaper"){const s=t.querySelector(m.wallInstallCostInput),c=s?s.value:"";let d;c==="0"?d=0:_(c)>0?d=_(c):d=void 0,Object.assign(a,{height_m:_(t.querySelector(m.wallHeightInput)?.value),wallpaper_code:t.querySelector(m.wallCodeInput)?.value||"",price_per_roll:_(t.querySelector(m.wallPriceRollInput)?.value),install_cost_per_roll:d,notes:t.querySelector(m.wallNotesInput)?.value||"",widths:Array.from(t.querySelectorAll(m.wallWidthInput)).map(i=>_(i.value))})}else t.matches(m.areaBasedItem)&&(Object.assign(a,{width_m:_(t.querySelector(m.areaWidthInput)?.value),height_m:_(t.querySelector(m.areaHeightInput)?.value),price_sqyd:_(t.querySelector(m.areaPriceSqydInput)?.value),code:t.querySelector(m.areaCodeInput)?.value||"",notes:t.querySelector(m.areaNotesInput)?.value||""}),(n==="partition"||n==="pleated_screen")&&(a.opening_style=t.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(n)&&(a.adjustment_side=t.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));o.items.push(a)}),r.rooms.push(o)}),r}function X(){try{const e=W();localStorage.setItem(he,JSON.stringify(e))}catch(e){console.error("Failed to save data to localStorage:",e)}}const ie=[],Tt=10;function re(e){if(!e){console.warn("Attempted to push invalid state to undo stack.");return}try{const r=JSON.parse(JSON.stringify(e));ie.push(r),ie.length>Tt&&ie.shift()}catch(r){console.error("Failed to clone state for undo history:",r)}}function Lt(){if(ie.length!==0)return ie.pop()}function Ct(){return ie.length>0}const P={stylePlus:e=>ye.style_surcharge[e]??0,heightPlus:e=>{const r=[...ye.height].sort((l,o)=>o.threshold-l.threshold);for(const l of r)if(e>l.threshold)return l.add_per_m;return 0},fabricYardage:(e,r)=>{const l=_(r);if(l<=0)return 0;let o=0,t=0;switch(e){case"‡∏•‡∏≠‡∏ô":case"‡∏ï‡∏≤‡πÑ‡∏Å‡πà":case"‡∏à‡∏µ‡∏ö":case"‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":o=(l+.3)*2/.9;break;case"‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö":t=1.2;break;case"‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö":t=0;break}return t>0?l*t*1.09361:o},calculateGrommets:e=>{const r=_(e.width_m);if(r<=0||e.style!=="‡∏ï‡∏≤‡πÑ‡∏Å‡πà")return 0;const l=r*2.5;let t=Math.ceil(l*100/12);return t%2!==0&&t++,t=Math.max(t,Math.ceil(r*4)*2),t},_calculateComponentPrice:e=>{const r=_(e.width),l=_(e.height),o=_(e.price_per_m);if(r<=0||l<=0||o<=0)return 0;if(e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"){const d=r*o;return Math.round(d/10)*10}const t=P.stylePlus(e.style),n=P.heightPlus(l),a=o,s=t+n,c=(a+s)*r;return Math.round(c/10)*10},calculateSetPrice:function(e){if(!e||e.is_suspended)return{total:0,opaque:0,sheer:0,louis:0};const l=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",o=e.style||"‡∏•‡∏≠‡∏ô",t=_(e.width_m),n=_(e.height_m);let a=0,s=0,c=0;if(o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const f=_(e.louis_price_per_m);t>0&&f>0&&(c=f*t,c=Math.round(c/10)*10),l.includes("‡∏ó‡∏∂‡∏ö")&&(a=this._calculateComponentPrice({style:o,width:t,height:n,price_per_m:e.price_per_m_raw})),l.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(s=this._calculateComponentPrice({style:o,width:t,height:n,price_per_m:e.sheer_price_per_m}))}else l.includes("‡∏ó‡∏∂‡∏ö")&&(a=this._calculateComponentPrice({style:o,width:t,height:n,price_per_m:e.price_per_m_raw})),l.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(s=this._calculateComponentPrice({style:o,width:t,height:n,price_per_m:e.sheer_price_per_m}));const d=a+s+c;let i=d;return d>0&&d<1200&&(i=1200),{total:i,opaque:a,sheer:s,louis:c}},wallpaperRolls:(e,r)=>{if(e<=0||r<=0)return 0;const{ROLL_WIDTH_M:l}=kt,o=Math.ceil(e/l);let t;return r<=2.5?t=3:r<=3.3?t=2:t=1,Math.ceil(o/t)},calculateAreaBasedPrice:function(e){if(!e||e.is_suspended)return{total:0,sqm:0,sqyd:0};const r=_(e.width_m),l=_(e.height_m),o=_(e.price_sqyd);if(r<=0||l<=0||o<=0)return{total:0,sqm:0,sqyd:0};const t=r*l;let n=t*$t;n<1?n=1:n=Math.ceil(n*2)/2;const a=n*o;return{total:Math.round(a),sqm:t,sqyd:n}},calculateWallpaperPrice:function(e){if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const r=e.widths?.reduce((c,d)=>c+_(d),0)||0;if(r<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const l=_(e.height_m),o=this.wallpaperRolls(r,l),t=o*_(e.price_per_roll);let n=300;const a=e.install_cost_per_roll;a===0?n=0:typeof a=="number"&&a>0?n=a:_(a)>0&&(n=_(a));const s=o*n;return{total:Math.round(t+s),material:Math.round(t),install:Math.round(s),rolls:o,sqm:r*l}}},G=Object.entries(H).reduce((e,[r,l])=>(e[r]=l.name,e),{});G.set_louis="‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå";function se(e){const{width:r=0,height:l=0}=e,o=15,t=100-o*2,n=100-o*2,a=r>0&&l>0?Math.min(t/r,n/l):1,s=r*a,c=l*a,d=(100-s)/2,i=(100-c)/2,f=`
        <line x1="${d}" y1="${i+c+5}" x2="${d+s}" y2="${i+c+5}" class="dimension-line" />
        <line x1="${d}" y1="${i+c+3}" x2="${d}" y2="${i+c+7}" class="dimension-tick" />
        <line x1="${d+s}" y1="${i+c+3}" x2="${d+s}" y2="${i+c+7}" class="dimension-tick" />
        <text x="50" y="${i+c+14}" class="dimension-text">${r.toFixed(2)} ‡∏°.</text>

        <line x1="${d-5}" y1="${i}" x2="${d-5}" y2="${i+c}" class="dimension-line" />
        <line x1="${d-7}" y1="${i}" x2="${d-3}" y2="${i}" class="dimension-tick" />
        <line x1="${d-7}" y1="${i+c}" x2="${d-3}" y2="${i+c}" class="dimension-tick" />
        <text x="${d-9}" y="50" class="dimension-text" transform="rotate(-90, ${d-9}, 50)">${l.toFixed(2)} ‡∏°.</text>
    `;return{x:d,y:i,svgWidth:s,svgHeight:c,lines:f}}function rt(e,{y:r,svgHeight:l}){if(!e.opening_style||e.opening_style==="‡∏™‡πÑ‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß"||e.type==="set"&&e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö")return"";const o=e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?"< >":"‚Üí";return`
        <rect x="40" y="${r+l/2-8}" width="20" height="16" rx="3" class="opening-text-bg" />
        <text x="50" y="${r+l/2+1}" class="opening-text">${o}</text>
    `}function Te(e,{x:r,y:l,svgWidth:o}){if(!e.adjustment_side)return"";const n=e.adjustment_side==="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢"?r+8:r+o-8;return`
        <g class="adjustment-cord">
            <circle cx="${n}" cy="${l+3}" r="2"/>
            <line x1="${n}" y1="${l+5}" x2="${n}" y2="${l+15}"/>
        </g>
    `}function Bt(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),i=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),f=(g,y)=>(e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?`
                <rect x="${o}" y="${t+y}" width="${n/2-1}" height="${a}" class="${g}" />
                <rect x="${o+n/2+1}" y="${t+y}" width="${n/2-1}" height="${a}" class="${g}" />
            `:`<rect x="${o}" y="${t+y}" width="${n}" height="${a}" class="${g}" />`;d&&(c+=f("curtain-panel-sheer",0)),i&&(c+=f("curtain-panel-opaque",d?-2:0));let u="";if(e.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const g=P.calculateGrommets(e)/((e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?2:1),y=Math.min(Math.floor(g),Math.max(8,Math.floor(n/8)));for(let h=0;h<y;h++){const S=o+n/(y>1?y-1:1)*h;u+=`<circle cx="${S}" cy="${t+2}" r="2" class="style-grommet" />`}}else if(e.style==="‡∏•‡∏≠‡∏ô"){const g=Math.max(4,Math.floor(n/10));let y=`M ${o},${t}`;for(let h=0;h<g;h++)y+=" q 5,-4 10,0";u=`<path d="${y}" class="style-ripplefold-path" />`}else e.style==="‡∏à‡∏µ‡∏ö"&&(u=`<text x="${o+2}" y="${t+5}" class="style-pleat-text">||| ||| ||| ||| |||</text>`);const p=rt(e,{y:t,svgHeight:a});return`<svg viewBox="0 0 100 100">${c}${u}${p}${s}</svg>`}function At(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),i=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),f=(h,S)=>`
        <rect x="${o}" y="${t+S}" width="${n/2-1}" height="${a}" class="${h}" />
        <rect x="${o+n/2+1}" y="${t+S}" width="${n/2-1}" height="${a}" class="${h}" />
    `;d&&(c+=f("curtain-panel-sheer",0)),i&&(c+=f("curtain-panel-opaque",d?-2:0));const u=Math.max(3,Math.floor(n/15)),p=n/u;let g="";for(let h=0;h<u;h++){const S=o+h*p;g+=`<path d="M ${S},${t} Q ${S+p/2},${t+10} ${S+p},${t}" class="louis-swag" />`}g+=`
        <polygon points="${o},${t} ${o+8},${t} ${o},${t+15}" class="louis-tail" />
        <polygon points="${o+n},${t} ${o+n-8},${t} ${o+n},${t+15}" class="louis-tail" />
    `;let y="";if(e.louis_tassels&&e.louis_tassels!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"){y+=`<circle cx="${o+5}" cy="${t+18}" r="2" class="louis-tassel" />`,y+=`<circle cx="${o+n-5}" cy="${t+18}" r="2" class="louis-tassel" />`;for(let h=1;h<u;h++)y+=`<circle cx="${o+h*p}" cy="${t+8}" r="2" class="louis-tassel" />`}return`<svg viewBox="0 0 100 100">${c}${g}${y}${s}</svg>`}function Et(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c=`<rect x="${o}" y="${t}" width="${n}" height="${a}" class="blind-frame" />`;const d=5,i=a/d;for(let u=0;u<d;u++)c+=`<rect x="${o+1}" y="${t+u*i}" width="${n-2}" height="${i-1.5}" class="blind-slat" />`;const f=Te(e,{x:o,y:t,svgWidth:n});return`<svg viewBox="0 0 100 100">${c}${s}${f}</svg>`}function Pt(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),f=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?"curtain-panel-opaque":d?"curtain-panel-sheer":"blind-slat";c+=`<rect x="${o}" y="${t}" width="${n}" height="${a}" class="${f}" />`;const u=3;c+=`<line x1="${o}" y1="${t+u/2}" x2="${o+n}" y2="${t+u/2}" class="style-pleat-line" stroke-width="0.8"/>`,c+=`<line x1="${o}" y1="${t+u}" x2="${o+n}" y2="${t+u}" class="style-pleat-line"/>`,c+=`<line x1="${o}" y1="${t+a-u}" x2="${o+n}" y2="${t+a-u}" class="style-pleat-line"/>`,c+=`<line x1="${o}" y1="${t+a-u/2}" x2="${o+n}" y2="${t+a-u/2}" class="style-pleat-line" stroke-width="0.8"/>`;const p=Math.max(8,Math.floor(n/4));for(let h=1;h<p;h++){const S=o+n/p*h;c+=`<line x1="${S}" y1="${t+u}" x2="${S}" y2="${t+a-u}" class="style-pleat-line" opacity="0.5"/>`}const g=t+a*.5,y=8;return c+=`<rect x="${o+n*.1}" y="${g-y/2}" width="${n*.8}" height="${y}" rx="2" class="blind-slat" filter="brightness(0.95)" />`,c+=`<rect x="${o+n*.12}" y="${g-y/2+1.5}" width="${n*.76}" height="${y-3}" rx="1" class="blind-frame" opacity="0.3" />`,`<svg viewBox="0 0 100 100">${c}${s}</svg>`}function Ke(e,r=!1){const l=_(e.width_m),o=_(e.height_m);if(l<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:n,svgWidth:a,svgHeight:s,lines:c}=se({width:l,height:o});let d=`<rect x="${t}" y="${n}" width="${a}" height="${s}" class="blind-frame" />`;if(r){const f=Math.max(4,Math.floor(a/8)),u=a/f;for(let p=0;p<f;p++)d+=`<rect x="${t+p*u+1}" y="${n}" width="${u-2}" height="${s}" class="blind-slat" />`}else{const f=Math.max(3,Math.floor(s/6)),u=s/f;for(let p=0;p<f;p++)d+=`<rect x="${t+1}" y="${n+p*u+.5}" width="${a-2}" height="${u-1}" class="blind-slat" />`}const i=Te(e,{x:t,y:n,svgWidth:a});return`<svg viewBox="0 0 100 100">${d}${c}${i}</svg>`}function Dt(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c=`<rect x="${o}" y="${t}" width="${n}" height="${a}" class="blind-frame" />`;const d=Math.max(3,Math.floor(a/8)),i=a/d;for(let h=0;h<d;h++)c+=`<rect x="${o+1}" y="${t+h*i}" width="${n-2}" height="${i-1.5}" rx="0.5" class="wooden-blind-slat" />`;const f=Math.max(2,n*.05),u=o+n*.25-f/2,p=o+n*.75-f/2,g=`
        <rect x="${u}" y="${t}" width="${f}" height="${a}" class="wooden-blind-strip" />
        <rect x="${p}" y="${t}" width="${f}" height="${a}" class="wooden-blind-strip" />
    `,y=Te(e,{x:o,y:t,svgWidth:n});return`<svg viewBox="0 0 100 100">${c}${g}${s}${y}</svg>`}function Ft(e){const r=_(e.width_m),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l}),c=`
        <rect x="${o}" y="${t}" width="${n}" height="${a}" class="roller-fabric" />
        <rect x="${o-1}" y="${t-4}" width="${n+2}" height="5" rx="2" class="roller-roll" />
        <line x1="${o}" y1="${t+a}" x2="${o+n}" y2="${t+a}" class="roller-bar" />
    `,d=Te(e,{x:o,y:t-2,svgWidth:n});return`<svg viewBox="0 0 100 100">${c}${s}${d}</svg>`}function Xe(e,r=!1){const l=_(e.width_m),o=_(e.height_m);if(l<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:n,svgWidth:a,svgHeight:s,lines:c}=se({width:l,height:o});let d="";if(r)d=`
            <defs>
                <pattern id="pleated-mesh" width="6" height="6" patternUnits="userSpaceOnUse">
                    <path d="M -1 1 L 1 -1 M 0 6 L 6 0" class="pleated-screen-mesh" />
                </pattern>
            </defs>
            <rect x="${t}" y="${n}" width="${a}" height="${s}" class="blind-frame" />
            <rect x="${t}" y="${n}" width="${a}" height="${s}" fill="url(#pleated-mesh)" />
        `;else{const f=Math.max(4,Math.floor(a/10)),u=a/f;for(let p=0;p<f;p++)d+=`<rect x="${t+p*u}" y="${n}" width="${u}" height="${s}" class="partition-panel" />`,p>0&&(d+=`<line x1="${t+p*u}" y1="${n}" x2="${t+p*u}" y2="${n+s}" class="partition-hinge" />`)}const i=rt(e,{y:n,svgHeight:s});return`<svg viewBox="0 0 100 100">${d}${i}${c}</svg>`}function Nt(e){const r=(e.widths||[]).reduce((u,p)=>u+_(p),0),l=_(e.height_m);if(r<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:t,svgWidth:n,svgHeight:a,lines:s}=se({width:r,height:l});let c="";const d=Math.floor(n/10),i=Math.floor(a/10);for(let u=0;u<i;u++)for(let p=0;p<d;p++)c+=`<circle cx="${o+p*10+5}" cy="${t+u*10+5}" r="1.5" class="wallpaper-pattern" />`;return`<svg viewBox="0 0 100 100">${`<rect x="${o}" y="${t}" width="${n}" height="${a}" class="blind-frame" /> ${c}`}${s}</svg>`}function Rt(e,r,l){let o="",t=G[e.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(e.type){case"set":e.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?o=Et(e):e.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(o=At(e),t=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"):e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?o=Pt(e):o=Bt(e);break;case"wooden_blind":o=Dt(e);break;case"aluminum_blind":o=Ke(e,!1);break;case"vertical_blind":o=Ke(e,!0);break;case"roller_blind":o=Ft(e);break;case"partition":o=Xe(e,!1);break;case"pleated_screen":o=Xe(e,!0);break;case"wallpaper":o=Nt(e);break;default:o=`<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">${I(t)}</text></svg>`;break}return`<div class="visual-placeholder is-clickable"
                 data-act="jump-to-item"
                 data-room-id="${r}"
                 data-item-index="${l}"
                 title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">${o}</div>`}function ze(e){let r=`
üìÉ *‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤*
`,l=!1;return e.rooms.forEach(o=>{if(o.is_suspended||!o.items)return;const t=o.items.filter(a=>a.is_suspended?!1:a.type==="wallpaper"?(a.widths||[]).reduce((s,c)=>s+_(c),0)>0:a.type==="set"||H[a.type]?.templateId==="#areaBasedTpl"?_(a.width_m)>0:!0);if(t.length===0)return;l=!0,r+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${o.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let n=0;t.forEach(a=>{n++;let s=G[a.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";a.type==="set"?a.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(s=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",r+=` ${n}) ${s} (${a.fabric_variant||""})
`):r+=` ${n}) ${s} ${a.style||""} (${a.fabric_variant||""})
`:r+=` ${n}) ${s}
`})}),l?r+`------------------------------
`:""}function nt(e){return e.rooms.reduce((r,l)=>{if(l.is_suspended)return r;const o=l.items?.reduce((t,n)=>{if(n.is_suspended)return t;switch(n.type){case"set":return t+P.calculateSetPrice(n).total;case"wallpaper":return t+P.calculateWallpaperPrice(n).total;default:return H[n.type]?.templateId==="#areaBasedTpl"?t+P.calculateAreaBasedPrice(n).total:t}},0)||0;return r+o},0)}function Ht(e,r){const l=nt(e);let o=0,t="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(o=l*(e.discount.value/100),t=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${A(o)} ‡∏ö‡∏≤‡∏ó
`):(o=e.discount.value,t=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${A(o)} ‡∏ö‡∏≤‡∏ó
`));const n=l-o;let a=`üóìÔ∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})})
`;if(a+=`üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(r==="customer"||r==="owner")&&(a+=`üìû ‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,a+=`üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),a+=`------------------------------
`,r==="customer")return a+=ze(e),o>0&&(a+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${A(l)} ‡∏ö‡∏≤‡∏ó
`,a+=t),a+=`
üí∞ *‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${A(n)} ‡∏ö‡∏≤‡∏ó*
`,a+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞
${J.name}
‡πÇ‡∏ó‡∏£: ${J.phone}`,a;if(r==="purchase_order"||r==="owner"){r==="owner"&&(a+=ze(e));const s={opaqueFabrics:[],sheerFabrics:[],wallpapers:[],allSets:[]};e.rooms.forEach(v=>{v.is_suspended||!v.items||v.items.forEach(w=>{let q=!w.is_suspended;if(w.type==="set"||H[w.type]?.templateId==="#areaBasedTpl")q=q&&_(w.width_m)>0&&_(w.height_m)>0;else if(w.type==="wallpaper"){const k=(w.widths||[]).reduce((b,T)=>b+_(T),0);q=q&&k>0&&_(w.height_m)>0}if(q)switch(w.type){case"set":s.allSets.push(w),w.style!=="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(w.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&s.opaqueFabrics.push({code:w.fabric_code||"??",yards:P.fabricYardage(w.style,w.width_m)}),w.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&s.sheerFabrics.push({code:w.sheer_fabric_code||"??",yards:P.fabricYardage(w.style,w.width_m)}));break;case"wallpaper":const k=(w.widths||[]).reduce((T,x)=>T+_(x),0),b=P.wallpaperRolls(k,w.height_m);b>0&&s.wallpapers.push({code:w.wallpaper_code||"xxx",rolls:b});break;default:if(H[w.type]?.templateId==="#areaBasedTpl"){const T=w.type;s[T]||(s[T]=[]),s[T].push({code:w.code||"xxx",width:_(w.width_m),height:_(w.height_m),opening_style:w.opening_style,adjustment_side:w.adjustment_side})}break}})});const c={};if([...s.opaqueFabrics,...s.sheerFabrics].forEach(v=>{v.yards>0&&(c[v.code]=(c[v.code]||0)+v.yards)}),Object.keys(c).length>0){a+=`‚úÇÔ∏è *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,a+=`------------------------------
`,s.opaqueFabrics.filter(v=>v.yards>0).forEach(v=>{a+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain)
`,a+=`  ‡∏£‡∏´‡∏±‡∏™: #${v.code||"??"}
`,a+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${v.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),s.sheerFabrics.filter(v=>v.yards>0).forEach(v=>{a+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer)
`,a+=`  ‡∏£‡∏´‡∏±‡∏™: #${v.code||"??"}
`,a+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${v.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),a+=`------------------------------
`,a+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,a+=`------------------------------
`;for(const[v,w]of Object.entries(c))a+=`  - ‡∏£‡∏´‡∏±‡∏™ #${v}: ${w.toFixed(2)} ‡∏´‡∏•‡∏≤
`;a+=`
`}const d=s.allSets.filter(v=>v.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"),i=s.allSets.filter(v=>v.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"),f=s.allSets.filter(v=>v.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"),u=s.allSets.filter(v=>v.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"),p=s.allSets.filter(v=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏ï‡∏≤‡πÑ‡∏Å‡πà","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(v.style));if(d.length>0){a+=`------------------------------
`,a+=`üëë *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå)*
`,a+=`------------------------------

`;let v=1;d.forEach(b=>{a+=`(${v++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,a+=`  - ‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏∂‡∏ö/‡πÇ‡∏õ‡∏£‡πà‡∏á): ${Number(b.width_m).toFixed(2)} ‡∏°.
`,a+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${b.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,a+=`  - ‡∏û‡∏π‡πà: ${b.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`,b.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),a+=`
`});const w=[];d.forEach(b=>{w.push(Number(b.width_m)),b.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&w.push(Number(b.width_m))});const q=w.reduce((b,T)=>{const x=T.toFixed(2);return b[x]=(b[x]||0)+1,b},{}),k=Object.entries(q).sort((b,T)=>parseFloat(T[0])-parseFloat(b[0]));if(k.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì):*
`;for(const[b,T]of k)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${T} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(i.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö*
`,a+=`------------------------------

`;let v=1;i.forEach(k=>{a+=`(${v++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö
`,a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ${Number(k.width_m).toFixed(2)} ‡∏°.
`,a+=`  - ‡∏™‡∏µ‡∏£‡∏≤‡∏á: ${k.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,a+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${k.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`,k.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${k.notes}
`),a+=`
`});const w=i.reduce((k,b)=>{const T=Number(b.width_m).toFixed(2);return k[T]=(k[T]||0)+1,k},{}),q=Object.entries(w).sort((k,b)=>parseFloat(b[0])-parseFloat(k[0]));if(q.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[k,b]of q)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${k} ‡∏°. = ${b} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(p.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö)*
`,a+=`------------------------------

`;let v=1;p.forEach(b=>{a+=`(${v++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,b.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(b.width_m).toFixed(2)} ‡∏°.
`),b.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(b.width_m).toFixed(2)} ‡∏°.
`),b.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),a+=`
`});const w=[];p.forEach(b=>{b.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&w.push(Number(b.width_m)),b.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&w.push(Number(b.width_m))});const q=w.reduce((b,T)=>{const x=T.toFixed(2);return b[x]=(b[x]||0)+1,b},{}),k=Object.entries(q).sort((b,T)=>parseFloat(T[0])-parseFloat(b[0]));if(k.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[b,T]of k)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${T} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(f.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà)*
`,a+=`------------------------------

`;let v=1;f.forEach(x=>{a+=`(${v++}) ‡∏£‡∏≤‡∏á ${x.style}, ‡∏™‡∏µ: ${x.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,x.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(x.width_m).toFixed(2)} ‡∏°.
`),x.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(x.width_m).toFixed(2)} ‡∏°.
`),x.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${x.notes}
`),a+=`
`}),a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡πÑ‡∏Å‡πà ---
`;const w=[];f.forEach(x=>{x.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&w.push(Number(x.width_m)),x.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&w.push(Number(x.width_m))});const q=6;w.sort((x,L)=>L-x);const k=[];for(const x of w){let L=!1;for(let C=0;C<k.length;C++)if(k[C]>=x-.001){k[C]-=x,L=!0;break}L||k.push(q-x)}a+=`‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (6 ‡∏°.) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: *${k.length} ‡πÄ‡∏™‡πâ‡∏ô*

`;const b=w.reduce((x,L)=>{const C=L.toFixed(2);return x[C]=(x[C]||0)+1,x},{}),T=Object.entries(b).sort((x,L)=>parseFloat(L[0])-parseFloat(x[0]));if(T.length>0){a+=`*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[x,L]of T)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${x} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(u.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö)*
`,a+=`------------------------------

`;let v=1;u.forEach(b=>{a+=`(${v++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,a+=`  - ‡∏£‡∏≤‡∏á: ${Number(b.width_m).toFixed(2)} ‡∏°.
`,b.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),a+=`
`});const q=u.map(b=>Number(b.width_m)).reduce((b,T)=>{const x=T.toFixed(2);return b[x]=(b[x]||0)+1,b},{}),k=Object.entries(q).sort((b,T)=>parseFloat(T[0])-parseFloat(b[0]));if(k.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[b,T]of k)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${T} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}const g={};let y={};s.allSets.forEach(v=>{const w=v.track_color||"‡∏Ç‡∏≤‡∏ß",q=v.style,k=v.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á",b=_(v.width_m)>=1.6?3:2;if(g[w]||(g[w]={brackets:{},finials:0,grommets:{},rodPocketBrackets:0}),g[w].brackets[q]||(g[w].brackets[q]={single:0,double:0}),q!=="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&q!=="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&q!=="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?k?g[w].brackets[q].double+=b:g[w].brackets[q].single+=b:q==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(g[w].rodPocketBrackets+=4),q==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const T=k?4:2;g[w].finials+=T}if(q==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const T=v.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",x=P.calculateGrommets(v);g[w].grommets[T]||(g[w].grommets[T]=0),g[w].grommets[T]+=x}if(q==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const T=v.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤";T!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"&&(y[T]=(y[T]||0)+2)}});const h=s.allSets.filter(v=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(v.style)).length*2,S=Object.values(g).some(v=>Object.values(v.brackets).some(w=>w.single>0||w.double>0)),M=Object.values(g).some(v=>v.rodPocketBrackets>0),B=Object.values(g).some(v=>v.finials>0),E=Object.values(g).some(v=>Object.values(v.grommets).some(w=>w>0)),F=Object.keys(y).length>0;if(S||M||B||E||h>0||F){a+=`------------------------------
`,a+=`üî© *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Hardware)*
`,a+=`------------------------------

`;for(const[w,q]of Object.entries(g)){let k=!1,b=`**‡∏™‡∏µ${w}**
`;const T=Object.keys(q.brackets);if(T.length>0){let L="";T.forEach(C=>{!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(C)&&(q.brackets[C].single>0||q.brackets[C].double>0)&&(L+=`    - ${C} (‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß): ${q.brackets[C].single} ‡∏ï‡∏±‡∏ß
`,L+=`    - ${C} (2‡∏ä‡∏±‡πâ‡∏ô): ${q.brackets[C].double} ‡∏ï‡∏±‡∏ß
`)}),L&&(k=!0,b+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô):
${L}`)}q.rodPocketBrackets>0&&(k=!0,b+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö): ${q.rodPocketBrackets} ‡∏ï‡∏±‡∏ß
`),q.finials>0&&(k=!0,b+=`  - ‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà): ${q.finials} ‡∏ï‡∏±‡∏ß
`);const x=Object.keys(q.grommets);if(x.length>0){let L="";x.forEach(C=>{const D=q.grommets[C];D>0&&(L+=`    - ‡∏™‡∏µ${C}: ${D} ‡∏ï‡∏±‡∏ß
`)}),L&&(k=!0,b+=`  - ‡∏ï‡∏≤‡πÑ‡∏Å‡πà:
${L}`)}k&&(a+=b+`
`)}let v="";if(h>0&&(v+=`  - ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏£‡∏ß‡∏ö‡∏°‡πà‡∏≤‡∏ô (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô): ${h} ‡∏ï‡∏±‡∏ß
`),F){v+=`  - ‡∏û‡∏π‡πà/‡∏™‡∏≤‡∏¢‡∏£‡∏ß‡∏ö (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå):
`;for(const[w,q]of Object.entries(y))v+=`    - ${w}: ${q} ‡∏ä‡∏∏‡∏î
`}v&&(a+=`**‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°**
`+v+`
`)}const U=Object.keys(s).filter(v=>!["opaqueFabrics","sheerFabrics","wallpapers","allSets"].includes(v));U.length>0&&U.sort().forEach(v=>{const w=s[v],q=G[v]||v;a+=`------------------------------
`,a+=`üì¶ *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${q}*
`,a+=`------------------------------

`,w.forEach(k=>{a+=`- ‡∏£‡∏´‡∏±‡∏™: #${k.code||"xxx"}
  ‡∏Ç‡∏ô‡∏≤‡∏î: ${k.width.toFixed(2)} x ${k.height.toFixed(2)} ‡∏°.
`,k.opening_style&&(a+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${k.opening_style}
`),k.adjustment_side&&(a+=`  ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${k.adjustment_side}
`),a+=`
`})});const Q={};if(s.wallpapers.forEach(v=>{Q[v.code]=(Q[v.code]||0)+v.rolls}),Object.keys(Q).length>0){a+=`------------------------------
`,a+=`üé® *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,a+=`------------------------------

`;for(const[v,w]of Object.entries(Q))a+=`  - ‡∏£‡∏´‡∏±‡∏™ #${v}: ${w} ‡∏°‡πâ‡∏ß‡∏ô
`;a+=`
`}if(r==="purchase_order")return a+=`------------------------------
`,a}if(r==="seamstress"||r==="owner"){a+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏¢‡πá‡∏ö‡∏ú‡πâ‡∏≤*
`;let s=0;if(e.rooms.forEach(c=>{if(c.is_suspended||!c.items)return;const d=c.items.filter(i=>i.type==="set"&&!i.is_suspended&&_(i.width_m)>0&&_(i.height_m)>0);d.length!==0&&(s>0&&(a+=`==============================
`),a+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${c.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*

`,d.forEach((i,f)=>{f>0&&(a+=`--------------------
`);const u=i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":i.style;a+=`*‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà ${f+1}/${d.length}: ${u} ${i.fabric_variant}*
`,i.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?a+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${i.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`:i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(a+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${i.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,a+=`  - ‡∏û‡∏π‡πà: ${i.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`):i.style!=="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(a+=`  - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${i.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"}
`),i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡∏ó‡∏∂‡∏ö): #${i.fabric_code||"-"}
`),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡πà‡∏á): #${i.sheer_fabric_code||"-"}
`)):(i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: #${i.fabric_code||"-"}
`),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: #${i.sheer_fabric_code||"-"}
`)),a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(i.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(i.height_m).toFixed(2)} ‡∏°.
`,i.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${i.notes}
`)}),a+=`
`,s++)}),s>0?a+=`==============================
`:a+=`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
------------------------------
`,r==="seamstress")return a}return r==="owner"&&(a+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${A(n)} ‡∏ö‡∏≤‡∏ó*
`,o>0&&(a+=`   (‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏î: ${A(l)} ‡∏ö‡∏≤‡∏ó ${t.trim()})
`)),a}function Ot(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let r="";const l={};let o=0;if(e.rooms.forEach(a=>{a.is_suspended||!a.items||a.items.forEach(s=>{if(s.is_suspended)return;let c=null,d=0;switch(s.type){case"set":d=P.calculateSetPrice(s).total,d>0&&(c=s.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":d=P.calculateWallpaperPrice(s).total,d>0&&(c=s.type);break;default:H[s.type]?.templateId==="#areaBasedTpl"&&(d=P.calculateAreaBasedPrice(s).total,d>0&&(c=s.type));break}c&&(l[c]=(l[c]||0)+1,o++)})}),o>0){const a=Object.entries(l).map(([s,c])=>{const d=G[s]||G[s.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                <span class="summary-tag" data-filter-type="${I(s)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                    ${I(d)} <strong>${c}</strong>
                </span>`}).join("");a&&(r+=`
                <div class="overview-summary-group">
                    <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                    <div class="summary-tags-container">
                        ${a}
                    </div>
                </div>`)}let t="",n=0;return e.rooms.forEach(a=>{if(a.is_suspended||!a.items)return;const s={};let c=0;if(a.items.forEach(d=>{if(d.is_suspended)return;let i=null,f=0;switch(d.type){case"set":f=P.calculateSetPrice(d).total,f>0&&(i=d.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":f=P.calculateWallpaperPrice(d).total,f>0&&(i=d.type);break;default:H[d.type]?.templateId==="#areaBasedTpl"&&(f=P.calculateAreaBasedPrice(d).total,f>0&&(i=d.type));break}i&&(s[i]=(s[i]||0)+1,c++)}),c>0){n+=c;const d=Object.entries(s).map(([i,f])=>{const u=G[i]||G[i.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                    <div class="overview-item">
                        <span>${I(u)}</span>
                        <span>${f}</span>
                    </div>`}).join("");t+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${I(a.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${c} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${d}</div>
                </details>`}}),t&&(r+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${t}
            </div>`),o===0&&n===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':r}function jt(e,r){const{vatRate:l=J.baseVatRate,pageBreakBuffer:o=3,showDetails:t=!0}=r,n=[];e.rooms.forEach(v=>{if(v.is_suspended||!v.items)return;const w=[];if(v.items.forEach(q=>{if(q.is_suspended)return;let k="",b=0,T=0,x=0,L=1,C=q.type==="set"&&q.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":G[q.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",D="";switch(q.type){case"set":if(b=P.calculateSetPrice(q).total,b>0){T=_(q.width_m),x=_(q.height_m);const R=q.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"":` ${I(q.style||"")}`;k=`${C}${R} (${I(q.fabric_variant||"")})`,t&&(D=`<br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${T.toFixed(2)} x ${x.toFixed(2)} ‡∏°.${q.notes?` - ${I(q.notes)}`:""}</small>`),L=t?1.5:1}break;case"wallpaper":if(b=P.calculateWallpaperPrice(q).total,b>0){const R=(q.widths||[]).reduce((Ee,ce)=>Ee+_(ce),0),ne=P.wallpaperRolls(R,q.height_m);x=_(q.height_m),k=`${C}`,t&&(D=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${I(q.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${x.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${ne} ‡∏°‡πâ‡∏ß‡∏ô)</small>`),L=t?1.5:1}break;default:H[q.type]?.templateId==="#areaBasedTpl"&&(b=P.calculateAreaBasedPrice(q).total,b>0&&(T=_(q.width_m),x=_(q.height_m),k=`${C}`,t&&(D=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${I(q.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${T.toFixed(2)} x ${x.toFixed(2)} ‡∏°.</small>`),L=t?1.5:1));break}b>0&&k&&w.push({description:k+D,unitPrice:b,units:L})}),w.length>0){n.push({isRoomHeader:!0,roomName:I(v.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2});const q=new Map;w.forEach(k=>{const b=`${k.description}::${k.unitPrice}`;q.has(b)?q.get(b).quantity+=1:q.set(b,{...k,quantity:1})}),q.forEach(k=>{n.push({...k,total:k.quantity*k.unitPrice})})}});const a=n.reduce((v,w)=>v+(w.total||0),0);if(a===0)return null;let s=0,c="",d=a;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(s=a*(e.discount.value/100),c=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${ee(s,2,!0)}</td></tr>`):(s=e.discount.value,c=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${ee(s,2,!0)}</td></tr>`),d=a-s);const i=d*l,f=d+i,u=t?17:20,p=t?23:28,g=[];let y=[],h=0;n.forEach((v,w)=>{const q=g.length===0?u:p,k=h+v.units>q;let b=!1;if(v.isRoomHeader&&w<n.length-1){const x=n[w+1].units||(t?1.5:1);h+v.units+x>q&&h+v.units<=q&&(b=!0)}let T=!1;if(!k&&!b&&w<n.length-1){const x=q-(h+v.units),L=n[w+1].units||(t?1.5:1);x>0&&x<o&&x<L&&!v.isRoomHeader&&(T=!0)}(k||b||T)&&y.length>0&&(g.push(y),y=[],h=0),y.push(v),h+=v.units}),y.length>0&&g.push(y);const S=new Date,M=S.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),B=`QT-${S.getFullYear()}${(S.getMonth()+1).toString().padStart(2,"0")}${S.getDate().toString().padStart(2,"0")}`;let E="",F=0,N=1;g.forEach((v,w)=>{const q=w===0,k=w===g.length-1,b=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                     <div class="pdf-shop-info">
                        
                        <div class="pdf-shop-address">
                            <strong><i class=""></i> ${I(J.name)}</strong><br>
                            ${I(J.address).replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${I(J.phone)} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${I(J.taxId)}
                        </div>
                    </div>
                     <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${g.length>1?q?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${B}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${M}</td></tr>
                        </table>
                    </div>
                </div>
                ${q?`
                <section class="pdf-customer-details">
                     <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${I(e.customer_name)||"-"}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${I(e.customer_address||"-").replace(/\n/g,"<br>")}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${I(e.customer_phone)||"-"}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${I(J.pdf.paymentTerms)}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${I(J.pdf.priceValidity)}
                    </div>
                </section>`:""}
            </div>`,T=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span><i class=""></i> ${I(J.name)} | ‡πÇ‡∏ó‡∏£: ${I(J.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${w+1} / ${g.length}</span>
                </div>
            </div>`;let x="";q||(x+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${ee(F,2,!0)}</td></tr>`),v.forEach(R=>{R.isRoomHeader?x+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${R.roomName}</td></tr>`:(x+=`<tr>
                    <td class="pdf-text-center">${N++}</td>
                    <td>${R.description}</td>
                    <td class="pdf-text-center">${R.quantity}</td>
                    <td class="pdf-text-right">${ee(R.unitPrice,2,!0)}</td>
                    <td class="pdf-text-right">${ee(R.total,2,!0)}</td>
                </tr>`,F+=R.total)});let L="";k||(L=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${ee(F,2,!0)}</td></tr></tfoot>`);let C="";t&&J.pdf.notes&&J.pdf.notes.length>0&&(C=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${J.pdf.notes.map(R=>`<li>${I(R)}</li>`).join("")}</ul>
            `);const D=k?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${C}
                        <div class="pdf-amount-text">( ${Mt(f)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${ee(a,2,!0)}</td></tr>
                            ${c}
                            ${l>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(l*100).toFixed(0)}%</td><td class="pdf-amount">${ee(i,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${ee(f,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(<i class=""></i> ${I(J.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${M}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";E+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${b}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                             {/* - */}
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:45%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${x}</tbody>
                            ${L}
                        </table>
                        ${D}
                    </div>
                    ${T}
                </div>
            </div>`});const U=e.customer_name||"quote",Q=at(U);return{html:`<div id="quotation-template">${E}</div>`,fileName:`${B}_${Q}`}}function Wt(e){const r=nt(e);let l=0;e.discount?.value>0&&(l=e.discount.type==="percent"?r*(e.discount.value/100):e.discount.value);const o=r-l;let t=!1,n=e.rooms.map(s=>{if(s.is_suspended)return"";const c=s.items.filter(i=>i.is_suspended?!1:i.type==="set"||H[i.type]?.templateId==="#areaBasedTpl"?_(i.width_m)>0&&_(i.height_m)>0:i.type==="wallpaper"?(i.widths||[]).reduce((u,p)=>u+_(p),0)>0&&_(i.height_m)>0:!1);if(c.length===0)return"";const d=c.map((i,f)=>{let u="",p="",g="",y="";switch(i.type==="set"?i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(y=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",p=`<h5 class="lookbook-item-title">${I(y)}</h5>`):i.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?(y=G.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",p=`<h5 class="lookbook-item-title">${I(y)} ${I(i.style)}</h5>`):y=G.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô":(y=G[i.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",p=`<h5 class="lookbook-item-title">${I(y)}</h5>`),i.type){case"set":g=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${_(i.width_m).toFixed(2)} x ${_(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${y} (${I(i.fabric_variant||"")})</td></tr>
                            ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô</td><td>#${I(i.fabric_code)||"-"}</td></tr>`:""}
                            ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${I(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                            <tr><td>‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå</td><td>${I(i.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå")}</td></tr>
                            <tr><td>‡∏û‡∏π‡πà</td><td>${I(i.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤")}</td></tr>
                         `:i.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?u=`
                             <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${I(i.style)} (${I(i.fabric_variant||"")})</td></tr>
                             ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${I(i.fabric_code)||"-"}</td></tr>`:""}
                             ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${I(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                         `:(u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${I(i.style||"")} (${I(i.fabric_variant||"")})</td></tr>
                            ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ó‡∏∂‡∏ö</td><td>#${I(i.fabric_code)||"-"}</td></tr>`:""}
                            ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${I(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                        `,i.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${I(i.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")}</td></tr>`:u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${I(i.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")}</td></tr>`);break;case"wallpaper":const h=(i.widths||[]).reduce((M,B)=>M+_(B),0),S=P.wallpaperRolls(h,i.height_m);g=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>‡∏£‡∏ß‡∏° ${h.toFixed(2)} ‡∏°., ‡∏™‡∏π‡∏á ${_(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`
                        <tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${I(i.wallpaper_code)||"-"}</td></tr>
                        <tr><td>‡πÉ‡∏ä‡πâ</td><td>${S} ‡∏°‡πâ‡∏ß‡∏ô</td></tr>
                    `;break;default:H[i.type]?.templateId==="#areaBasedTpl"&&(g=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${_(i.width_m).toFixed(2)} x ${_(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`<tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${I(i.code)||"-"}</td></tr>`,i.opening_style&&(u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${I(i.opening_style)}</td></tr>`),i.adjustment_side&&(u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${I(i.adjustment_side)}</td></tr>`));break}return u&&(t=!0),`
                 <div class="lookbook-details">
                    ${Rt(i,s.id,f)}
                    <div class="spec-table-wrapper">
                        ${p}
                        <table class="spec-table">
                            ${u}
                            ${g}
                            ${i.notes?`<tr><td>‡πÇ‡∏ô‡πâ‡∏ï</td><td>${I(i.notes)}</td></tr>`:""}
                        </table>
                    </div>
                </div>
            `}).join('<hr class="lookbook-hr">');return d.trim()?`
            <div class="lookbook-room">
                <h4><i class="ph ph-map-pin"></i> ${I(s.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</h4>
                ${d}
            </div>
        `:""}).join("");return t?`
        <div class="lookbook-summary">
            <div class="lookbook-customer-info">
                <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${I(e.customer_name)||"-"}<br/>
                <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${I(e.customer_address||"-").replace(/\n/g,"<br/>")}
            </div>
            <div class="lookbook-totals">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î): ${A(r)} ‡∏ö‡∏≤‡∏ó</span>
                ${l>0?`<span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${A(l)} ‡∏ö‡∏≤‡∏ó</span>`:""}
                <span class="grand-total">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${A(o)} ‡∏ö‡∏≤‡∏ó</span>
            </div>
        </div>
    `+n:'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>'}function st(e={}){const r=document.querySelector(m.roomTpl);if(!r)return console.error("Room template not found"),null;const o=r.content.cloneNode(!0).firstElementChild;o.id=e.id||`room-${Date.now()}`,o.open=e.is_open!==!1,o.dataset.roomDefaults=JSON.stringify(e.room_defaults||{});const t=o.querySelector(m.roomNameInput),n=o.querySelector("[data-room-name-display]"),a=o.querySelector("[data-room-brief]"),s=o.querySelector(m.allItemsContainer),c=()=>{const f=t.value||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";n&&(n.textContent=f)};t&&t.addEventListener("input",c);const d=o.querySelector("summary");d&&d.addEventListener("click",()=>{});const i=e.room_name||`‡∏´‡πâ‡∏≠‡∏á ${document.querySelectorAll(m.room).length+1}`;if(t){t.value=i;const f=`room_name_${o.id}`;t.id=f;const u=t.closest(".form-group")?.querySelector("label");u&&u.setAttribute("for",f)}return n&&(n.textContent=i),e.is_suspended&&o.classList.add("is-suspended"),o.getItemsContainer=()=>s,o.updateBrief=f=>{a&&(a.innerHTML=f)},o}function Le(e={}){const r=document.querySelector(m.setTpl);if(!r)return console.error("Set template not found"),null;const o=r.content.cloneNode(!0).firstElementChild;o.dataset.type="set";const t=o.querySelector('input[name="width_m"]'),n=o.querySelector('input[name="height_m"]'),a=o.querySelector('select[name="set_style"]'),s=o.querySelector('select[name="fabric_variant"]'),c=o.querySelector('select[name="set_price_per_m"]'),d=o.querySelector('select[name="sheer_price_per_m"]'),i=o.querySelector('select[name="louis_price_per_m"]'),f=o.querySelector('input[name="fabric_code"]'),u=o.querySelector('input[name="sheer_fabric_code"]'),p=o.querySelector('select[name="opening_style"]'),g=o.querySelector('select[name="adjustment_side"]'),y=o.querySelector('input[name="notes"]'),h=o.querySelector('[data-set-control="opening_style_wrap"]'),S=o.querySelector('[data-set-control="adjustment_side_wrap"]'),M=o.querySelector('[data-set-control="louis_price_wrap"]'),B=o.querySelector('[data-set-control="fabric_price_wrap"]'),E=o.querySelector('[data-set-control="fabric_code_wrap"]'),F=o.querySelector("[data-sheer-wrap]"),N=o.querySelector("[data-sheer-code-wrap]"),U=o.querySelector("[data-set-summary]"),Q=o.querySelector(".item-details-more"),v=o.querySelector('[data-act="toggle-more-details"]')?.parentElement,w=()=>({width_m:t.value,height_m:n.value,style:a.value,fabric_variant:s.value,price_per_m_raw:c.value,sheer_price_per_m:d.value,louis_price_per_m:i.value,is_suspended:o.classList.contains("is-suspended")}),q=()=>{const L=w(),C=P.calculateSetPrice(L);o.dataset.totalPrice=C.total;let D=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${A(C.total)}</b> ‡∏ö.`;if(L.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const ne=[];C.opaque>0&&ne.push(`‡∏ó‡∏∂‡∏ö: ${A(C.opaque)}`),C.sheer>0&&ne.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${A(C.sheer)}`),C.louis>0&&ne.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${A(C.louis)}`),ne.length>0&&(D+=` <small>(${ne.join(", ")})</small>`)}else C.opaque>0&&C.sheer>0&&(D+=` <small>(‡∏ó‡∏∂‡∏ö: ${A(C.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${A(C.sheer)})</small>`);const R=P.fabricYardage(L.style,L.width_m);R>0&&(D+=` &bull; ‡πÉ‡∏ä‡πâ‡∏ú‡πâ‡∏≤: ${R.toFixed(2)} ‡∏´‡∏•‡∏≤`),U?U.innerHTML=D:console.warn("Summary element not found for set item.")},k=ve(()=>{q(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),b=()=>{const L=a.value,C=s.value,D=L==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",R=C.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),ne=C==="‡πÇ‡∏õ‡∏£‡πà‡∏á"&&!D,Ee=C==="‡∏ó‡∏∂‡∏ö"&&!D;F?.classList.toggle("hidden",!R||D),N?.classList.toggle("hidden",!R||D);const ce=ne||D;c&&(c.disabled=ce,ce&&(c.value="")),f&&(f.disabled=ce,ce&&(f.value=""));const be=Ee||D;d&&(d.disabled=be,be&&(d.value="")),u&&(u.disabled=be,be&&(u.value=""))},T=()=>{const L=a.value,C=L==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",D=L==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",R=C||D||L==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö";h&&h.classList.toggle("hidden",R),S&&S.classList.toggle("hidden",!C),M&&M.classList.toggle("hidden",!D),B&&B.classList.toggle("hidden",D),E&&E.classList.toggle("hidden",D),b()};o.addEventListener("input",L=>{L.target===s&&b(),L.target===a&&T(),k()});const x=L=>{We(L),k()};if(t.addEventListener("blur",x),n.addEventListener("blur",x),Q&&v){const L=o.querySelector(".item-grid");L&&L.appendChild(v)}return t.value=Y(e.width_m),n.value=Y(e.height_m),a.value=e.style||"‡∏•‡∏≠‡∏ô",s.value=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",c.value=e.price_per_m_raw||"",d.value=e.sheer_price_per_m||"",i.value=e.louis_price_per_m||"",f.value=e.fabric_code||"",u.value=e.sheer_fabric_code||"",p.value=e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",g.value=e.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",y.value=e.notes||"",o.querySelector('input[name="track_color"]').value=e.track_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="bracket_color"]').value=e.bracket_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="finial_color"]').value=e.finial_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="grommet_color"]').value=e.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",o.querySelector('input[name="louis_valance"]').value=e.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",o.querySelector('input[name="louis_tassels"]').value=e.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",e.is_suspended&&o.classList.add("is-suspended"),T(),q(),o}function He(e={}){const r=document.querySelector(m.wallTpl);if(!r)return null;const o=r.content.cloneNode(!0).firstElementChild,t=o.querySelector('input[name="wall_width_m"]');t.value=Y(e.width);const n=`wall_width_${Date.now()}_${Math.random().toString(36).substring(2,7)}`;t.id=n;const a=o.querySelector("label");return a&&a.setAttribute("for",n),o}function Ce(e={}){const r=document.querySelector(m.wallpaperTpl);if(!r)return console.error("Wallpaper template not found"),null;const o=r.content.cloneNode(!0).firstElementChild;o.dataset.type="wallpaper";const t=o.querySelector('[name="wallpaper_height_m"]'),n=o.querySelector('[name="wallpaper_price_roll"]'),a=o.querySelector('[name="wallpaper_install_cost"]'),s=o.querySelector('[name="wallpaper_code"]'),c=o.querySelector('[name="wallpaper_notes"]'),d=o.querySelector("[data-walls-container]"),i=o.querySelector("[data-wallpaper-summary]"),f=o.querySelector(".item-details-more"),u=o.querySelector('[data-act="toggle-more-details"]')?.parentElement,p=()=>({height_m:t.value,price_per_roll:n.value,install_cost_per_roll:a.value,widths:Array.from(d.querySelectorAll('input[name="wall_width_m"]')).map(S=>S.value),is_suspended:o.classList.contains("is-suspended")}),g=()=>{const S=p(),M=P.calculateWallpaperPrice(S);o.dataset.totalPrice=M.total;let B=`‡∏£‡∏ß‡∏°: <b>${A(M.total)}</b> ‡∏ö. `;(M.material>0||M.install>0)&&(B+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${A(M.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${A(M.install)})</small>`),M.rolls>0&&(B+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ee(M.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${M.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),i&&(i.innerHTML=B)},y=ve(()=>{g(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);o.addEventListener("input",y);const h=S=>{We(S),y()};if(t.addEventListener("blur",h),o.addEventListener("blur",S=>{S.target.name==="wall_width_m"&&h(S)},!0),f&&u){const S=o.querySelector(".item-grid");S&&S.appendChild(u)}if(e.widths&&e.widths.length>0)e.widths.forEach(S=>{const M=He({width:S});M&&d.appendChild(M)});else{const S=He();S&&d.appendChild(S)}return t.value=Y(e.height_m),n.value=e.price_per_roll>0?A(e.price_per_roll):"",e.hasOwnProperty("install_cost_per_roll")?a.value=e.install_cost_per_roll===0?"0":e.install_cost_per_roll>0?A(e.install_cost_per_roll):"":a.value=a.value,s.value=e.wallpaper_code||"",c.value=e.notes||"",e.is_suspended&&o.classList.add("is-suspended"),g(),o}function Be(e,r={}){const l=document.querySelector(m.areaBasedTpl);if(!l)return console.error("AreaBased template not found"),null;const t=l.content.cloneNode(!0).firstElementChild;t.dataset.type=e;const n=H[e]||{name:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};t.classList.add(`${e.replace(/_/g,"-")}-item`);const a=t.querySelector(".item-type-display"),s=t.querySelector('[name="area_width_m"]'),c=t.querySelector('[name="area_height_m"]'),d=t.querySelector('[name="area_price_sqyd"]'),i=t.querySelector('[name="area_code"]'),f=t.querySelector('[name="area_notes"]'),u=t.querySelector(".btn-favorite"),p=t.querySelector(".btn-show-favs"),g=t.querySelector("[data-area-summary]"),y=t.querySelector(".item-details-more"),h=t.querySelector('[data-act="toggle-more-details"]')?.parentElement,S=y?.querySelector(".item-grid"),M=S?.querySelector('[name="area_price_sqyd"]')?.closest(".form-group");let B,E;if(S&&M){if(e==="partition"||e==="pleated_screen"){const v=document.createElement("div");v.className="form-group",v.innerHTML=`
                <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î
                    <select name="opening_style">
                        <option value="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á">‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
                    </select>
                </label>
            `,S.insertBefore(v,M),B=v.querySelector("select")}else if(["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(e)){const v=document.createElement("div");v.className="form-group",v.innerHTML=`
                <label>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö
                    <select name="adjustment_side">
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤</option>
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢">‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢</option>
                    </select>
                </label>
            `,S.insertBefore(v,M),E=v.querySelector("select")}(B||E)&&M&&M.classList.remove("full-width-item")}const F=()=>({width_m:s.value,height_m:c.value,price_sqyd:d.value,is_suspended:t.classList.contains("is-suspended")}),N=()=>{const v=F(),w=P.calculateAreaBasedPrice(v);t.dataset.totalPrice=w.total;const q=w.sqyd>0?` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ee(w.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`:"";g&&(g.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${A(w.total)}</b> ‡∏ö.${q}`)},U=ve(()=>{N(),t.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);t.addEventListener("input",U);const Q=v=>{We(v),U()};if(s.addEventListener("blur",Q),c.addEventListener("blur",Q),y&&h){const v=t.querySelector(".item-grid");v&&v.appendChild(h)}return a&&(a.textContent=n.name),i&&(i.dataset.favoriteType=e),u&&(u.dataset.type=e),p&&(p.dataset.type=e),s.value=Y(r.width_m),c.value=Y(r.height_m),d.value=r.price_sqyd>0?A(r.price_sqyd):"",i.value=r.code||"",f.value=r.notes||"",B&&(B.value=r.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),E&&(E.value=r.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"),r.is_suspended&&t.classList.add("is-suspended"),N(),t}let Pe=!1;async function Vt(){const e=document.querySelector(m.exportOptionsModal);if(!e)return null;const r=e.querySelector("#pageBreakBuffer"),l=e.querySelector("#pageBreakBufferValue");r&&l&&(l.textContent=r.value,r.oninput=()=>{l.textContent=r.value});const o=await O(m.exportOptionsModal);return r&&(r.oninput=null),!o||o.cancelled?null:{vatOption:e.querySelector('input[name="vat_option"]:checked')?.value||"include",showDetails:(e.querySelector('input[name="item_details_option"]:checked')?.value||"show_details")==="show_details",exportMethod:e.querySelector("#exportMethod")?.value||"direct",pageBreakBuffer:parseInt(r?.value,10)||3}}async function Gt(){const e=document.querySelector("#discountModal");if(!e)return Promise.resolve({cancelled:!0});const r=e.querySelector("#discountSubtotal"),l=e.querySelector("#discountPercent"),o=e.querySelector("#discountAmount"),t=e.querySelector("#discountFinalTotal"),n=document.querySelector("#discount_type"),a=document.querySelector("#discount_value"),s=_(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);r&&(r.textContent=A(s));const c=h=>{if(Pe)return;Pe=!0;let S=0;if(h==="percent"){const M=_(l.value);S=s*(Math.max(0,M)/100),o.value=S>0?A(Math.round(S)):""}else S=_(o.value);if(S=Math.max(0,Math.min(S,s)),h!=="percent"){const M=s>0?S/s*100:0;l.value=M>0&&isFinite(M)?ee(M,2):""}t&&(t.textContent=A(s-S)),setTimeout(()=>{Pe=!1},50)},d=()=>c("percent"),i=()=>c("amount"),f=h=>{_(h.target.value)>0&&(h.target.value=_(h.target.value))},u=h=>{const S=_(h.target.value);h.target.value=S>0?A(S):"",c("amount")};l.addEventListener("input",d),o.addEventListener("input",i),o.addEventListener("focus",f),o.addEventListener("blur",u);const p=n.value,g=_(a.value);l.value="",o.value="",g>0?p==="percent"?(l.value=g,c("percent")):(o.value=g,o.value=A(g),c("amount")):c();const y=await O("#discountModal");if(l.removeEventListener("input",d),o.removeEventListener("input",i),o.removeEventListener("focus",f),o.removeEventListener("blur",u),y&&!y.cancelled){const h=_(l.value),S=_(o.value),M=document.activeElement;h>0&&M===l?(n.value="percent",a.value=h):S>0?(n.value="amount",a.value=S):h>0?(n.value="percent",a.value=h):(n.value="amount",a.value=0),V()}}async function Ut(){const e=me();if(!e)return;const r=document.querySelector("#hardwareModal");if(!r)return;const l=e.querySelector('[name="set_style"]'),o=l?l.value:null,t=o==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà",n=o==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",a=o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",s=r.querySelector("#trackColorGroup"),c=r.querySelector("#bracketColorGroup"),d=r.querySelector("#finialColorGroup"),i=r.querySelector("#grommetColorGroup"),f=r.querySelector("#louisValanceGroup"),u=r.querySelector("#louisTasselGroup"),p=r.querySelector("#hardwareApplyToRoom");r.querySelector('[name="modal_track_color"]').value=e.querySelector('[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",r.querySelector('[name="modal_bracket_color"]').value=e.querySelector('[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",r.querySelector('[name="modal_finial_color"]').value=e.querySelector('[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",r.querySelector('[name="modal_grommet_color"]').value=e.querySelector('[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",r.querySelector('[name="modal_louis_valance"]').value=e.querySelector('[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",r.querySelector('[name="modal_louis_tassels"]').value=e.querySelector('[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",s&&(s.style.display=""),c&&(c.style.display=""),d&&(d.style.display=t?"":"none"),i&&(i.style.display=t?"":"none"),f&&(f.style.display=a?"":"none"),u&&(u.style.display=a?"":"none"),p&&(p.disabled=n||a);const g=await O("#hardwareModal");g&&!g.cancelled&&(e.querySelector('[name="track_color"]').value=r.querySelector('[name="modal_track_color"]').value,e.querySelector('[name="bracket_color"]').value=r.querySelector('[name="modal_bracket_color"]').value,t?(e.querySelector('[name="finial_color"]').value=r.querySelector('[name="modal_finial_color"]').value,e.querySelector('[name="grommet_color"]').value=r.querySelector('[name="modal_grommet_color"]').value):a&&(e.querySelector('[name="louis_valance"]').value=r.querySelector('[name="modal_louis_valance"]').value,e.querySelector('[name="louis_tassels"]').value=r.querySelector('[name="modal_louis_tassels"]').value),X(),$("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß","success"))}async function Jt(e){if(!e)return;ht(e);const r=document.querySelector(m.roomDefaultsModal),l=document.querySelector(m.roomDefaultsForm);if(!r||!l)return;yt().forEach(({element:c,event:d,handler:i})=>{c.removeEventListener(d,i)}),_t();const o=JSON.parse(e.dataset.roomDefaults||"{}"),t=r.querySelectorAll(".defaults-tab"),n=r.querySelectorAll(".defaults-content"),a=c=>{const d=c.currentTarget,i=d.dataset.target;if(!i)return;t.forEach(u=>u.classList.remove("is-active")),n.forEach(u=>u.classList.remove("is-active")),d.classList.add("is-active");const f=r.querySelector(`.defaults-content[data-type="${i}"]`);f&&f.classList.add("is-active")};t.forEach(c=>{c.addEventListener("click",a),we({element:c,event:"click",handler:a})}),t[0]&&t[0].classList.add("is-active"),n[0]&&n[0].classList.add("is-active");const s=c=>{const d=c.target,i=d.closest(".defaults-content");if(!i)return;const f=d.checked,u=i.querySelector(".defaults-inputs-grid");i.classList.toggle("is-enabled-content",f),u&&u.querySelectorAll('input[type="text"], input[type="number"], select, .btn-show-favs').forEach(p=>{p.disabled=!f,p.matches(".btn-show-favs")&&(p.style.opacity=f?"1":"0.5",p.style.pointerEvents=f?"auto":"none")})};n.forEach(c=>{const d=c.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(!d)return;const i=d.name,f=o[i]===!0||o[i]==="1";d.checked=f,s({target:d}),d.addEventListener("change",s),we({element:d,event:"change",handler:s});const u=c.querySelector(".defaults-inputs-grid");u&&u.querySelectorAll('input[type="text"], input[type="number"]').forEach(p=>{const g=p.name,y=o[g];p.type==="text"&&p.inputMode==="numeric"?(p.value=y===0?"0":y!=null&&y>0?A(y):"",p.addEventListener("focus",tt),p.addEventListener("blur",ot),we({element:p,event:"focus",handler:tt}),we({element:p,event:"blur",handler:ot})):p.value=y||""})}),await O(m.roomDefaultsModal)}function Yt(){const e=mt();if(!e)return;const r=document.querySelector(m.roomDefaultsForm);if(!r)return;const l={};r.querySelectorAll(".defaults-content").forEach(t=>{const n=t.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(n){const a=n.name,s=n.checked;if(l[a]=s,s){const c=t.querySelector(".defaults-inputs-grid");c&&c.querySelectorAll('input[type="text"], input[type="number"]').forEach(d=>{const i=d.name,f=d.value.trim();let u;d.type==="text"&&d.inputMode==="numeric"?f===""?u=void 0:u=_(f):u=f,(typeof u=="number"&&!isNaN(u)||typeof u=="string"&&u!=="")&&(l[i]=u)})}}}),e.dataset.roomDefaults=JSON.stringify(l),X();const o=document.querySelector(m.roomDefaultsModal);o&&typeof o.closeModal=="function"?(o.closeModal(!0),setTimeout(()=>$("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"),50)):console.error("Could not find room defaults modal or its closer function.")}async function Qt(){const e=mt();if(!e)return;const r=document.querySelector(m.roomDefaultsModal),l=document.querySelector(m.roomDefaultsForm);if(!r||!l)return;const o={};if(l.querySelectorAll(".defaults-content").forEach(a=>{const s=a.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(s&&s.checked){const c=a.querySelector(".defaults-inputs-grid");c&&c.querySelectorAll('input[type="text"], input[type="number"]').forEach(d=>{const i=d.name,f=d.type==="text"&&d.inputMode==="numeric"?_(d.value):d.value.trim();(typeof f=="number"&&!isNaN(f)||typeof f=="string"&&f!=="")&&(o[i]=f)})}}),Object.keys(o).length===0){$("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ","warning");return}if(!await te("‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô","‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà *‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ* ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?"))return;re(W()),Z();let t=0;e.getItemsContainer().querySelectorAll(".item-card").forEach(a=>{const s=a.dataset.type;let c=!1;const d=(i,f)=>{const u=o[f],p=a.querySelector(i);if(!p||u==null)return;const g=p.tagName==="SELECT",y=g?p.value:p.value.trim(),h=g?null:_(y);let S=!1;if(g?S=!y:p.matches('input[type="text"][inputmode="numeric"]')?S=!y||h===0:S=!y,S){let M=!1;g?Array.from(p.options).some(B=>B.value==u)&&(p.value=u,M=!0):p.matches('input[type="text"][inputmode="numeric"]')?typeof u=="number"&&!isNaN(u)&&(p.value=u===0?"0":A(u),M=!0):p.matches('input[type="text"]:not([inputmode])')&&(p.value=u,M=!0),M&&(c=!0,p.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),p.matches('input[type="text"][inputmode="numeric"]')&&p.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0})))}};switch(s){case"set":d(m.setFabricCodeInput,"defaults_fabric_code"),d(m.setPricePerMSelect,"defaults_fabric_price"),d(m.setSheerCodeInput,"defaults_sheer_code"),d(m.setSheerPricePerMSelect,"defaults_sheer_price");break;case"wallpaper":d(m.wallCodeInput,"defaults_wallpaper_code"),d(m.wallPriceRollInput,"defaults_wallpaper_price_roll"),d(m.wallInstallCostInput,"defaults_wallpaper_install_cost");break;case"wooden_blind":d(m.areaCodeInput,"defaults_wooden_blind_code"),d(m.areaPriceSqydInput,"defaults_wooden_blind_price_sqyd");break;case"roller_blind":d(m.areaCodeInput,"defaults_roller_blind_code"),d(m.areaPriceSqydInput,"defaults_roller_blind_price_sqyd");break;case"vertical_blind":d(m.areaCodeInput,"defaults_vertical_blind_code"),d(m.areaPriceSqydInput,"defaults_vertical_blind_price_sqyd");break;case"partition":d(m.areaCodeInput,"defaults_partition_code"),d(m.areaPriceSqydInput,"defaults_partition_price_sqyd");break;case"pleated_screen":d(m.areaCodeInput,"defaults_pleated_screen_code"),d(m.areaPriceSqydInput,"defaults_pleated_screen_price_sqyd");break;case"aluminum_blind":d(m.areaCodeInput,"defaults_aluminum_blind_code"),d(m.areaPriceSqydInput,"defaults_aluminum_blind_price_sqyd");break}c&&t++}),r&&typeof r.closeModal=="function"?r.closeModal({cancelled:!0}):console.error("Could not find room defaults modal or its closer function."),setTimeout(()=>{t>0?(V(),$(`‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ö ${t} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß`,"success")):$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï","default")},50)}async function Kt(){const e=document.querySelector("#forceApplyModal");if(!e)return;const r=e.querySelector('[name="force_apply_type_hidden"]'),l=e.querySelector("#forceApplySelectedTypeDisplay"),o=e.querySelector('[name="force_apply_code"]'),t=e.querySelector('[name="force_apply_price"]'),n=o?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs");r&&(r.value=""),l&&(l.textContent="-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --"),o&&(o.value="",o.dataset.favoriteType=""),t&&(t.value=""),n&&(n.disabled=!0),await O("#forceApplyModal")}async function Xt(){const e=document.querySelector("#forceApplyModal");if(!e)return;const r=e.querySelector('[name="force_apply_type_hidden"]'),l=e.querySelector('[name="force_apply_code"]'),o=e.querySelector('[name="force_apply_price"]'),t=r.value,n=l.value.trim(),a=_(o.value);if(!t){$("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),e.querySelector("#forceApplySelectTypeBtn")?.focus();return}if(!n){$("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),l.focus();return}if(a<0||a<=0&&!["fabric","sheer","wallpaper"].includes(t)){$("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (> 0)","warning"),o.focus();return}const s=e.querySelector("#forceApplySelectedTypeDisplay");let c=s?s.textContent:t;const d="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ",i=`‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏õ‡πá‡∏ô "${n}" ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ${A(a)} ‡∏ö‡∏≤‡∏ó ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${c}" ***‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£*** ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ`;if(!await te(d,i))return;re(W()),Z();let f=0;document.querySelectorAll(".item-card").forEach(p=>{if(p.classList.contains("placeholder-item"))return;const g=p.dataset.type;let y=null,h=null;if(t==="fabric"&&g==="set"?(y=p.querySelector('input[name="fabric_code"]'),h=p.querySelector('select[name="set_price_per_m"]')):t==="sheer"&&g==="set"?(y=p.querySelector('input[name="sheer_fabric_code"]'),h=p.querySelector('select[name="sheer_price_per_m"]')):t==="wallpaper"&&g==="wallpaper"?(y=p.querySelector('input[name="wallpaper_code"]'),h=p.querySelector('input[name="wallpaper_price_roll"]')):g===t&&p.matches(".area-based-item")&&(y=p.querySelector('input[name="area_code"]'),h=p.querySelector('input[name="area_price_sqyd"]')),y&&h){if(y.value=n,y.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),h.tagName==="SELECT")if(Array.from(h.options).some(M=>M.value==a))h.value=a;else{if(console.warn(`Price ${a} not found in options for`,h,". Forcing new option."),!h.querySelector(`option[value="${a}"][data-forced="true"]`)){const B=document.createElement("option");B.value=a,B.textContent=a===0?"0 ‡∏ö‡∏≤‡∏ó":`${A(a)} ‡∏ö‡∏≤‡∏ó (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)`,B.dataset.forced="true",h.appendChild(B)}h.value=a}else{const S=a===0?"0":a!=null&&a>0?A(a):"";h.value=S}h.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),h.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0})),f++,y.classList.add("input-highlight"),h.classList.add("input-highlight"),setTimeout(()=>{y.classList.remove("input-highlight"),h.classList.remove("input-highlight")},1200)}}),f>0?(V(),$(`‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏±‡∏ö ${f} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${c}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,"success"),e&&typeof e.closeModal=="function"&&e.closeModal({cancelled:!0})):$(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${c}" ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï`,"default")}async function lt(e,r=null){const l=document.querySelector("#itemTypeModal");if(!l)return null;l.querySelector("#itemTypeModalTitle").textContent=e;let o=r||"set";r&&!H[r]&&(o="set");const t=l.querySelector(`input[name="item_type_option"][value="${o}"]`);if(t)t.checked=!0;else{const s=l.querySelector('input[name="item_type_option"][value="set"]');s&&(s.checked=!0)}const n=await O("#itemTypeModal");if(!n||n.cancelled)return null;const a=l.querySelector('input[name="item_type_option"]:checked');return a?a.value:null}function Ze(){const e=document.createElement("div");return e.className="dimension-input-row",e.innerHTML=`
        <div class="form-group">
            <label class="visually-hidden">‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°.)</label>
            <input type="number" step="0.01" inputmode="decimal" name="modal_width_m" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á">
        </div>
        <div class="form-group">
            <label class="visually-hidden">‡∏™‡∏π‡∏á (‡∏°.)</label>
            <input type="number" step="0.01" inputmode="decimal" name="modal_height_m" placeholder="‡∏™‡∏π‡∏á">
        </div>
        <button type="button" class="btn-icon btn-icon-small danger btn-remove-dimension-row" data-act="remove-dimension-row" title="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î" aria-label="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ"><i class="ph-bold ph-x"></i></button>
    `,e.querySelectorAll('input[type="number"]').forEach(r=>{r.addEventListener("blur",l=>{l.target.value=Y(l.target.value)})}),e}function de(e={}){const r=document.querySelector(m.roomsContainer);if(!r)return null;Object.keys(e).length===0&&(re(W()),Z());const l=st(e);return l?(r.appendChild(l),Object.keys(e).length===0&&(l.classList.add("item-created"),fe(l),l.querySelector('input[name="room_name"]')?.focus()),Ae(),ae(),ge(),Object.keys(e).length===0&&X(),l):null}function zt(e,r){if(!r||!e||e.width_m<=0||e.height_m<=0)return;const l=r.getItemsContainer();if(!l)return;const o=document.querySelector("#placeholderItemTpl");if(!o)return console.error("Placeholder template not found"),null;const n=o.content.cloneNode(!0).firstElementChild;n.dataset.widthM=e.width_m,n.dataset.heightM=e.height_m;const a=n.querySelector("[data-placeholder-width]"),s=n.querySelector("[data-placeholder-height]");return a&&(a.textContent=Y(e.width_m)),s&&(s.textContent=Y(e.height_m)),l.appendChild(n),n.classList.add("item-created"),n}function Zt(e,r,l){if(!e||!r||!l)return;const o=e.closest(m.room);if(!o)return;re(W()),Z();const t=JSON.parse(o.dataset.roomDefaults||"{}");let n={width_m:l.width_m,height_m:l.height_m};const a=c=>t[`enable_defaults_${c}`]===!0;switch(r){case"set":a("set")&&(n.fabric_code=t.defaults_fabric_code,n.price_per_m_raw=t.defaults_fabric_price,n.sheer_fabric_code=t.defaults_sheer_code,n.sheer_price_per_m=t.defaults_sheer_price);break;case"wallpaper":a("wallpaper")&&(n.wallpaper_code=t.defaults_wallpaper_code,n.price_per_roll=t.defaults_wallpaper_price_roll,n.install_cost_per_roll=t.defaults_wallpaper_install_cost),delete n.width_m;break;case"wooden_blind":a("wooden_blind")&&(n.code=t.defaults_wooden_blind_code,n.price_sqyd=t.defaults_wooden_blind_price_sqyd);break;case"roller_blind":a("roller_blind")&&(n.code=t.defaults_roller_blind_code,n.price_sqyd=t.defaults_roller_blind_price_sqyd);break;case"vertical_blind":a("vertical_blind")&&(n.code=t.defaults_vertical_blind_code,n.price_sqyd=t.defaults_vertical_blind_price_sqyd);break;case"partition":a("partition")&&(n.code=t.defaults_partition_code,n.price_sqyd=t.defaults_partition_price_sqyd);break;case"pleated_screen":a("pleated_screen")&&(n.code=t.defaults_pleated_screen_code,n.price_sqyd=t.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":a("aluminum_blind")&&(n.code=t.defaults_aluminum_blind_code,n.price_sqyd=t.defaults_aluminum_blind_price_sqyd);break}let s;if(r==="set")s=Le(n);else if(r==="wallpaper")s=Ce(n);else if(H[r]?.templateId==="#areaBasedTpl")s=Be(r,n);else{$(`‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${r}`,"error");return}s&&(e.replaceWith(s),s.classList.add("item-created"),fe(s),s.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),V(),$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${H[r]?.name||"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"} ‡πÅ‡∏•‡πâ‡∏ß`,"success"))}async function eo(e){if(!e||e.classList.contains("placeholder-item"))return;const r=e.dataset.type,l=await lt("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",r);if(!l||l===r||!await te("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;re(W()),Z();const o={width_m:_(e.querySelector('input[name$="_width_m"], input[name="width_m"]')?.value),height_m:_(e.querySelector('input[name$="_height_m"], input[name="height_m"]')?.value)};r==="wallpaper"&&(o.height_m=_(e.querySelector(m.wallHeightInput)?.value));const t=e.closest(m.room),n=JSON.parse(t?.dataset.roomDefaults||"{}");let a={width_m:o.width_m>0?o.width_m:void 0,height_m:o.height_m>0?o.height_m:void 0};const s=d=>n[`enable_defaults_${d}`]===!0;switch(l){case"set":s("set")&&(a.fabric_code=n.defaults_fabric_code,a.price_per_m_raw=n.defaults_fabric_price,a.sheer_fabric_code=n.defaults_sheer_code,a.sheer_price_per_m=n.defaults_sheer_price);break;case"wallpaper":s("wallpaper")&&(a.wallpaper_code=n.defaults_wallpaper_code,a.price_per_roll=n.defaults_wallpaper_price_roll,a.install_cost_per_roll=n.defaults_wallpaper_install_cost),delete a.width_m,a.height_m=o.height_m>0?o.height_m:void 0;break;case"wooden_blind":s("wooden_blind")&&(a.code=n.defaults_wooden_blind_code,a.price_sqyd=n.defaults_wooden_blind_price_sqyd);break;case"roller_blind":s("roller_blind")&&(a.code=n.defaults_roller_blind_code,a.price_sqyd=n.defaults_roller_blind_price_sqyd);break;case"vertical_blind":s("vertical_blind")&&(a.code=n.defaults_vertical_blind_code,a.price_sqyd=n.defaults_vertical_blind_price_sqyd);break;case"partition":s("partition")&&(a.code=n.defaults_partition_code,a.price_sqyd=n.defaults_partition_price_sqyd);break;case"pleated_screen":s("pleated_screen")&&(a.code=n.defaults_pleated_screen_code,a.price_sqyd=n.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":s("aluminum_blind")&&(a.code=n.defaults_aluminum_blind_code,a.price_sqyd=n.defaults_aluminum_blind_price_sqyd);break}let c;if(l==="set")c=Le(a);else if(l==="wallpaper")c=Ce(a);else if(H[l]?.templateId==="#areaBasedTpl")c=Be(l,a);else return;c&&(e.replaceWith(c),c.classList.add("item-created"),fe(c),c.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),V(),$("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}function to(e){if(!e||!e.matches(m.itemCard)||e.classList.contains("placeholder-item"))return null;const r=e.dataset.type;if(!r)return null;let l={type:r,is_suspended:e.classList.contains("is-suspended")};try{if(r==="set")Object.assign(l,{width_m:_(e.querySelector(m.setWidthInput)?.value),height_m:_(e.querySelector(m.setHeightInput)?.value),style:e.querySelector(m.setStyleSelect)?.value||"",fabric_variant:e.querySelector(m.setFabricVariantSelect)?.value||"",price_per_m_raw:_(e.querySelector(m.setPricePerMSelect)?.value),sheer_price_per_m:_(e.querySelector(m.setSheerPricePerMSelect)?.value),louis_price_per_m:_(e.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:e.querySelector(m.setFabricCodeInput)?.value||"",sheer_fabric_code:e.querySelector(m.setSheerCodeInput)?.value||"",opening_style:e.querySelector(m.setOpeningStyleSelect)?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",adjustment_side:e.querySelector(m.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:e.querySelector('input[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:e.querySelector('input[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:e.querySelector('input[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:e.querySelector('input[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:e.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:e.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:e.querySelector(m.setNotesInput)?.value||""});else if(r==="wallpaper"){const o=e.querySelector(m.wallInstallCostInput),t=o?o.value:"";let n;t==="0"?n=0:_(t)>0?n=_(t):n=void 0,Object.assign(l,{height_m:_(e.querySelector(m.wallHeightInput)?.value),wallpaper_code:e.querySelector(m.wallCodeInput)?.value||"",price_per_roll:_(e.querySelector(m.wallPriceRollInput)?.value),install_cost_per_roll:n,notes:e.querySelector(m.wallNotesInput)?.value||"",widths:Array.from(e.querySelectorAll(m.wallWidthInput)).map(a=>_(a.value))})}else e.matches(m.areaBasedItem)&&(Object.assign(l,{width_m:_(e.querySelector(m.areaWidthInput)?.value),height_m:_(e.querySelector(m.areaHeightInput)?.value),price_sqyd:_(e.querySelector(m.areaPriceSqydInput)?.value),code:e.querySelector(m.areaCodeInput)?.value||"",notes:e.querySelector(m.areaNotesInput)?.value||""}),(r==="partition"||r==="pleated_screen")&&(l.opening_style=e.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(r)&&(l.adjustment_side=e.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));return l}catch(o){return console.error("Failed to extract item data:",o,e),null}}function oo(e){if(!e)return;const r=e.closest(m.room);if(!r||!r.getItemsContainer())return;re(W()),Z();let o;if(e.classList.contains("placeholder-item")){const t=document.querySelector("#placeholderItemTpl");if(t){o=t.content.cloneNode(!0).firstElementChild,o.dataset.widthM=e.dataset.widthM,o.dataset.heightM=e.dataset.heightM;const a=o.querySelector("[data-placeholder-width]"),s=o.querySelector("[data-placeholder-height]");a&&(a.textContent=Y(e.dataset.widthM)),s&&(s.textContent=Y(e.dataset.heightM)),e.classList.contains("is-suspended")&&o.classList.add("is-suspended")}else{$("‡πÑ‡∏°‡πà‡∏û‡∏ö Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder","error");return}}else{const t=to(e);if(!t){$("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ","error");return}if(t.type==="set")o=Le(t);else if(t.type==="wallpaper")o=Ce(t);else if(H[t.type]?.templateId==="#areaBasedTpl")o=Be(t.type,t);else{$("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","error");return}}if(o){if(e.after(o),o.classList.add("item-created"),!o.classList.contains("placeholder-item")){const t=e.querySelector(m.itemDetailsMore);t&&t.classList.contains("show")&&xe(o,!0)}fe(o),oe(),V(),$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success")}}function ao(e){const{roomId:r,itemIndex:l}=e.dataset;if(!r||l===void 0)return;const o=document.getElementById("lookbookModal");o&&typeof o.closeModal=="function"&&o.closeModal({cancelled:!0});const t=document.getElementById(r);if(!t){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}const a=Array.from(t.querySelectorAll(".item-card:not(.item-hidden)"))[parseInt(l,10)];if(!a){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}t.open=!0,ae(),setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("scrolling-jump"),setTimeout(()=>a.classList.remove("scrolling-jump"),2500)},150)}async function ro(){const e=document.querySelector("#manageFavsTypeModal"),r=document.querySelector("#manageFavsTypeBody");if(!e||!r)return;const l=Object.keys(le());let o="",t=null;const n={fabric:"ph-rows",sheer:"ph-waves",wallpaper:"ph-paint-roller",wooden_blind:"ph-table",roller_blind:"ph-scroll",vertical_blind:"ph-sidebar-simple",partition:"ph-columns",pleated_screen:"ph-squares-four",aluminum_blind:"ph-stack-simple"};if(l.includes("fabric")&&(o+=`
             <label data-item-type="fabric">
                 <input type="radio" name="manage_fav_type_option" value="fabric">
                 <span class="radio-card-content">
                     <strong><i class="ph ${n.fabric}"></i> ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö</strong>
                     <small>Fabric Codes</small>
                 </span>
             </label>`,t||(t="fabric")),l.includes("sheer")&&(o+=`
              <label data-item-type="sheer">
                  <input type="radio" name="manage_fav_type_option" value="sheer">
                  <span class="radio-card-content">
                      <strong><i class="ph ${n.sheer}"></i> ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</strong>
                      <small>Sheer Codes</small>
                  </span>
              </label>`,t||(t="sheer")),l.forEach(s=>{if(s==="fabric"||s==="sheer")return;const c=H[s];if(c){const d=c.name,i=n[s]||"ph-star";o+=`
                <label data-item-type="${s}">
                    <input type="radio" name="manage_fav_type_option" value="${s}">
                    <span class="radio-card-content">
                        <strong><i class="ph ${i}"></i> ${I(d)}</strong>
                        <small>${s.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase())} Codes</small>
                    </span>
                </label>`,t||(t=s)}}),r.innerHTML=o,t){const s=r.querySelector(`input[value="${t}"]`);s&&(s.checked=!0)}const a=await O("#manageFavsTypeModal");if(a&&!a.cancelled){const s=r.querySelector('input[name="manage_fav_type_option"]:checked')?.value;s&&await ct(s)}}function no(e){const r=io();if(!r)return;const l=r.closest("#roomDefaultsModal"),o=r.closest(".item-card"),t=r.closest("#forceApplyModal");let n=r,a=null;const s=n.dataset.favoriteType,c=e.dataset.code,d=_(e.dataset.price);if(o){let u;s==="fabric"?u="set_price_per_m":s==="sheer"?u="sheer_price_per_m":s==="wallpaper"?u="wallpaper_price_roll":u="area_price_sqyd",a=o.querySelector(`[name="${u}"]`)}else if(l){const u=n.closest(".defaults-inputs-grid");if(u){let p;s==="fabric"?p="defaults_fabric_price":s==="sheer"?p="defaults_sheer_price":s==="wallpaper"?p="defaults_wallpaper_price_roll":s==="wooden_blind"?p="defaults_wooden_blind_price_sqyd":s==="roller_blind"?p="defaults_roller_blind_price_sqyd":s==="vertical_blind"?p="defaults_vertical_blind_price_sqyd":s==="partition"?p="defaults_partition_price_sqyd":s==="pleated_screen"?p="defaults_pleated_screen_price_sqyd":s==="aluminum_blind"&&(p="defaults_aluminum_blind_price_sqyd"),p&&(a=u.querySelector(`[name="${p}"]`))}}else t&&(a=t.querySelector('[name="force_apply_price"]'));const i=a;n.value=c,n.classList.add("input-highlight"),setTimeout(()=>{n&&n.classList.remove("input-highlight")},1200),i&&d>=0&&(i.tagName==="SELECT"?Array.from(i.options).some(u=>_(u.value)===d)?i.value=d:$(`‡∏£‡∏≤‡∏Ñ‡∏≤ ${A(d)} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`,"warning"):i.value=d===0?"0":d>0?A(d):"",i.classList.add("input-highlight"),setTimeout(()=>{i&&i.classList.remove("input-highlight")},1200)),o?((i||n).dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),i&&i.matches('input[inputmode="numeric"]')&&i.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}))):(l||t)&&i&&i.matches('input[inputmode="numeric"]')&&i.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}));const f=document.querySelector("#favoritesModal");f&&typeof f.closeModal=="function"&&f.closeModal({cancelled:!1,applied:!0})}async function so(e){if(!e||!e.dataset.favoriteType){console.warn("showFavoritesModal called without a valid input element or favorite type.");return}je(e);const r=e.dataset.favoriteType;if(!r){$("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô","warning");const g=e.closest("#forceApplyModal");g&&g.querySelector("#forceApplySelectTypeBtn")?.focus(),je(null);return}const l=document.querySelector("#favoritesModal"),o=l.querySelector("#favoritesModalTitle"),t=l.querySelector("#favoritesModalBody"),n=l.querySelector("#favSearchInput"),a=l.querySelector('[data-act="manage-favorites"]'),s=document.querySelector("#favSelectorItemTpl");if(!l||!o||!t||!n||!a||!s){console.error("Missing elements for favorites modal");return}let c=H[r]?.name||r;r==="fabric"?c="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":r==="sheer"&&(c="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),o.textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '${I(c)}'`;const d=()=>{const y=le()[r]||[];y.length>0?t.innerHTML=y.map(h=>{let S="-";return h.price>=0&&(S=A(h.price)),s.innerHTML.replace(/{CODE}/g,I(h.code)).replace(/{PRICE}/g,S).replace(/{RAW_PRICE}/g,h.price)}).join(""):t.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>',n.value=""};d();const i=()=>{const g=n.value.toLowerCase();t.querySelectorAll(".fav-selector-item").forEach(y=>{const h=y.dataset.code.toLowerCase();y.classList.toggle("is-hidden",!h.includes(g))})},f=g=>{const y=g.target.closest(".fav-selector-item");y&&no(y)},u=async()=>{await ct(r),co()&&d()},p=()=>{n.removeEventListener("input",i),t.removeEventListener("click",f),a&&(a.onclick=null)};n.addEventListener("input",i),t.addEventListener("click",f),a.onclick=u,await O("#favoritesModal",p)}function $e(e){const r=document.querySelector("#favManagerBody"),l=document.querySelector("#favManagerItemTpl"),t=le()[e]||[];if(!r||!l)return;t.length===0?r.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':r.innerHTML=t.map(s=>{let c="-";return s.price>=0&&(c=A(s.price)),l.innerHTML.replace(/{CODE}/g,I(s.code)).replace(/{PRICE}/g,c).replace(/{RAW_PRICE}/g,s.price)}).join(""),Me(null);const n=document.querySelector('#favManagerModal [data-act="edit-selected-fav"]'),a=document.querySelector('#favManagerModal [data-act="del-selected-fav"]');n&&(n.disabled=!0),a&&(a.disabled=!0)}async function ct(e){const r=document.querySelector("#favManagerModal");if(!r||!e)return;let l=H[e]?.name||e;e==="fabric"?l="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":e==="sheer"&&(l="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),r.dataset.currentType=e,ke(!1),Me(null),document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${I(l)}'`,$e(e),await O("#favManagerModal")}const j=[];let z=!1,Se=null,ue=null;const et=document.querySelector("#undoBtn"),Oe="marnthara.theme";let it=null;const me=()=>it,lo=e=>{it=e};let dt=!1;const co=()=>dt,ke=e=>{dt=e};let ut=null;const K=()=>ut,Me=e=>{ut=e};let pt=null;const io=()=>pt,je=e=>{pt=e};let ft=null;const mt=()=>ft,ht=e=>{ft=e};let Ge=[];const yt=()=>Ge,_t=()=>{Ge=[]},we=e=>{Ge.push(e)},qe={};function uo(e){if(qe[e])return qe[e];const r=new Promise((l,o)=>{const t=document.createElement("script");t.src=e,t.onload=()=>l(),t.onerror=()=>{console.error(`Script load error for ${e}`),delete qe[e],o(new Error(`Script load error for ${e}`))},document.head.appendChild(t)});return qe[e]=r,r}function vt(){const e=localStorage.getItem(Oe),r=document.querySelector("#themeToggleBtn");if(!r)return;const l=r.querySelector("i"),o=r.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),l&&(l.className="ph-fill ph-sun"),o&&(o.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),l&&(l.className="ph-fill ph-moon"),o&&(o.textContent=" ‡∏°‡∏∑‡∏î");break;default:l&&(l.className="ph-fill ph-palette"),o&&(o.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function po(){const e=localStorage.getItem(Oe);let r="neutral";!e||e==="light"?r="neutral":e==="neutral"?r="dark":r="light",localStorage.setItem(Oe,r),vt()}function Z(){et&&(et.disabled=!Ct())}function fo(){const e=Lt();e&&(Ue(e,!1),$("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),Z()}function pe(){const e=document.getElementById("suspendedItemsBtn");if(!e)return;if(ue){e.classList.remove("is-visible");return}const r=document.getElementById("suspendedCountBadge"),l=document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length,o=document.querySelectorAll(".room-card.is-suspended");let t=0;o.forEach(a=>{t+=a.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").length});const n=l+t;r&&(r.textContent=n),e.classList.toggle("is-visible",n>0)}function De(){ue="suspended";const e=document.getElementById("filterStatusBar");let r=0;if(document.querySelectorAll(".room-card").forEach(o=>{let t=!1;const n=o.classList.contains("is-suspended");o.querySelectorAll(".item-card").forEach(s=>{const d=s.classList.contains("is-suspended")||n;s.classList.toggle("item-hidden",!d),d&&(t=!0,s.classList.contains("placeholder-item")||r++)});const a=n||t;o.classList.toggle("item-hidden",!a)}),document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length+Array.from(document.querySelectorAll(".room-card.is-suspended .item-card:not(.is-suspended):not(.placeholder-item)")).length===0){gt(),$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success");return}e&&(e.innerHTML=`
            <span><i class="ph ph-warning"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö (${r} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,e.classList.add("is-visible"),e.dataset.filterType="suspended"),oe(),ae(),pe()}function mo(e,r){if(!e)return;ue=e;const l=document.getElementById("filterStatusBar");let o=0;document.querySelectorAll(m.room).forEach(t=>{let n=0;t.querySelectorAll(".item-card").forEach(a=>{const s=a.dataset.type===e&&!a.classList.contains("placeholder-item");a.classList.toggle("item-hidden",!s),s&&n++}),t.querySelectorAll(".placeholder-item").forEach(a=>a.classList.toggle("item-hidden",n===0)),t.classList.toggle("item-hidden",n===0),n>0&&(o+=n)}),l&&(l.innerHTML=`
            <span>‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${I(r)}</strong> (${o} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,l.classList.add("is-visible"),l.dataset.filterType=e),oe(),ae(),pe()}function gt(){ue=null;const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(r=>r.classList.remove("item-hidden")),oe(),ae(),pe()}function $(e,r="default"){const l=document.querySelector(m.toastContainer);if(!l)return;const o={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},t=document.createElement("div");t.className=`toast toast-${r}`,t.innerHTML=`<i class="${o[r]||o.default}"></i> ${I(e)}`,l.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),t.addEventListener("transitionend",()=>t.remove())},3e3)}function O(e,r){return new Promise(l=>{const o=document.querySelector(e);if(!o){console.error("Modal not found:",e),l(null);return}if(j.length>0){const u=j[j.length-1];u&&u.classList.contains("visible")&&u.classList.add("is-underlay")}j.push(o),o.classList.add("visible");const t=o.querySelector('[id$="Confirm"]'),n=o.querySelector('[id$="Cancel"], [data-act="close-modal"], #roomDefaultsCancelBtn, #manageFavsTypeCancel, #forceApplyCancel, #forceApplyTypeCancel, #dimensionEntryCancel'),a=Array.from(o.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(u=>!u.disabled&&u.offsetParent!==null),s=a[0],c=a[a.length-1];setTimeout(()=>s?.focus(),50);const d=u=>{o.classList.remove("visible"),document.removeEventListener("keydown",i),o.removeEventListener("click",f),t&&(t.onclick=null),n&&(n.onclick=null),o.closeModal===d&&(o.closeModal=null);const p=j.pop();p!==o&&(console.error(`[cleanup] Modal stack mismatch! Expected #${o.id}, but popped #${p?.id}. Resetting stack.`),j.length=0);const g=j.length>0?j[j.length-1]:null;g&&g.classList.contains("visible")&&g.classList.remove("is-underlay"),e==="#roomDefaultsModal"&&(yt().forEach(({element:y,event:h,handler:S})=>{y.removeEventListener(h,S)}),_t(),ht(null)),e==="#favoritesModal"&&je(null),u?.cancelled&&typeof r=="function"&&r(),l(u)};o.closeModal=d;const i=u=>{const p=j.length>0&&j[j.length-1]===o;u.key==="Escape"&&p&&d({cancelled:!0}),u.key==="Tab"&&a.length>1&&(u.shiftKey?document.activeElement===s&&(c.focus(),u.preventDefault()):document.activeElement===c&&(s.focus(),u.preventDefault()))},f=u=>{const p=j.length>0&&j[j.length-1]===o;u.target===o&&p&&(u.stopPropagation(),d({cancelled:!0}))};t&&(t.onclick=()=>d(!0)),n&&(n.onclick=()=>{j.length>0&&j[j.length-1]===o&&d({cancelled:!0})}),document.addEventListener("keydown",i),o.addEventListener("click",f)})}async function te(e,r){const l=document.querySelector(m.modal);return l?(l.querySelector(m.modalTitle).textContent=e,l.querySelector(m.modalBody).textContent=r,await O(m.modal)===!0):!0}function tt(e){e.target.value!=="0"&&_(e.target.value)>0&&(e.target.value=_(e.target.value))}function ot(e){const r=_(e.target.value);e.target.value=r===0?"0":r!=null&&r>0?A(r):""}function Fe(e,r){e&&(re(W()),Z(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),$(r),Ae(),oe(),V(),ge()},{once:!0}))}function ho(e){if(!e)return;const r=document.querySelector(".main-header");if(!r){e.scrollIntoView({behavior:"smooth",block:"center"});return}const l=r.offsetHeight,o=16,n=(e.querySelector(".item-header")||e).getBoundingClientRect(),a=l+o,s=n.top-a;Math.abs(s)>5&&window.scrollBy({top:s,behavior:"smooth"})}function fe(e){if(!e)return;const r=document.querySelector(".main-header"),l=document.querySelector(".summary-footer"),o=r?r.offsetHeight+16:80,t=l?l.offsetHeight+16:100;requestAnimationFrame(()=>{const n=e.getBoundingClientRect(),a=window.innerHeight;if(!(n.top>=o&&n.bottom<=a-t)){const c=a-o-t,d=n.height>c?"start":"center";e.scrollIntoView({behavior:"smooth",block:d})}})}function oe(){document.querySelectorAll(m.room).forEach(e=>{const r=e.querySelectorAll(".item-card:not(.item-hidden)");let l=0;const o=Array.from(r).filter(t=>!t.classList.contains("is-suspended")&&!t.classList.contains("placeholder-item")).length;r.forEach(t=>{const n=t.querySelector("[data-item-title]");n&&(t.classList.contains("placeholder-item")?n.textContent="...":t.classList.contains("is-suspended")?n.textContent="-":(l++,n.textContent=`${l}/${o}`))}),e.querySelectorAll(".item-card.item-hidden").forEach(t=>{const n=t.querySelector("[data-item-title]");n&&(n.textContent="-")})})}function bt(){const e=document.querySelector(m.orderForm),r=document.querySelector(m.lockBtn);!e||!r||(e.classList.toggle("is-locked",z),r.classList.toggle("is-locked",z),r.querySelector("i").className=z?"ph-bold ph-lock-key":"ph ph-paw-print",e.querySelectorAll('input:not([type="hidden"]), select, textarea, button:not(.unlockable):not([data-act="toggle-more-details"]):not([data-act="collapse-room"])').forEach(l=>{!l.closest(".main-header")&&!l.closest(".summary-footer")&&!l.closest(".modal-wrapper")&&(l.disabled=z)}),document.querySelectorAll(".unlockable").forEach(l=>l.disabled=!1))}function yo(){z=!z,bt(),$(z?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",z?"warning":"success")}function ae(){const e=document.querySelectorAll(m.room+":not(.item-hidden)");if(e.length===0){const o=document.querySelector(m.toggleAllRoomsBtn);o&&(o.querySelector("i").className="ph ph-caret-down",o.querySelector("span").textContent="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");return}const r=[...e].some(o=>o.open),l=document.querySelector(m.toggleAllRoomsBtn);l&&(l.querySelector("i").className=r?"ph ph-caret-up":"ph ph-caret-down",l.querySelector("span").textContent=r?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}function _o(){const e=document.querySelectorAll(m.room+":not(.item-hidden)");if(e.length===0)return;const r=[...e].some(o=>o.open);e.forEach(o=>{o.open=!r});const l=document.querySelector(m.quickNavDropdown);l&&l.classList.contains("show")&&(l.classList.remove("show"),document.querySelector(m.quickNavBtn)?.setAttribute("aria-expanded","false")),setTimeout(()=>{ae(),X()},50)}function Ae(){const e=document.querySelector(m.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(m.room).forEach(r=>{const l=r.querySelector(m.roomNameInput)?.value||"‡∏´‡πâ‡∏≠‡∏á",o=document.createElement("a");o.href=`#${r.id}`,o.dataset.jumpTo=r.id,o.innerHTML=`<i class="ph ph-share-fat"></i> ${I(l)||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)"}`,e.appendChild(o)}))}function Ne(e){const r=document.getElementById("quickNavBtnText");r&&(e?r.textContent=e.querySelector('input[name="room_name"]')?.value||"...":r.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function ge(){if(Se&&Se.disconnect(),!document.getElementById("quickNavBtnText"))return;const r={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},l=t=>{const n=t.filter(a=>a.isIntersecting).sort((a,s)=>a.target.getBoundingClientRect().top-s.target.getBoundingClientRect().top);n.length>0&&Ne(n[0].target)};Se=new IntersectionObserver(l,r),document.querySelectorAll(m.room).forEach(t=>Se.observe(t));const o=Array.from(document.querySelectorAll(m.room));if(o.length>0){o.sort((n,a)=>n.getBoundingClientRect().top-a.getBoundingClientRect().top);const t=o.find(n=>n.getBoundingClientRect().bottom>60);Ne(t||o[0])}else Ne(null)}function xe(e,r=null){if(!e||e.classList.contains("placeholder-item"))return;const l=e.querySelector(".item-details-more"),o=e.querySelector('[data-act="toggle-more-details"]'),t=o?.parentElement;if(!l||!o||!t)return;const n=l.classList.contains("show"),a=r!==null?r:!n;if(n===a)return;l.classList.toggle("show",a),o.classList.toggle("expanded",a);const s=o.querySelector("i");s&&(s.className=a?"ph ph-caret-up":"ph ph-caret-down");const c=o.querySelector("span");if(c&&(c.textContent=a?"‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"),a)l.appendChild(t),setTimeout(()=>ho(e),100);else{const d=e.querySelector(".item-grid");d&&d.appendChild(t)}}const V=ve(()=>{let e=0;document.querySelectorAll(m.room).forEach(d=>{let i=0,f=0;const u=d.classList.contains("is-suspended");if(u||(d.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").forEach(p=>{const g=_(p.dataset.totalPrice);g>0&&(i+=g,f++)}),e+=i),typeof d.updateBrief=="function"){const p=d.querySelectorAll(".placeholder-item:not(.is-suspended)").length;if(u)d.updateBrief("(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)");else if(f>0){let g=`<span>${f}</span> &bull; ${A(i)} ‡∏ö‡∏≤‡∏ó`;p>0&&(g+=` (+${p} ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)`),d.updateBrief(g)}else p>0?d.updateBrief(`<span>${p}</span> ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó`):d.updateBrief("<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")}});const r=document.querySelector("#discount_type"),l=document.querySelector("#discount_value"),o=r?r.value:"amount",t=l?_(l.value):0;let n=0;t>0&&(n=o==="percent"?e*(t/100):t,n=Math.min(e,n));const a=e-n,s=document.querySelector("#grandTotal"),c=document.querySelector("#originalTotal");s&&(s.textContent=A(a)),c&&(n>0?(c.textContent=A(e),c.dataset.rawTotal=e,c.style.display="block"):(c.style.display="none",c.dataset.rawTotal="")),pe(),X()},200);async function Ue(e,r=!1){if(!e){$("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error");return}if(e.favorites)if(r){const d=document.querySelector("#favoritesConflictModal");if(d){const i=d.querySelector('input[name="fav_conflict_option"][value="merge"]');i&&(i.checked=!0);const f=await O("#favoritesConflictModal");if(!f||f.cancelled){$("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤","warning");return}const u=d.querySelector('input[name="fav_conflict_option"]:checked').value;let p=0;switch(u){case"overwrite":Je(e.favorites)&&$("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");break;case"merge":p=Re(e.favorites),$(`‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏° ${p} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)`,"success");break;case"skip":$("‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","default");break}}else Re(e.favorites)}else Je(e.favorites);const l=document.querySelector(m.roomsContainer);if(!l)return;l.innerHTML="";const o=document.querySelector("#customer_name"),t=document.querySelector("#customer_phone"),n=document.querySelector("#customer_address"),a=document.querySelector("#customerDetailsCard");o&&(o.value=e.customer_name||""),t&&(t.value=e.customer_phone||""),n&&(n.value=e.customer_address||""),a&&(a.open=e.customer_card_open??!0);const s=document.querySelector("#discount_type"),c=document.querySelector("#discount_value");if(e.discount&&s&&c?(s.value=e.discount.type||"amount",c.value=e.discount.value||0):s&&c&&(s.value="amount",c.value=0),!Array.isArray(e.rooms)){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","warning"),l.children.length===0&&de();return}for(const d of e.rooms){const i=st(d);if(!i)continue;l.appendChild(i);const f=i.getItemsContainer();if(f&&Array.isArray(d.items))for(const u of d.items){let p;if(u.type==="placeholder"){const g=document.querySelector("#placeholderItemTpl");if(g){p=g.content.cloneNode(!0).firstElementChild,p.dataset.widthM=u.width_m||0,p.dataset.heightM=u.height_m||0;const h=p.querySelector("[data-placeholder-width]"),S=p.querySelector("[data-placeholder-height]");h&&(h.textContent=Y(u.width_m)),S&&(S.textContent=Y(u.height_m)),u.is_suspended&&p.classList.add("is-suspended")}else{console.warn("Placeholder template not found during load.");continue}}else if(u.type==="set")p=Le(u);else if(u.type==="wallpaper")p=Ce(u);else if(H[u.type]?.templateId==="#areaBasedTpl")p=Be(u.type,u);else continue;p&&f.appendChild(p)}}oe(),Ae(),ae(),ge(),Z(),V(),r&&$("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}async function vo(e,r){const l=document.querySelector(m.printableContent);if(!l||!e){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}const o=document.title;if(r==="direct"){$("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...","default");let t;try{typeof window.html2pdf>"u"&&($("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await uo("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js")),t=document.createElement("div"),t.style.position="fixed",t.style.left="-300mm",t.style.top="0",t.style.width="210mm",t.style.background="#fff",t.innerHTML=e,document.body.appendChild(t),await new Promise(a=>setTimeout(a,300));const n={margin:0,filename:`${o}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:t.querySelector(".pdf-page")?.scrollWidth||794,windowWidth:t.querySelector(".pdf-page")?.scrollWidth||794},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(t).set(n).save(),$("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(n){console.error("PDF Generation Error:",n),$("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{t&&document.body.contains(t)&&document.body.removeChild(t)}}else r==="print"&&(l.innerHTML=e,setTimeout(()=>{window.print(),setTimeout(()=>{l.innerHTML=""},1e3)},qt))}function go(e){if(!e||!e.html){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const r=`<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${e.fileName}</title><link rel="stylesheet" href="./src/styles/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><style>body { background-color: #eee; } #printable-content { display: block !important; max-width: 210mm; margin: 10mm auto; } .pdf-page { border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 10mm; background: #fff; page-break-inside: avoid; } .pdf-page-content { padding: 12mm; } @media print { body { background-color: #fff; } #printable-content { max-width: 100%; margin: 0; } .pdf-page { border: none; box-shadow: none; margin-bottom: 0; page-break-after: always; } .pdf-page:last-child { page-break-after: avoid; } } i.ph { vertical-align: middle; }</style></head><body><div id="printable-content">${e.html}</div></body></html>`,l=new Blob([r],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(l),t=document.createElement("a");t.href=o,t.download=`${e.fileName}.html`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(o),$("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(r){console.error("HTML Export Error:",r),$("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function bo(){const e=document.querySelector(m.orderForm),r=document.querySelector(m.fileImporter),l=document.querySelector("#favImporter"),o=document.querySelector(m.menuDropdown),t=document.querySelector(m.quickNavDropdown),n=document.querySelector(m.menuBtn),a=document.querySelector(m.quickNavBtn);if(e){if(e.addEventListener("item-update",V),e.addEventListener("input",s=>{if(z){s.preventDefault();return}if(s.target.closest("#customerInfo")&&X(),s.target.matches(m.roomNameInput)){const d=s.target.closest(".room-card")?.querySelector("[data-room-name-display]");d&&(d.textContent=s.target.value||"‡∏´‡πâ‡∏≠‡∏á"),Ae(),ge(),ve(X,300)()}s.target.matches('input[name$="_m"], input[name$="price_sqyd"], input[name$="price_roll"], input[name$="install_cost"]')&&V()}),e.addEventListener("change",s=>{if(z){s.preventDefault();return}s.target.matches("select")&&V()}),e.addEventListener("blur",s=>{const c=s.target;c.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?c.name==="wallpaper_install_cost"&&_(c.value)===0?c.value="0":c.value=_(c.value)>0?A(_(c.value)):"":c.matches('input[name$="_m"], input[name^="wall_width_m"], input[name^="modal_"]')&&(c.value=Y(c.value)),!c.closest(".modal-wrapper")&&c.matches('input:not([type="hidden"]), select, textarea')&&X()},!0),e.addEventListener("focusin",s=>{const c=s.target;if(c.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&(c.name==="wallpaper_install_cost"&&c.value==="0"||_(c.value)>0&&(c.value=_(c.value))),c.matches('input:not([type="hidden"]), select, textarea')){const d=document.querySelector(".main-header"),i=document.querySelector(".summary-footer"),f=d?d.offsetHeight+16:80,u=i?i.offsetHeight+16:100,p=window.innerHeight,g=c.getBoundingClientRect();if((g.top<f||g.bottom>p-u)&&!c.closest(".modal-wrapper")){const h=c.closest(".item-card, .room-card");h&&fe(h)}}},!0),e.addEventListener("keydown",s=>{if(z){s.preventDefault();return}const c=s.target;if(s.key==="Enter"&&c.matches("input, select")&&!c.closest(".modal-wrapper"))s.preventDefault();else if(s.key==="Enter"&&c.closest("#dimensionEntryModal")){const d=c.closest("#dimensionEntryModal"),i=d.querySelectorAll(".dimension-input-row"),u=i[i.length-1].querySelector('input[name="modal_height_m"]');c===u&&(s.preventDefault(),d.querySelector("#dimensionEntryConfirm")?.click())}}),document.addEventListener("click",async s=>{s.target.closest(".menu-container")||(o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),t?.classList.remove("show"),a?.setAttribute("aria-expanded","false")),s.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(f=>f.classList.remove("show"));const c=s.target.closest(".summary-tag[data-filter-type]");if(c&&c.closest("#overviewModal")){const f=c.dataset.filterType,u=c.textContent.trim().replace(/\s*\d+\s*$/,""),p=document.querySelector("#overviewModal");p&&typeof p.closeModal=="function"&&p.closeModal({cancelled:!0}),mo(f,u);return}const d=s.target.closest(".fav-manager-item");if(d){const f=d.closest("#favManagerModal"),u=f?.querySelector(".fav-manager-item.is-selected");u&&u.classList.remove("is-selected"),u!==d?(d.classList.add("is-selected"),Me({code:d.dataset.code,price:_(d.dataset.price)})):Me(null),f&&(f.querySelector('[data-act="edit-selected-fav"]').disabled=!K(),f.querySelector('[data-act="del-selected-fav"]').disabled=!K());return}const i=s.target.closest("[data-act]");if(i){const f=i.dataset.act,u=i.closest(".item-card"),p=i.closest(".room-card"),g=["toggle-more-details","collapse-room","show-discount-modal","show-suspended-items","clear-filter","close-modal","jump-to-item","manage-favorites","show-favorites"];if(z&&!i.closest(".unlockable")&&!g.includes(f)){$("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}switch(["toggle-more-details","close-modal","collapse-room","remove-dimension-row"].includes(f)||s.preventDefault(),f!=="close-modal"&&s.stopPropagation(),f){case"show-discount-modal":Gt();break;case"show-suspended-items":De();break;case"clear-filter":gt();break;case"add-room":de();break;case"add-item":if(p){const y=document.querySelector("#dimensionEntryModal");if(y){const h=y.querySelector("#dimensionRowsContainer");h.innerHTML="";const S=Ze();h.appendChild(S),S.querySelector('input[name="modal_width_m"]')?.focus();const M=await O("#dimensionEntryModal");if(M&&!M.cancelled){const B=[];if(h.querySelectorAll(".dimension-input-row").forEach(E=>{const F=E.querySelector('input[name="modal_width_m"]'),N=E.querySelector('input[name="modal_height_m"]'),U=_(F.value),Q=_(N.value);U>0&&Q>0&&B.push({width_m:U,height_m:Q})}),B.length>0){re(W()),Z();let E=null;B.forEach(F=>{const N=zt(F,p);E||(E=N)}),E&&(oe(),X(),fe(E),$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${B.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)`,"success"))}else $("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏","warning")}}}break;case"add-dimension-row":{const y=document.querySelector("#dimensionRowsContainer");if(y){const h=Ze();y.appendChild(h),h.querySelector('input[name="modal_width_m"]')?.focus(),y.scrollTop=y.scrollHeight}break}case"remove-dimension-row":{const y=i.closest(".dimension-input-row"),h=y?.parentElement;y&&h&&h.children.length>1&&y.remove();break}case"select-item-type":if(u&&u.classList.contains("placeholder-item")){const y={width_m:parseFloat(u.dataset.widthM||0),height_m:parseFloat(u.dataset.heightM||0)};if(y.width_m>0&&y.height_m>0){const h=await lt("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");h&&Zt(u,h,y)}else $("‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ô Placeholder","error")}break;case"collapse-room":p&&(p.open=!1,setTimeout(()=>{ae(),X()},50));break;case"toggle-room-menu":i.nextElementSibling?.classList.toggle("show");break;case"open-room-defaults":p&&(Jt(p),i.closest(".room-options-menu")?.classList.remove("show"));break;case"apply-room-defaults":Qt();break;case"open-force-apply-modal":Kt();break;case"force-apply-defaults":Xt();break;case"toggle-suspend-room":p&&(p.classList.toggle("is-suspended"),i.closest(".room-options-menu")?.classList.remove("show"),V(),ue==="suspended"?De():pe());break;case"clear-room":p&&await te("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","?")&&(re(W()),Z(),p.getItemsContainer().innerHTML="",oe(),V(),$("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"));break;case"del-room":p&&await te("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","?")&&Fe(p,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"del-item":u&&await te("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")&&Fe(u,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"duplicate-item":u&&oo(u);break;case"toggle-suspend":u&&(u.classList.toggle("is-suspended"),V(),ue==="suspended"?De():pe());break;case"change-type":u&&eo(u);break;case"toggle-more-details":u&&!u.querySelector(".item-details-more")?.classList.contains("show")&&document.querySelectorAll(".item-details-more.show").forEach(y=>{y.closest(".item-card")!==u&&xe(y.closest(".item-card"),!1)}),xe(u);break;case"open-hardware-modal":lo(u),me()&&Ut();break;case"apply-hardware-to-room":{const y=i.closest("#hardwareModal"),h=me()?.closest(m.room);if(!y||!h||!me())break;const S=me().querySelector('[name="set_style"]');if(S?.value==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||S?.value==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){$("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå‡πÑ‡∏î‡πâ","warning");break}const M=y.querySelector('[name="modal_track_color"]').value,B=y.querySelector('[name="modal_bracket_color"]').value,E=y.querySelector('[name="modal_finial_color"]').value,F=y.querySelector('[name="modal_grommet_color"]').value;h.querySelectorAll('.set-item:not(:has(select[name="set_style"][value="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"])):not(:has(select[name="set_style"][value="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"]))').forEach(N=>{N.querySelector('[name="track_color"]').value=M,N.querySelector('[name="bracket_color"]').value=B,N.querySelector('select[name="set_style"]')?.value==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"&&(N.querySelector('[name="finial_color"]').value=E,N.querySelector('[name="grommet_color"]').value=F)}),X(),$("‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success");break}case"add-wall":{const y=i.closest(".walls-section")?.querySelector("[data-walls-container]");if(y){const h=He();h&&(y.appendChild(h),h.querySelector("input")?.focus(),V())}break}case"del-wall":{const y=i.closest(".wall-input-row");y&&await te("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","?")&&Fe(y,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break}case"show-favorites":{const y=i.previousElementSibling?.matches("input[data-favorite-type]")?i.previousElementSibling:i.closest(".form-group-with-favorites")?.querySelector("input[data-favorite-type]");y?so(y):console.warn("Could not find associated input for show-favorites button:",i);break}case"add-new-fav-form":{const h=i.closest("#favManagerModal")?.dataset.currentType;if(!h)break;const S=document.querySelector("#favAddModal");if(!S)break;let M=H[h]?.name||h;h==="fabric"?M="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":h==="sheer"&&(M="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),S.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${M}'`;const B=S.querySelector('[name="fav_code_add"]'),E=S.querySelector('[name="fav_price_add"]');B.value="",E.value="";const F=await O("#favAddModal");if(F&&!F.cancelled){const N=B.value.trim(),U=_(E.value);N&&U>=0?Ye(h,N,U)?(ke(!0),$e(h),$("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß","success")):$("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"):$(N?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"edit-selected-fav":{if(!K())break;const h=i.closest("#favManagerModal")?.dataset.currentType;if(!h)break;const S=document.querySelector("#favEditModal");if(!S)break;S.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${K().code}'`;const M=S.querySelector('[name="fav_code_edit"]'),B=S.querySelector('[name="fav_price_edit"]');M.value=K().code,B.value=K().price!==null&&K().price>=0?K().price:"";const E=await O("#favEditModal");if(E&&!E.cancelled){const F=M.value.trim(),N=_(B.value);F&&N>=0?(F!==K().code&&Qe(h,K().code),Ye(h,F,N),ke(!0),$e(h),$("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")):$(F?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"del-selected-fav":{if(!K())break;const h=i.closest("#favManagerModal")?.dataset.currentType;if(!h)break;await te("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`"${K().code}"?`)&&(Qe(h,K().code)?(ke(!0),$e(h),$("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success")):$("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"));break}case"manage-favorites-from-defaults":await ro();break;case"jump-to-item":ao(i);break}}else{const f=s.target.closest("summary");f&&f.closest("details.card")&&setTimeout(()=>{ae(),X()},50)}}),document.querySelector("#undoBtn")?.addEventListener("click",s=>{s.preventDefault(),fo()}),document.querySelector(m.lockBtn)?.addEventListener("click",s=>{s.preventDefault(),yo()}),document.querySelector(m.toggleAllRoomsBtn)?.addEventListener("click",s=>{s.preventDefault(),_o()}),a&&t){a.addEventListener("click",c=>{c.stopPropagation(),o?.classList.remove("show");const d=!t.classList.contains("show");t.classList.toggle("show",d),a.setAttribute("aria-expanded",d),d&&n?.setAttribute("aria-expanded","false")}),document.querySelector(m.quickNavRoomList)?.addEventListener("click",c=>{const d=c.target.closest("a[data-jump-to]");if(d){c.preventDefault();const i=d.dataset.jumpTo,f=document.getElementById(i);f&&(f.open=!0,f.scrollIntoView({behavior:"smooth",block:"center"}),f.classList.add("scrolling-jump"),setTimeout(()=>f.classList.remove("scrolling-jump"),2500),setTimeout(ae,100)),t.classList.remove("show"),a.setAttribute("aria-expanded","false")}});const s=document.querySelector("#addRoomQuickNavBtn");if(s){const c=xt(de,700);s.addEventListener("click",d=>{d.stopPropagation(),c(),t.classList.remove("show"),a.setAttribute("aria-expanded","false")})}}n&&o&&n.addEventListener("click",s=>{s.stopPropagation(),t?.classList.remove("show");const c=!o.classList.contains("show");o.classList.toggle("show",c),n.setAttribute("aria-expanded",c),c&&a?.setAttribute("aria-expanded","false")}),document.querySelector("#themeToggleBtn")?.addEventListener("click",s=>{s.preventDefault(),po(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false")}),document.querySelector("#overviewBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");const c=W(),d=document.querySelector("#overviewModalHeader"),i=document.querySelector("#overviewModalBody");if(d&&i){const f=c.rooms.reduce((g,y)=>g+(y.is_suspended?0:(y.items||[]).filter(h=>!h.is_placeholder&&!h.is_suspended&&(P.calculateSetPrice(h)?.total>0||P.calculateWallpaperPrice(h)?.total>0||P.calculateAreaBasedPrice(h)?.total>0)).length),0),u=document.querySelector(m.grandTotal)?.textContent||"0",p=c.rooms.filter(g=>!g.is_suspended&&g.items?.some(y=>!y.is_suspended)).length;d.innerHTML=`<div class="overview-stats-grid"><div class="overview-stat-card"><i class="ph-bold ph-map-pin-line"></i><div class="stat-value">${p}</div><div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div></div><div class="overview-stat-card"><i class="ph-bold ph-stack"></i><div class="stat-value">${f}</div><div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div><div class="overview-stat-card"><i class="ph-bold ph-coins"></i><div class="stat-value">${u}</div><div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div></div></div>`,i.innerHTML=Ot(c),O("#overviewModal")}}),document.querySelector("#copyTextBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");const c=document.querySelector(m.copyOptionsModal);if(!c)return;c.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const d=await O(m.copyOptionsModal);if(d&&!d.cancelled){const i=c.querySelector('input[name="copy_option"]:checked').value,f=Ht(W(),i);try{await navigator.clipboard.writeText(f),$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector("#visualReportsBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");const c=document.querySelector("#visualReportsModal");if(!c)return;c.querySelector('input[name="report_type_option"][value="lookbook"]').checked=!0;const d=await O("#visualReportsModal");if(d&&!d.cancelled){const i=c.querySelector('input[name="report_type_option"]:checked').value;if(i==="lookbook"){const f=W(),u=Wt(f),p=document.querySelector("#lookbookModalBody");u&&p?(p.innerHTML=u,O("#lookbookModal")):$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","warning")}else $(`'${i}' ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°`,"default")}}),document.querySelector(m.exportPdfBtn)?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");const c=await Vt();if(!c)return;const d=W(),i=jt(d,{vatRate:c.vatOption==="include"?J.baseVatRate:0,pageBreakBuffer:c.pageBreakBuffer,showDetails:c.showDetails});if(!i){$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}c.exportMethod==="html"?go(i):vo(i.html,c.exportMethod)}),document.querySelector(m.submitBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),await te("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","?")){const c=W();if(!c.customer_name&&!c.customer_phone){$("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå","warning");return}$("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...","default");try{const d=await fetch(wt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});d.ok?$("‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß!","success"):$(`‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${d.status}`,"error")}catch{$("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","error")}}}),document.querySelector(m.importBtn)?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),r?.click()}),r?.addEventListener("change",s=>{const c=s.target.files?.[0];if(!c)return;const d=new FileReader;d.onload=async i=>{try{const f=JSON.parse(i.target.result);if(f&&typeof f=="object")await Ue(f,!0);else throw new Error("Invalid JSON")}catch(f){$("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error"),console.error(f)}},d.readAsText(c),s.target.value=null}),document.querySelector(m.exportBtn)?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");try{const c=W(),d=JSON.stringify(c,null,4),i=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(i),u=document.createElement("a"),p=new Date,g=`${p.getFullYear()}${(p.getMonth()+1).toString().padStart(2,"0")}${p.getDate().toString().padStart(2,"0")}`,y=`${p.getHours().toString().padStart(2,"0")}${p.getMinutes().toString().padStart(2,"0")}`,h=at(c.customer_name||"data");u.href=f,u.download=`MTR-${g}${y}-${h}.json`,u.click(),URL.revokeObjectURL(f),$("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{$("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector("#importFavsBtn")?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),l?.click()}),l?.addEventListener("change",s=>{const c=s.target.files?.[0];if(!c)return;const d=new FileReader;d.onload=i=>{try{const f=JSON.parse(i.target.result),u=Re(f);u>0?$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${u} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,"success"):$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà","default")}catch{$("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error")}},d.readAsText(c),s.target.value=null}),document.querySelector("#exportFavsBtn")?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false");try{const c=le();if(Object.values(c).every(g=>g.length===0)){$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}const d=JSON.stringify(c,null,4),i=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(i),u=document.createElement("a"),p=new Date().toISOString().slice(0,10).replace(/-/g,"");u.href=f,u.download=`MTR-Favorites-${p}.json`,u.click(),URL.revokeObjectURL(f),$("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{$("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(m.clearItemsBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),await te("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")){re(W()),Z(),document.querySelectorAll(m.room).forEach(i=>{i.getItemsContainer().innerHTML=""});const c=document.querySelector("#discount_type"),d=document.querySelector("#discount_value");c&&(c.value="amount"),d&&(d.value="0"),oe(),V(),$("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")}}),document.querySelector(m.clearAllBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),await te("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){const c=document.querySelector(m.roomsContainer);c&&(c.innerHTML=""),localStorage.removeItem(he),It(),$("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î...","success"),setTimeout(()=>window.location.reload(),500)}}),document.querySelector("#roomDefaultsConfirmBtn")?.addEventListener("click",Yt),window.addEventListener("click",s=>{s.target.closest(".menu-container")||(o?.classList.remove("show"),t?.classList.remove("show"),n?.setAttribute("aria-expanded","false"),a?.setAttribute("aria-expanded","false")),s.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show"));const c=s.target.closest(".item-card");document.querySelectorAll(".item-details-more.show").forEach(d=>{const i=d.closest(".item-card");i!==c&&xe(i,!1)})}),window.addEventListener("beforeunload",X),document.querySelector("#forceApplySelectTypeBtn")?.addEventListener("click",async s=>{if(s.preventDefault(),z){$("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}const c=document.querySelector("#forceApplyTypeModal");if(!c)return;const d=document.querySelector('#forceApplyModal [name="force_apply_type_hidden"]')?.value;let i=c.querySelector(`input[name="force_apply_type_option"][value="${d}"]`);i||(i=c.querySelector('input[name="force_apply_type_option"]')),i&&(i.checked=!0);const f=await O("#forceApplyTypeModal");if(f&&!f.cancelled){const u=c.querySelector('input[name="force_apply_type_option"]:checked');if(u){const p=u.value,g=document.querySelector("#forceApplyModal"),y=g?.querySelector('[name="force_apply_type_hidden"]'),h=g?.querySelector("#forceApplySelectedTypeDisplay"),S=g?.querySelector('[name="force_apply_code"]'),M=S?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs"),B=u.closest("label")?.querySelector("strong"),E=B?B.textContent.trim():p;y&&(y.value=p),h&&(h.textContent=E),S&&(S.dataset.favoriteType=p,S.focus()),M&&(M.disabled=!1)}}})}}function So(){const e=document.querySelector(m.setTpl);if(!e)return;const r=e.content.querySelector(m.setPricePerMSelect),l=e.content.querySelector(m.setSheerPricePerMSelect),o=e.content.querySelector(m.setLouisPricePerMSelect),t=n=>{let a='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(n)?(n.forEach(s=>{a+=`<option value="${s}">${s.toLocaleString("th-TH")}</option>`}),a):(console.error("Price data for dropdown is not available or not an array.",n),a)};r&&(r.innerHTML=t(ye.fabric)),l&&(l.innerHTML=t(ye.sheer)),o&&(o.innerHTML=t(ye.louis))}function wo(){So(),vt(),bo();try{const e=localStorage.getItem(he);if(e&&e!=="null"&&e!=="{}"){const r=JSON.parse(e);if(r&&Array.isArray(r.rooms))Ue(r,!1);else{console.warn("Stored data structure seems invalid, starting fresh."),localStorage.removeItem(he),de();const l=document.querySelector(m.customerCard);l&&(l.open=!0)}}else{de();const r=document.querySelector(m.customerCard);r&&(r.open=!0)}}catch(e){console.error("Failed to load or parse data from localStorage:",e),localStorage.removeItem(he),de();const r=document.querySelector(m.customerCard);r&&(r.open=!0)}V(),bt(),ae(),ge(),Z(),console.log("Marnthara App Initialized (Vite Refactor)")}document.addEventListener("DOMContentLoaded",wo);
