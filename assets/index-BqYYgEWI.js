(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const t of r.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&o(t)}).observe(document,{childList:!0,subtree:!0});function l(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=l(a);fetch(a.href,r)}})();const Bt="vite-refactor/6.1.0",Et="https://your-make-webhook-url.com/your-unique-path",Se="marnthara.input.v6.1",At=500,X={name:"‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ‡∏Ç‡∏ß‡∏±‡∏ç‡∏§‡∏î‡∏µ",address:"‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 257 ‡∏°.6 ‡∏ï.‡∏´‡∏ô‡∏≠‡∏á‡πÇ‡∏û‡∏£‡∏á ‡∏≠.‡∏®‡∏£‡∏µ‡∏°‡∏´‡∏≤‡πÇ‡∏û‡∏ò‡∏¥ ‡∏à.‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ 25140",phone:"‡πÇ‡∏ó‡∏£ 087-985-3832 (‡∏®‡∏¥‡∏£‡∏¥‡∏Ç‡∏ß‡∏±‡∏ç ‡∏ô‡∏≤‡∏Ñ‡∏∞‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)",taxId:"1250100194164",baseVatRate:.07,pdf:{notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏∑‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 90 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},Pt=1.19599,Dt={ROLL_WIDTH_M:.53,STRIPS_PER_ROLL_UNDER_2_5M:3},Ce={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200,2300,2400,2500,2600,2700,2800,2900,3e3],sheer:[1e3,1100,1200,1300,1400,1500],louis:[2200,2300,2400,2500,2600,2700,2800,2900,3e3,3100,3200,3300,3400,3500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö:0,‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå:0}},j={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},y={orderForm:"#orderForm",roomsContainer:"#rooms",toastContainer:"#toast-container",printableContent:"#printable-content",filterStatusBar:"#filterStatusBar",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",undoBtn:"#undoBtn",themeToggleBtn:"#themeToggleBtn",overviewBtn:"#overviewBtn",copyTextBtn:"#copyTextBtn",visualReportsBtn:"#visualReportsBtn",exportPdfBtn:"#exportPdfBtn",submitBtn:"#submitBtn",importBtn:"#importBtn",exportBtn:"#exportBtn",importFavsBtn:"#importFavsBtn",exportFavsBtn:"#exportFavsBtn",clearItemsBtn:"#clearItemsBtn",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",quickNavBtnText:"#quickNavBtnText",toggleAllRoomsBtn:"#toggleAllRoomsBtn",suspendedItemsBtn:"#suspendedItemsBtn",suspendedCountBadge:"#suspendedCountBadge",originalTotal:"#originalTotal",grandTotal:"#grandTotal",fileImporter:"#fileImporter",favImporter:"#favImporter",customerCard:"#customerDetailsCard",customerNameInput:"#customer_name",customerPhoneInput:"#customer_phone",customerAddressInput:"#customer_address",room:".room-card",roomTpl:"#roomTpl",roomNameInput:'input[name="room_name"]',roomNameDisplay:"[data-room-name-display]",roomBrief:"[data-room-brief]",allItemsContainer:"[data-all-items]",roomDefaultsBtn:'[data-act="open-room-defaults"]',itemCard:".item-card",itemDetailsMore:".item-details-more",itemGrid:".item-grid",itemTitle:"[data-item-title]",toggleDetailsBtn:'[data-act="toggle-more-details"]',setTpl:"#setTpl",setWidthInput:'input[name="width_m"]',setHeightInput:'input[name="height_m"]',setStyleSelect:'select[name="set_style"]',setFabricVariantSelect:'select[name="fabric_variant"]',setPricePerMSelect:'select[name="set_price_per_m"]',setSheerPricePerMSelect:'select[name="sheer_price_per_m"]',setLouisPricePerMSelect:'select[name="louis_price_per_m"]',setFabricCodeInput:'input[name="fabric_code"]',setSheerCodeInput:'input[name="sheer_fabric_code"]',setOpeningStyleSelect:'select[name="opening_style"]',setAdjustmentSideSelect:'select[name="adjustment_side"]',setTrackColorInput:'input[name="track_color"]',setBracketColorInput:'input[name="bracket_color"]',setFinialColorInput:'input[name="finial_color"]',setGrommetColorInput:'input[name="grommet_color"]',setLouisValanceInput:'input[name="louis_valance"]',setLouisTasselsInput:'input[name="louis_tassels"]',setNotesInput:'input[name="notes"]',wallpaperTpl:"#wallpaperTpl",wallTpl:"#wallTpl",wallHeightInput:'[name="wallpaper_height_m"]',wallCodeInput:'[name="wallpaper_code"]',wallPriceRollInput:'[name="wallpaper_price_roll"]',wallInstallCostInput:'[name="wallpaper_install_cost"]',wallNotesInput:'[name="wallpaper_notes"]',wallWidthInput:'[name="wall_width_m"]',areaBasedTpl:"#areaBasedTpl",areaBasedItem:".area-based-item",areaWidthInput:'[name="area_width_m"]',areaHeightInput:'[name="area_height_m"]',areaPriceSqydInput:'[name="area_price_sqyd"]',areaCodeInput:'[name="area_code"]',areaNotesInput:'[name="area_notes"]',modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",discountModal:"#discountModal",discountSubtotal:"#discountSubtotal",discountPercent:"#discountPercent",discountAmount:"#discountAmount",discountFinalTotal:"#discountFinalTotal",discountTypeInput:"#discount_type",discountValueInput:"#discount_value",copyOptionsModal:"#copyOptionsModal",visualReportsModal:"#visualReportsModal",lookbookModal:"#lookbookModal",lookbookModalBody:"#lookbookModalBody",exportOptionsModal:"#exportOptionsModal",pdfOptionsModal:"#pdfOptionsModal",exportPdfWithDetailsBtn:"#exportPdfWithDetailsBtn",exportPdfWithoutDetailsBtn:"#exportPdfWithoutDetailsBtn",itemTypeModal:"#itemTypeModal",itemTypeModalTitle:"#itemTypeModalTitle",hardwareModal:"#hardwareModal",modalTrackColor:'[name="modal_track_color"]',modalBracketColor:'[name="modal_bracket_color"]',modalFinialColor:'[name="modal_finial_color"]',modalGrommetColor:'[name="modal_grommet_color"]',modalLouisValance:'[name="modal_louis_valance"]',modalLouisTassels:'[name="modal_louis_tassels"]',trackColorGroup:"#trackColorGroup",bracketColorGroup:"#bracketColorGroup",finialColorGroup:"#finialColorGroup",grommetColorGroup:"#grommetColorGroup",louisValanceGroup:"#louisValanceGroup",louisTasselGroup:"#louisTasselGroup",hardwareApplyToRoomBtn:"#hardwareApplyToRoom",favoritesConflictModal:"#favoritesConflictModal",favoritesModal:"#favoritesModal",favoritesModalTitle:"#favoritesModalTitle",favoritesModalBody:"#favoritesModalBody",favSearchInput:"#favSearchInput",favSelectorItemTpl:"#favSelectorItemTpl",favInput:"input[data-favorite-type]",favManagerModal:"#favManagerModal",favManagerTitle:"#favManagerTitle",favManagerBody:"#favManagerBody",favManagerItemTpl:"#favManagerItemTpl",favManagerEditBtn:'#favManagerModal [data-act="edit-selected-fav"]',favManagerDelBtn:'#favManagerModal [data-act="del-selected-fav"]',favAddModal:"#favAddModal",favAddCodeInput:'[name="fav_code_add"]',favAddPriceInput:'[name="fav_price_add"]',favEditModal:"#favEditModal",favEditCodeInput:'[name="fav_code_edit"]',favEditPriceInput:'[name="fav_price_edit"]',roomDefaultsModal:"#roomDefaultsModal",roomDefaultsForm:"#roomDefaultsForm",roomDefaultsApplyBtn:"#roomDefaultsApplyBtn",roomDefaultsConfirmBtn:"#roomDefaultsConfirmBtn",roomDefaultsCancelBtn:"#roomDefaultsCancelBtn",roomControlCenterModal:"#roomControlCenterModal",rccTabs:".rcc-tabs .tab-link",rccContentPanels:".rcc-tab-content",batchDeviceTypeSelect:"#batch-select-device-type",batchDeviceListContainer:"#batch-device-list-container",batchSelectAllCheckbox:"#batch-select-all-checkbox",batchTargetTypeSelect:"#batch-target-device-type",batchCurtainDetailsPanel:"#batch-curtain-type-options",batchCurtainTypeSelect:"#batch-curtain-type",batchConfirmBtn:"#batchEditorConfirmBtn",overviewModal:"#overviewModal",overviewModalHeader:"#overviewModalHeader",overviewModalBody:"#overviewModalBody"},_=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const n=parseFloat(e);return Number.isFinite(n)?n:0},K=e=>{const n=_(e);return n>0?n.toFixed(2):""},Ye=e=>{const n=e.target,l=n.value.trim();if(l===""){n.value="";return}let o=_(l);if(o<=0){n.value="";return}o>30&&o%1===0&&(o=o/100),n.value=K(o)},ne=(e,n=2,l=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:l?2:n,maximumFractionDigits:l?2:n}):"0",E=(e,n=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:n,maximumFractionDigits:n}):"0",qe=(e,n=150)=>{let l;return(...o)=>{clearTimeout(l),l=setTimeout(()=>e(...o),n)}},Nt=(e,n=200)=>{let l=0,o;return(...a)=>{const r=new Date().getTime();o&&(clearTimeout(o),o=null),r-l>=n?(l=r,e(...a)):o=setTimeout(()=>{l=new Date().getTime(),e(...a),o=null},n-(r-l))}},M=e=>e?e.replace(/[<>"'&]/g,n=>{switch(n){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;";default:return n}}):"",ht=e=>e?e.replace(/[<>:"/\\|?*]/g,"").replace(/[\s\n\t]+/g,"_").substring(0,100):"file";function Rt(e){if(e=_(e),e===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";if(e<0||e>99999999999999e-2)return"N/A";const n=["‡∏®‡∏π‡∏ô‡∏¢‡πå","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤","‡∏™‡∏¥‡∏ö"],l=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];e=parseFloat(e.toFixed(2));let o=Math.floor(e),a=Math.round((e-o)*100);const r=s=>{if(s===0)return"";let i="";const d=String(s);for(let c=0;c<d.length;c++){const p=d[c],u=d.length-c-1;p!=="0"&&(u===1&&p==="1"?i+=l[u]:u===1&&p==="2"?i+="‡∏¢‡∏µ‡πà"+l[u]:u===0&&p==="1"&&d.length>1?i+="‡πÄ‡∏≠‡πá‡∏î":i+=n[parseInt(p)]+l[u])}return i};let t="";if(o>0){const s=Math.floor(o/1e6),i=o%1e6;s>0&&(t+=r(s)+"‡∏•‡πâ‡∏≤‡∏ô"),t+=r(i),t+="‡∏ö‡∏≤‡∏ó"}else t="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó";return a===0?t+="‡∏ñ‡πâ‡∏ß‡∏ô":t+=r(a)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå",t}const Qe="marnthara.favorites.v4",we={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function ue(){try{const e=localStorage.getItem(Qe);return e?{...we,...JSON.parse(e)}:we}catch(e){return console.error("Failed to parse favorites from localStorage",e),we}}function Pe(e){try{localStorage.setItem(Qe,JSON.stringify(e))}catch(n){console.error("Failed to save favorites to localStorage",n)}}function ot(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const n={...we,...e};return Pe(n),!0}function Ve(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for merge."),0;const n=ue();let l=0;for(const o in e)Object.hasOwnProperty.call(e,o)&&Array.isArray(e[o])&&(n[o]||(n[o]=[]),e[o].forEach(a=>{a&&a.code&&a.hasOwnProperty("price")?n[o].some(t=>t.code===a.code)||(n[o].push({code:a.code,price:a.price}),l++):console.warn(`Skipping invalid favorite item during merge for type ${o}:`,a)}),n[o].sort((a,r)=>a.code.localeCompare(r.code)));return l>0&&Pe(n),l}function at(e,n,l){const o=ue(),a=n?.trim();if(!a)return console.error(`Attempted to add favorite with empty code for type: ${e}`),!1;if(typeof l!="number"||isNaN(l)||l<0)return console.error(`Attempted to add favorite with invalid price (${l}) for code ${a}`),!1;if(!Object.hasOwnProperty.call(we,e))return console.error(`Attempted to add favorite to an invalid type: ${e}`),!1;o[e]||(o[e]=[]);const r=o[e],t=r.find(s=>s.code===a);return t?t.price=l:r.push({code:a,price:l}),r.sort((s,i)=>s.code.localeCompare(i.code)),Pe(o),!0}function nt(e,n){const l=ue(),o=n?.trim();if(!l[e]||!o)return!1;const a=l[e].findIndex(r=>r.code===o);return a>-1?(l[e].splice(a,1),Pe(l),!0):!1}function Ft(){localStorage.removeItem(Qe),console.log("All favorites have been cleared.")}function G(){const e=ue(),n={app_version:Bt,customer_name:document.querySelector(y.customerNameInput)?.value||"",customer_phone:document.querySelector(y.customerPhoneInput)?.value||"",customer_address:document.querySelector(y.customerAddressInput)?.value||"",customer_card_open:document.querySelector(y.customerCard)?.open,discount:{type:document.querySelector(y.discountTypeInput)?.value||"amount",value:_(document.querySelector(y.discountValueInput)?.value)},rooms:[],favorites:e};return document.querySelectorAll(y.room).forEach(l=>{const o={id:l.id,room_name:l.querySelector(y.roomNameInput)?.value||"",is_suspended:l.classList.contains("is-suspended"),is_open:l.open,room_defaults:JSON.parse(l.dataset.roomDefaults||"{}"),items:[]};l.querySelector(y.allItemsContainer)?.childNodes.forEach(a=>{if(a.nodeType!==1||!a.matches(y.itemCard))return;if(a.classList.contains("placeholder-item")){const s={type:"placeholder",is_suspended:a.classList.contains("is-suspended"),width_m:_(a.dataset.widthM),height_m:_(a.dataset.heightM)};o.items.push(s);return}const r=a.dataset.type;if(!r)return;let t={type:r,is_suspended:a.classList.contains("is-suspended")};if(r==="set")Object.assign(t,{width_m:_(a.querySelector(y.setWidthInput)?.value),height_m:_(a.querySelector(y.setHeightInput)?.value),style:a.querySelector(y.setStyleSelect)?.value||"",fabric_variant:a.querySelector(y.setFabricVariantSelect)?.value||"",price_per_m_raw:_(a.querySelector(y.setPricePerMSelect)?.value),sheer_price_per_m:_(a.querySelector(y.setSheerPricePerMSelect)?.value),louis_price_per_m:_(a.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:a.querySelector(y.setFabricCodeInput)?.value||"",sheer_fabric_code:a.querySelector(y.setSheerCodeInput)?.value||"",opening_style:a.querySelector(y.setOpeningStyleSelect)?.value||"",adjustment_side:a.querySelector(y.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:a.querySelector(y.setTrackColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:a.querySelector(y.setBracketColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:a.querySelector(y.setFinialColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:a.querySelector(y.setGrommetColorInput)?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:a.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:a.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:a.querySelector(y.setNotesInput)?.value||""});else if(r==="wallpaper"){const s=a.querySelector(y.wallInstallCostInput),i=s?s.value:"";let d;i==="0"?d=0:_(i)>0?d=_(i):d=void 0,Object.assign(t,{height_m:_(a.querySelector(y.wallHeightInput)?.value),wallpaper_code:a.querySelector(y.wallCodeInput)?.value||"",price_per_roll:_(a.querySelector(y.wallPriceRollInput)?.value),install_cost_per_roll:d,notes:a.querySelector(y.wallNotesInput)?.value||"",widths:Array.from(a.querySelectorAll(y.wallWidthInput)).map(c=>_(c.value))})}else a.matches(y.areaBasedItem)&&(Object.assign(t,{width_m:_(a.querySelector(y.areaWidthInput)?.value),height_m:_(a.querySelector(y.areaHeightInput)?.value),price_sqyd:_(a.querySelector(y.areaPriceSqydInput)?.value),code:a.querySelector(y.areaCodeInput)?.value||"",notes:a.querySelector(y.areaNotesInput)?.value||""}),(r==="partition"||r==="pleated_screen")&&(t.opening_style=a.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(r)&&(t.adjustment_side=a.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));o.items.push(t)}),n.rooms.push(o)}),n}function ee(){try{const e=G();localStorage.setItem(Se,JSON.stringify(e))}catch(e){console.error("Failed to save data to localStorage:",e)}}const fe=[],Ht=10;function se(e){if(!e){console.warn("Attempted to push invalid state to undo stack.");return}try{const n=JSON.parse(JSON.stringify(e));fe.push(n),fe.length>Ht&&fe.shift()}catch(n){console.error("Failed to clone state for undo history:",n)}}function Ot(){if(fe.length!==0)return fe.pop()}function jt(){return fe.length>0}const W={getStyleSurcharge:e=>Ce.style_surcharge[e]||0,fabricYardage:(e,n)=>{const l=_(n);if(l<=0)return 0;let o=0;switch(e){case"‡∏ï‡∏≤‡πÑ‡∏Å‡πà":case"‡∏à‡∏µ‡∏ö":case"‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":case"‡∏•‡∏≠‡∏ô":case"‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö":o=(l+.3)*2;break;case"‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö":o=l*1.3;break;default:return 0}const a=o/.9,r=Math.floor(a/50);return a+r},calculateGrommets:e=>{const n=_(e.width_m);if(n<=0||e.style!=="‡∏ï‡∏≤‡πÑ‡∏Å‡πà")return 0;const l=n*2.5;let a=Math.ceil(l*100/12);return a%2!==0&&a++,a},calculateSetPrice:function(e){if(!e||e.is_suspended)return{total:0,opaque:0,sheer:0,louis:0};const l=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",o=e.style||"‡∏•‡∏≠‡∏ô",a=_(e.width_m);_(e.height_m);let r=0,t=0,s=0;const i=this.getStyleSurcharge(o),d=_(e.price_per_m_raw),c=_(e.sheer_price_per_m);if(o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const f=_(e.louis_price_per_m);if(l.includes("‡∏ó‡∏∂‡∏ö")){const v=d+i;r=a*v}l.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t=a*c),f>0&&(s=a*f)}else{if(l.includes("‡∏ó‡∏∂‡∏ö")){const f=d+i;r=a*f}l.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t=a*c)}r=Math.round(r/10)*10,t=Math.round(t/10)*10,s=Math.round(s/10)*10;const p=r+t+s;let u=p;return p>0&&p<1200&&(u=1200),{total:u,opaque:r,sheer:t,louis:s}},wallpaperRolls:(e,n)=>{if(e<=0||n<=0)return 0;const{ROLL_WIDTH_M:l,STRIPS_PER_ROLL_UNDER_2_5M:o}=Dt,a=Math.ceil(e/l);let r;return n<=2.5?r=o:r=2,Math.ceil(a/r)},calculateAreaBasedPrice:function(e){if(!e||e.is_suspended)return{total:0,sqm:0,sqyd:0};const n=_(e.width_m),l=_(e.height_m),o=_(e.price_sqyd);if(n<=0||l<=0||o<=0)return{total:0,sqm:0,sqyd:0};const a=n*l;let r=a*Pt;r<1?r=1:r=Math.ceil(r*2)/2;const t=r*o;return{total:Math.round(t),sqm:a,sqyd:r}},calculateWallpaperPrice:function(e){if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const n=e.widths?.reduce((i,d)=>i+_(d),0)||0;if(n<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const l=_(e.height_m),o=this.wallpaperRolls(n,l),a=o*_(e.price_per_roll);let r=300;const t=e.install_cost_per_roll;t===0?r=0:typeof t=="number"&&t>0?r=t:_(t)>0&&(r=_(t));const s=o*r;return{total:Math.round(a+s),material:Math.round(a),install:Math.round(s),rolls:o,sqm:n*l}}},Q=Object.entries(j).reduce((e,[n,l])=>(e[n]=l.name,e),{});Q.set_louis="‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå";function ie(e){const{width:n=0,height:l=0}=e,o=15,a=100-o*2,r=100-o*2,t=n>0&&l>0?Math.min(a/n,r/l):1,s=n*t,i=l*t,d=(100-s)/2,c=(100-i)/2,p=`
        <line x1="${d}" y1="${c+i+5}" x2="${d+s}" y2="${c+i+5}" class="dimension-line" />
        <line x1="${d}" y1="${c+i+3}" x2="${d}" y2="${c+i+7}" class="dimension-tick" />
        <line x1="${d+s}" y1="${c+i+3}" x2="${d+s}" y2="${c+i+7}" class="dimension-tick" />
        <text x="50" y="${c+i+14}" class="dimension-text">${n.toFixed(2)} ‡∏°.</text>

        <line x1="${d-5}" y1="${c}" x2="${d-5}" y2="${c+i}" class="dimension-line" />
        <line x1="${d-7}" y1="${c}" x2="${d-3}" y2="${c}" class="dimension-tick" />
        <line x1="${d-7}" y1="${c+i}" x2="${d-3}" y2="${c+i}" class="dimension-tick" />
        <text x="${d-9}" y="50" class="dimension-text" transform="rotate(-90, ${d-9}, 50)">${l.toFixed(2)} ‡∏°.</text>
    `;return{x:d,y:c,svgWidth:s,svgHeight:i,lines:p}}function yt(e,{y:n,svgHeight:l}){if(!e.opening_style||e.opening_style==="‡∏™‡πÑ‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß"||e.type==="set"&&e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö")return"";const o=e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?"< >":"‚Üí";return`
        <rect x="40" y="${n+l/2-8}" width="20" height="16" rx="3" class="opening-text-bg" />
        <text x="50" y="${n+l/2+1}" class="opening-text">${o}</text>
    `}function De(e,{x:n,y:l,svgWidth:o}){if(!e.adjustment_side)return"";const r=e.adjustment_side==="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢"?n+8:n+o-8;return`
        <g class="adjustment-cord">
            <circle cx="${r}" cy="${l+3}" r="2"/>
            <line x1="${r}" y1="${l+5}" x2="${r}" y2="${l+15}"/>
        </g>
    `}function Wt(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),c=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),p=(v,m)=>(e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?`
                <rect x="${o}" y="${a+m}" width="${r/2-1}" height="${t}" class="${v}" />
                <rect x="${o+r/2+1}" y="${a+m}" width="${r/2-1}" height="${t}" class="${v}" />
            `:`<rect x="${o}" y="${a+m}" width="${r}" height="${t}" class="${v}" />`;d&&(i+=p("curtain-panel-sheer",0)),c&&(i+=p("curtain-panel-opaque",d?-2:0));let u="";if(e.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const v=W.calculateGrommets(e)/((e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?2:1),m=Math.min(Math.floor(v),Math.max(8,Math.floor(r/8)));for(let h=0;h<m;h++){const w=o+r/(m>1?m-1:1)*h;u+=`<circle cx="${w}" cy="${a+2}" r="2" class="style-grommet" />`}}else if(e.style==="‡∏•‡∏≠‡∏ô"){const v=Math.max(4,Math.floor(r/10));let m=`M ${o},${a}`;for(let h=0;h<v;h++)m+=" q 5,-4 10,0";u=`<path d="${m}" class="style-ripplefold-path" />`}else e.style==="‡∏à‡∏µ‡∏ö"&&(u=`<text x="${o+2}" y="${a+5}" class="style-pleat-text">||| ||| ||| ||| |||</text>`);const f=yt(e,{y:a,svgHeight:t});return`<svg viewBox="0 0 100 100">${i}${u}${f}${s}</svg>`}function Vt(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),c=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),p=(h,w)=>`
        <rect x="${o}" y="${a+w}" width="${r/2-1}" height="${t}" class="${h}" />
        <rect x="${o+r/2+1}" y="${a+w}" width="${r/2-1}" height="${t}" class="${h}" />
    `;d&&(i+=p("curtain-panel-sheer",0)),c&&(i+=p("curtain-panel-opaque",d?-2:0));const u=Math.max(3,Math.floor(r/15)),f=r/u;let v="";for(let h=0;h<u;h++){const w=o+h*f;v+=`<path d="M ${w},${a} Q ${w+f/2},${a+10} ${w+f},${a}" class="louis-swag" />`}v+=`
        <polygon points="${o},${a} ${o+8},${a} ${o},${a+15}" class="louis-tail" />
        <polygon points="${o+r},${a} ${o+r-8},${a} ${o+r},${a+15}" class="louis-tail" />
    `;let m="";if(e.louis_tassels&&e.louis_tassels!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"){m+=`<circle cx="${o+5}" cy="${a+18}" r="2" class="louis-tassel" />`,m+=`<circle cx="${o+r-5}" cy="${a+18}" r="2" class="louis-tassel" />`;for(let h=1;h<u;h++)m+=`<circle cx="${o+h*f}" cy="${a+8}" r="2" class="louis-tassel" />`}return`<svg viewBox="0 0 100 100">${i}${v}${m}${s}</svg>`}function Gt(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i=`<rect x="${o}" y="${a}" width="${r}" height="${t}" class="blind-frame" />`;const d=5,c=t/d;for(let u=0;u<d;u++)i+=`<rect x="${o+1}" y="${a+u*c}" width="${r-2}" height="${c-1.5}" class="blind-slat" />`;const p=De(e,{x:o,y:a,svgWidth:r});return`<svg viewBox="0 0 100 100">${i}${s}${p}</svg>`}function Ut(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),p=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?"curtain-panel-opaque":d?"curtain-panel-sheer":"blind-slat";i+=`<rect x="${o}" y="${a}" width="${r}" height="${t}" class="${p}" />`;const u=3;i+=`<line x1="${o}" y1="${a+u/2}" x2="${o+r}" y2="${a+u/2}" class="style-pleat-line" stroke-width="0.8"/>`,i+=`<line x1="${o}" y1="${a+u}" x2="${o+r}" y2="${a+u}" class="style-pleat-line"/>`,i+=`<line x1="${o}" y1="${a+t-u}" x2="${o+r}" y2="${a+t-u}" class="style-pleat-line"/>`,i+=`<line x1="${o}" y1="${a+t-u/2}" x2="${o+r}" y2="${a+t-u/2}" class="style-pleat-line" stroke-width="0.8"/>`;const f=Math.max(8,Math.floor(r/4));for(let h=1;h<f;h++){const w=o+r/f*h;i+=`<line x1="${w}" y1="${a+u}" x2="${w}" y2="${a+t-u}" class="style-pleat-line" opacity="0.5"/>`}const v=a+t*.5,m=8;return i+=`<rect x="${o+r*.1}" y="${v-m/2}" width="${r*.8}" height="${m}" rx="2" class="blind-slat" filter="brightness(0.95)" />`,i+=`<rect x="${o+r*.12}" y="${v-m/2+1.5}" width="${r*.76}" height="${m-3}" rx="1" class="blind-frame" opacity="0.3" />`,`<svg viewBox="0 0 100 100">${i}${s}</svg>`}function rt(e,n=!1){const l=_(e.width_m),o=_(e.height_m);if(l<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:a,y:r,svgWidth:t,svgHeight:s,lines:i}=ie({width:l,height:o});let d=`<rect x="${a}" y="${r}" width="${t}" height="${s}" class="blind-frame" />`;if(n){const p=Math.max(4,Math.floor(t/8)),u=t/p;for(let f=0;f<p;f++)d+=`<rect x="${a+f*u+1}" y="${r}" width="${u-2}" height="${s}" class="blind-slat" />`}else{const p=Math.max(3,Math.floor(s/6)),u=s/p;for(let f=0;f<p;f++)d+=`<rect x="${a+1}" y="${r+f*u+.5}" width="${t-2}" height="${u-1}" class="blind-slat" />`}const c=De(e,{x:a,y:r,svgWidth:t});return`<svg viewBox="0 0 100 100">${d}${i}${c}</svg>`}function Jt(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i=`<rect x="${o}" y="${a}" width="${r}" height="${t}" class="blind-frame" />`;const d=Math.max(3,Math.floor(t/8)),c=t/d;for(let h=0;h<d;h++)i+=`<rect x="${o+1}" y="${a+h*c}" width="${r-2}" height="${c-1.5}" rx="0.5" class="wooden-blind-slat" />`;const p=Math.max(2,r*.05),u=o+r*.25-p/2,f=o+r*.75-p/2,v=`
        <rect x="${u}" y="${a}" width="${p}" height="${t}" class="wooden-blind-strip" />
        <rect x="${f}" y="${a}" width="${p}" height="${t}" class="wooden-blind-strip" />
    `,m=De(e,{x:o,y:a,svgWidth:r});return`<svg viewBox="0 0 100 100">${i}${v}${s}${m}</svg>`}function Yt(e){const n=_(e.width_m),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l}),i=`
        <rect x="${o}" y="${a}" width="${r}" height="${t}" class="roller-fabric" />
        <rect x="${o-1}" y="${a-4}" width="${r+2}" height="5" rx="2" class="roller-roll" />
        <line x1="${o}" y1="${a+t}" x2="${o+r}" y2="${a+t}" class="roller-bar" />
    `,d=De(e,{x:o,y:a-2,svgWidth:r});return`<svg viewBox="0 0 100 100">${i}${s}${d}</svg>`}function st(e,n=!1){const l=_(e.width_m),o=_(e.height_m);if(l<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:a,y:r,svgWidth:t,svgHeight:s,lines:i}=ie({width:l,height:o});let d="";if(n)d=`
            <defs>
                <pattern id="pleated-mesh" width="6" height="6" patternUnits="userSpaceOnUse">
                    <path d="M -1 1 L 1 -1 M 0 6 L 6 0" class="pleated-screen-mesh" />
                </pattern>
            </defs>
            <rect x="${a}" y="${r}" width="${t}" height="${s}" class="blind-frame" />
            <rect x="${a}" y="${r}" width="${t}" height="${s}" fill="url(#pleated-mesh)" />
        `;else{const p=Math.max(4,Math.floor(t/10)),u=t/p;for(let f=0;f<p;f++)d+=`<rect x="${a+f*u}" y="${r}" width="${u}" height="${s}" class="partition-panel" />`,f>0&&(d+=`<line x1="${a+f*u}" y1="${r}" x2="${a+f*u}" y2="${r+s}" class="partition-hinge" />`)}const c=yt(e,{y:r,svgHeight:s});return`<svg viewBox="0 0 100 100">${d}${c}${i}</svg>`}function Qt(e){const n=(e.widths||[]).reduce((u,f)=>u+_(f),0),l=_(e.height_m);if(n<=0||l<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:t,lines:s}=ie({width:n,height:l});let i="";const d=Math.floor(r/10),c=Math.floor(t/10);for(let u=0;u<c;u++)for(let f=0;f<d;f++)i+=`<circle cx="${o+f*10+5}" cy="${a+u*10+5}" r="1.5" class="wallpaper-pattern" />`;return`<svg viewBox="0 0 100 100">${`<rect x="${o}" y="${a}" width="${r}" height="${t}" class="blind-frame" /> ${i}`}${s}</svg>`}function Kt(e,n,l){let o="",a=Q[e.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(e.type){case"set":e.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?o=Gt(e):e.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(o=Vt(e),a=Q.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"):e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?o=Ut(e):o=Wt(e);break;case"wooden_blind":o=Jt(e);break;case"aluminum_blind":o=rt(e,!1);break;case"vertical_blind":o=rt(e,!0);break;case"roller_blind":o=Yt(e);break;case"partition":o=st(e,!1);break;case"pleated_screen":o=st(e,!0);break;case"wallpaper":o=Qt(e);break;default:o=`<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">${M(a)}</text></svg>`;break}return`<div class="visual-placeholder is-clickable"
                 data-act="jump-to-item"
                 data-room-id="${n}"
                 data-item-index="${l}"
                 title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">${o}</div>`}function lt(e){let n=`
üìÉ *‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤*
`,l=!1;return e.rooms.forEach(o=>{if(o.is_suspended||!o.items)return;const a=o.items.filter(t=>t.is_suspended?!1:t.type==="wallpaper"?(t.widths||[]).reduce((s,i)=>s+_(i),0)>0:t.type==="set"||j[t.type]?.templateId==="#areaBasedTpl"?_(t.width_m)>0:!0);if(a.length===0)return;l=!0,n+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${o.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let r=0;a.forEach(t=>{r++;let s=Q[t.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";t.type==="set"?t.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(s=Q.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",n+=` ${r}) ${s} (${t.fabric_variant||""})
`):n+=` ${r}) ${s} ${t.style||""} (${t.fabric_variant||""})
`:n+=` ${r}) ${s}
`,t.notes&&(n+=`  > _${M(t.notes)}_
`)})}),l?n+`------------------------------
`:""}function _t(e){return e.rooms.reduce((n,l)=>{if(l.is_suspended)return n;const o=l.items?.reduce((a,r)=>{if(r.is_suspended)return a;switch(r.type){case"set":return a+W.calculateSetPrice(r).total;case"wallpaper":return a+W.calculateWallpaperPrice(r).total;default:return j[r.type]?.templateId==="#areaBasedTpl"?a+W.calculateAreaBasedPrice(r).total:a}},0)||0;return n+o},0)}function Xt(e,n){const l=_t(e);let o=0,a="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(o=l*(e.discount.value/100),a=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${E(o)} ‡∏ö‡∏≤‡∏ó
`):(o=e.discount.value,a=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${E(o)} ‡∏ö‡∏≤‡∏ó
`));const r=l-o;let t=`üóìÔ∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})})
`;if(t+=`üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(n==="customer"||n==="owner")&&(t+=`üìû ‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,t+=`üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),t+=`------------------------------
`,n==="customer")return t+=lt(e),o>0&&(t+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${E(l)} ‡∏ö‡∏≤‡∏ó
`,t+=a),t+=`
üí∞ *‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${E(r)} ‡∏ö‡∏≤‡∏ó*
`,t+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞
${X.name}
‡πÇ‡∏ó‡∏£: ${X.phone}`,t;if(n==="purchase_order"||n==="owner"){n==="owner"&&(t+=lt(e));const s={opaqueFabrics:[],sheerFabrics:[],wallpapers:[],allSets:[]};e.rooms.forEach(S=>{S.is_suspended||!S.items||S.items.forEach(g=>{let A=!g.is_suspended;if(g.type==="set"||j[g.type]?.templateId==="#areaBasedTpl")A=A&&_(g.width_m)>0&&_(g.height_m)>0;else if(g.type==="wallpaper"){const T=(g.widths||[]).reduce((b,L)=>b+_(L),0);A=A&&T>0&&_(g.height_m)>0}if(A)switch(g.type){case"set":s.allSets.push(g),g.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&s.opaqueFabrics.push({code:g.fabric_code||"??",yards:W.fabricYardage(g.style,g.width_m),notes:g.notes}),g.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&s.sheerFabrics.push({code:g.sheer_fabric_code||"??",yards:W.fabricYardage(g.style,g.width_m),notes:g.notes});break;case"wallpaper":const T=(g.widths||[]).reduce((L,q)=>L+_(q),0),b=W.wallpaperRolls(T,g.height_m);b>0&&s.wallpapers.push({code:g.wallpaper_code||"xxx",rolls:b,notes:g.notes});break;default:if(j[g.type]?.templateId==="#areaBasedTpl"){const L=g.type;s[L]||(s[L]=[]),s[L].push({code:g.code||"xxx",width:_(g.width_m),height:_(g.height_m),opening_style:g.opening_style,adjustment_side:g.adjustment_side,notes:g.notes})}break}})});const i={};if([...s.opaqueFabrics,...s.sheerFabrics].forEach(S=>{S.yards>0&&(i[S.code]=(i[S.code]||0)+S.yards)}),Object.keys(i).length>0){t+=`‚úÇÔ∏è *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,t+=`------------------------------
`,s.opaqueFabrics.filter(S=>S.yards>0).forEach((S,g)=>{t+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain) #${g+1}
`,t+=`  ‡∏£‡∏´‡∏±‡∏™: #${S.code||"??"}
`,t+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.yards.toFixed(2)} ‡∏´‡∏•‡∏≤
`,S.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),s.sheerFabrics.filter(S=>S.yards>0).forEach((S,g)=>{t+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer) #${g+1}
`,t+=`  ‡∏£‡∏´‡∏±‡∏™: #${S.code||"??"}
`,t+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.yards.toFixed(2)} ‡∏´‡∏•‡∏≤
`,S.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),t+=`------------------------------
`,t+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,t+=`------------------------------
`;for(const[S,g]of Object.entries(i))t+=`  - ‡∏£‡∏´‡∏±‡∏™ #${S}: ${g.toFixed(2)} ‡∏´‡∏•‡∏≤
`;t+=`
`}const d=s.allSets.filter(S=>S.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"),c=s.allSets.filter(S=>S.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"),p=s.allSets.filter(S=>S.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"),u=s.allSets.filter(S=>S.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"),f=s.allSets.filter(S=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏ï‡∏≤‡πÑ‡∏Å‡πà","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(S.style));if(d.length>0){t+=`------------------------------
`,t+=`üëë *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå)*
`,t+=`------------------------------

`;let S=1;d.forEach(b=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏∂‡∏ö/‡πÇ‡∏õ‡∏£‡πà‡∏á): ${Number(b.width_m).toFixed(2)} ‡∏°.
`,t+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${b.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,t+=`  - ‡∏û‡∏π‡πà: ${b.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`,b.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),t+=`
`});const g=[];d.forEach(b=>{g.push(Number(b.width_m)),b.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&g.push(Number(b.width_m))});const A=g.reduce((b,L)=>{const q=L.toFixed(2);return b[q]=(b[q]||0)+1,b},{}),T=Object.entries(A).sort((b,L)=>parseFloat(L[0])-parseFloat(b[0]));if(T.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì):*
`;for(const[b,L]of T)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(c.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö*
`,t+=`------------------------------

`;let S=1;c.forEach(T=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö
`,t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ${Number(T.width_m).toFixed(2)} ‡∏°.
`,t+=`  - ‡∏™‡∏µ‡∏£‡∏≤‡∏á: ${T.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${T.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`,T.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${T.notes}
`),t+=`
`});const g=c.reduce((T,b)=>{const L=Number(b.width_m).toFixed(2);return T[L]=(T[L]||0)+1,T},{}),A=Object.entries(g).sort((T,b)=>parseFloat(b[0])-parseFloat(T[0]));if(A.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[T,b]of A)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${T} ‡∏°. = ${b} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(f.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö)*
`,t+=`------------------------------

`;let S=1;f.forEach(b=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,b.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(b.width_m).toFixed(2)} ‡∏°.
`),b.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(b.width_m).toFixed(2)} ‡∏°.
`),b.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),t+=`
`});const g=[];f.forEach(b=>{b.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&g.push(Number(b.width_m)),b.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&g.push(Number(b.width_m))});const A=g.reduce((b,L)=>{const q=L.toFixed(2);return b[q]=(b[q]||0)+1,b},{}),T=Object.entries(A).sort((b,L)=>parseFloat(L[0])-parseFloat(b[0]));if(T.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[b,L]of T)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(p.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà)*
`,t+=`------------------------------

`;let S=1;p.forEach(q=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${q.style}, ‡∏™‡∏µ: ${q.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,q.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(q.width_m).toFixed(2)} ‡∏°.
`),q.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(q.width_m).toFixed(2)} ‡∏°.
`),q.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${q.notes}
`),t+=`
`}),t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡πÑ‡∏Å‡πà ---
`;const g=[];p.forEach(q=>{q.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&g.push(Number(q.width_m)),q.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&g.push(Number(q.width_m))});const A=6;g.sort((q,P)=>P-q);const T=[];for(const q of g){let P=!1;for(let C=0;C<T.length;C++)if(T[C]>=q-.001){T[C]-=q,P=!0;break}P||T.push(A-q)}t+=`‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (6 ‡∏°.) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: *${T.length} ‡πÄ‡∏™‡πâ‡∏ô*

`;const b=g.reduce((q,P)=>{const C=P.toFixed(2);return q[C]=(q[C]||0)+1,q},{}),L=Object.entries(b).sort((q,P)=>parseFloat(P[0])-parseFloat(q[0]));if(L.length>0){t+=`*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[q,P]of L)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${q} ‡∏°. = ${P} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(u.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö)*
`,t+=`------------------------------

`;let S=1;u.forEach(b=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${b.style}, ‡∏™‡∏µ: ${b.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡∏£‡∏≤‡∏á: ${Number(b.width_m).toFixed(2)} ‡∏°.
`,b.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${b.notes}
`),t+=`
`});const A=u.map(b=>Number(b.width_m)).reduce((b,L)=>{const q=L.toFixed(2);return b[q]=(b[q]||0)+1,b},{}),T=Object.entries(A).sort((b,L)=>parseFloat(L[0])-parseFloat(b[0]));if(T.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[b,L]of T)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${b} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}const v={};let m={};s.allSets.forEach(S=>{const g=S.track_color||"‡∏Ç‡∏≤‡∏ß",A=_(S.width_m),T=S.style,b=S.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á";let L=0;if(T==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"?L=A>=1.6?3:2:(T==="‡∏•‡∏≠‡∏ô"||T==="‡∏à‡∏µ‡∏ö")&&(L=Math.round(A/.8)+1),v[g]||(v[g]={brackets:{},finials:0,grommets:{},rodPocketBrackets:0}),v[g].brackets[T]||(v[g].brackets[T]={single:0,double:0}),L>0?b?v[g].brackets[T].double+=L:v[g].brackets[T].single+=L:T==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(v[g].rodPocketBrackets+=4),T==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const q=b?4:2;v[g].finials+=q}if(T==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const q=S.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",P=W.calculateGrommets(S);v[g].grommets[q]||(v[g].grommets[q]=0),v[g].grommets[q]+=P}if(T==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const q=S.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤";q!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"&&(m[q]=(m[q]||0)+2)}});const h=s.allSets.filter(S=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(S.style)).length*2,w=Object.values(v).some(S=>Object.values(S.brackets).some(g=>g.single>0||g.double>0)),k=Object.values(v).some(S=>S.rodPocketBrackets>0),x=Object.values(v).some(S=>S.finials>0),I=Object.values(v).some(S=>Object.values(S.grommets).some(g=>g>0)),B=Object.keys(m).length>0;if(w||k||x||I||h>0||B){t+=`------------------------------
`,t+=`üî© *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Hardware)*
`,t+=`------------------------------

`;for(const[g,A]of Object.entries(v)){let T=!1,b=`**‡∏™‡∏µ${g}**
`;const L=Object.keys(A.brackets);if(L.length>0){let P="";L.forEach(C=>{!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(C)&&(A.brackets[C].single>0||A.brackets[C].double>0)&&(P+=`    - ${C} (‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß): ${A.brackets[C].single} ‡∏ï‡∏±‡∏ß
`,P+=`    - ${C} (2‡∏ä‡∏±‡πâ‡∏ô): ${A.brackets[C].double} ‡∏ï‡∏±‡∏ß
`)}),P&&(T=!0,b+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô):
${P}`)}A.rodPocketBrackets>0&&(T=!0,b+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö): ${A.rodPocketBrackets} ‡∏ï‡∏±‡∏ß
`),A.finials>0&&(T=!0,b+=`  - ‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà): ${A.finials} ‡∏ï‡∏±‡∏ß
`);const q=Object.keys(A.grommets);if(q.length>0){let P="";q.forEach(C=>{const R=A.grommets[C];R>0&&(P+=`    - ‡∏™‡∏µ${C}: ${R} ‡∏ï‡∏±‡∏ß
`)}),P&&(T=!0,b+=`  - ‡∏ï‡∏≤‡πÑ‡∏Å‡πà:
${P}`)}T&&(t+=b+`
`)}let S="";if(h>0&&(S+=`  - ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏£‡∏ß‡∏ö‡∏°‡πà‡∏≤‡∏ô (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô): ${h} ‡∏ï‡∏±‡∏ß
`),B){S+=`  - ‡∏û‡∏π‡πà/‡∏™‡∏≤‡∏¢‡∏£‡∏ß‡∏ö (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå):
`;for(const[g,A]of Object.entries(m))S+=`    - ${g}: ${A} ‡∏ä‡∏∏‡∏î
`}S&&(t+=`**‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°**
`+S+`
`)}const H=Object.keys(s).filter(S=>!["opaqueFabrics","sheerFabrics","wallpapers","allSets"].includes(S));H.length>0&&H.sort().forEach(S=>{const g=s[S],A=Q[S]||S;t+=`------------------------------
`,t+=`üì¶ *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${A}*
`,t+=`------------------------------

`,g.forEach(T=>{t+=`- ‡∏£‡∏´‡∏±‡∏™: #${T.code||"xxx"}
  ‡∏Ç‡∏ô‡∏≤‡∏î: ${T.width.toFixed(2)} x ${T.height.toFixed(2)} ‡∏°.
`,T.opening_style&&(t+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${T.opening_style}
`),T.adjustment_side&&(t+=`  ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${T.adjustment_side}
`),T.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${T.notes}
`),t+=`
`})});const O={};if(s.wallpapers.forEach(S=>{O[S.code]=(O[S.code]||0)+S.rolls}),Object.keys(O).length>0&&(t+=`------------------------------
`,t+=`üé® *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,t+=`------------------------------

`,s.wallpapers.forEach((S,g)=>{t+=`  - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ #${g+1}
`,t+=`    ‡∏£‡∏´‡∏±‡∏™: #${S.code||"xxx"}
`,t+=`    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.rolls} ‡∏°‡πâ‡∏ß‡∏ô
`,S.notes&&(t+=`    üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),Object.keys(O).length>1)){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏≠‡∏•‡∏•‡πå ---
`;for(const[S,g]of Object.entries(O))t+=`  - ‡∏£‡∏´‡∏±‡∏™ #${S}: ${g} ‡∏°‡πâ‡∏ß‡∏ô
`;t+=`
`}if(n==="purchase_order")return t+=`------------------------------
`,t}if(n==="seamstress"||n==="owner"){t+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏¢‡πá‡∏ö‡∏ú‡πâ‡∏≤*
`;let s=0;if(e.rooms.forEach(i=>{if(i.is_suspended||!i.items)return;const d=i.items.filter(c=>c.type==="set"&&!c.is_suspended&&_(c.width_m)>0&&_(c.height_m)>0);d.length!==0&&(s>0&&(t+=`==============================
`),t+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${i.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*

`,d.forEach((c,p)=>{p>0&&(t+=`--------------------
`);const u=c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?Q.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":c.style;t+=`*‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà ${p+1}/${d.length}: ${u} ${c.fabric_variant}*
`,c.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?t+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${c.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`:c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(t+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${c.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,t+=`  - ‡∏û‡∏π‡πà: ${c.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`):c.style!=="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(t+=`  - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${c.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"}
`),c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡∏ó‡∏∂‡∏ö): #${c.fabric_code||"-"}
`),c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡πà‡∏á): #${c.sheer_fabric_code||"-"}
`)):(c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: #${c.fabric_code||"-"}
`),c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: #${c.sheer_fabric_code||"-"}
`)),t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(c.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(c.height_m).toFixed(2)} ‡∏°.
`,c.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${c.notes}
`)}),t+=`
`,s++)}),s>0?t+=`==============================
`:t+=`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
------------------------------
`,n==="seamstress")return t}return n==="owner"&&(t+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${E(r)} ‡∏ö‡∏≤‡∏ó*
`,o>0&&(t+=`   (‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏î: ${E(l)} ‡∏ö‡∏≤‡∏ó ${a.trim()})
`)),t}function zt(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let n="";const l={};let o=0;if(e.rooms.forEach(t=>{t.is_suspended||!t.items||t.items.forEach(s=>{if(s.is_suspended)return;let i=null,d=0;switch(s.type){case"set":d=W.calculateSetPrice(s).total,d>0&&(i=s.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":d=W.calculateWallpaperPrice(s).total,d>0&&(i=s.type);break;default:j[s.type]?.templateId==="#areaBasedTpl"&&(d=W.calculateAreaBasedPrice(s).total,d>0&&(i=s.type));break}i&&(l[i]=(l[i]||0)+1,o++)})}),o>0){const t=Object.entries(l).map(([s,i])=>{const d=Q[s]||Q[s.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                <span class="summary-tag" data-filter-type="${M(s)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                    ${M(d)} <strong>${i}</strong>
                </span>`}).join("");t&&(n+=`
                <div class="overview-summary-group">
                    <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                    <div class="summary-tags-container">
                        ${t}
                    </div>
                </div>`)}let a="",r=0;return e.rooms.forEach(t=>{if(t.is_suspended||!t.items)return;const s={};let i=0;if(t.items.forEach(d=>{if(d.is_suspended)return;let c=null,p=0;switch(d.type){case"set":p=W.calculateSetPrice(d).total,p>0&&(c=d.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":p=W.calculateWallpaperPrice(d).total,p>0&&(c=d.type);break;default:j[d.type]?.templateId==="#areaBasedTpl"&&(p=W.calculateAreaBasedPrice(d).total,p>0&&(c=d.type));break}c&&(s[c]=(s[c]||0)+1,i++)}),i>0){r+=i;const d=Object.entries(s).map(([c,p])=>{const u=Q[c]||Q[c.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                    <div class="overview-item">
                        <span>${M(u)}</span>
                        <span>${p}</span>
                    </div>`}).join("");a+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${M(t.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${i} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${d}</div>
                </details>`}}),a&&(n+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${a}
            </div>`),o===0&&r===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':n}function Zt(e,n){const{vatRate:l=X.baseVatRate,pageBreakBuffer:o=3,showDetails:a=!0}=n,r=[];e.rooms.forEach(b=>{if(b.is_suspended||!b.items)return;const L=[];if(b.items.forEach(q=>{if(q.is_suspended)return;let P="",C=0,R=0,N=0,Y=1,le=q.type==="set"&&q.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?Q.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":Q[q.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",ae="";switch(q.type){case"set":if(C=W.calculateSetPrice(q).total,C>0){R=_(q.width_m),N=_(q.height_m);const F=q.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"":` ${M(q.style||"")}`;P=`${le}${F} (${M(q.fabric_variant||"")})`,a&&(ae=`<br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${R.toFixed(2)} x ${N.toFixed(2)} ‡∏°.${q.notes?` - ${M(q.notes)}`:""}</small>`),Y=a?1.5:1}break;case"wallpaper":if(C=W.calculateWallpaperPrice(q).total,C>0){const F=(q.widths||[]).reduce((ke,xe)=>ke+_(xe),0),pe=W.wallpaperRolls(F,q.height_m);N=_(q.height_m),P=`${le}`,a&&(ae=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${M(q.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${N.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${pe} ‡∏°‡πâ‡∏ß‡∏ô)${q.notes?` - ${M(q.notes)}`:""}</small>`),Y=a?1.5:1}break;default:j[q.type]?.templateId==="#areaBasedTpl"&&(C=W.calculateAreaBasedPrice(q).total,C>0&&(R=_(q.width_m),N=_(q.height_m),P=`${le}`,a&&(ae=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${M(q.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${R.toFixed(2)} x ${N.toFixed(2)} ‡∏°.${q.notes?` - ${M(q.notes)}`:""}</small>`),Y=a?1.5:1));break}C>0&&P&&L.push({description:P+ae,unitPrice:C,units:Y})}),L.length>0){r.length>0&&r.push({isSpacer:!0,units:.5}),r.push({isRoomHeader:!0,roomName:M(b.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2});const q=new Map;L.forEach(P=>{const C=`${P.description}::${P.unitPrice}`;q.has(C)?q.get(C).quantity+=1:q.set(C,{...P,quantity:1})}),q.forEach(P=>{r.push({...P,total:P.quantity*P.unitPrice})})}});const t=r.reduce((b,L)=>b+(L.total||0),0);if(t===0)return null;let s=0,i="",d=t;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(s=t*(e.discount.value/100),i=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${ne(s,2,!0)}</td></tr>`):(s=e.discount.value,i=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${ne(s,2,!0)}</td></tr>`),d=t-s);const c=d*l,p=d+c,u=a?17:20,f=a?23:28,v=[];let m=[],h=0;r.forEach((b,L)=>{const q=v.length===0?u:f,P=h+b.units>q;let C=!1;if(b.isRoomHeader&&L<r.length-1){const N=r[L+1].units||(a?1.5:1);h+b.units+N>q&&h+b.units<=q&&(C=!0)}let R=!1;if(!P&&!C&&L<r.length-1){const N=q-(h+b.units),Y=r[L+1].units||(a?1.5:1);N>0&&N<o&&N<Y&&!b.isRoomHeader&&!b.isSpacer&&(R=!0)}(P||C||R)&&m.length>0&&(v.push(m),m=[],h=0),m.push(b),h+=b.units}),m.length>0&&v.push(m);const w=new Date,k=w.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),x=`${w.getFullYear().toString().slice(-2)}${(w.getMonth()+1).toString().padStart(2,"0")}${w.getDate().toString().padStart(2,"0")}`,I=e.customer_name||e.customer_phone||"Customer";let B=0;for(let b=0;b<I.length;b++)B=(B<<5)-B+I.charCodeAt(b),B=B&B;const H=`QT-${Math.abs(B)%9e3+1e3}-${x}`;let O="",S=0,g=1;v.forEach((b,L)=>{const q=L===0,P=L===v.length-1,C=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                     <div class="pdf-shop-info">
                        
                        <div class="pdf-shop-address">
                            <strong><i class=""></i> ${M(X.name)}</strong><br>
                            ${M(X.address).replace(/\n/g,"<br>")}<br>
							‡πÇ‡∏ó‡∏£: ${M(X.phone)}<br>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${M(X.taxId)}
                        </div>
                    </div>
                     <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${v.length>1?q?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${H}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${k}</td></tr>
                        </table>
                    </div>
                </div>
                ${q?`
                <section class="pdf-customer-details">
                     <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${M(e.customer_name)||"-"}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${M(e.customer_address||"-").replace(/\n/g,"<br>")}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${M(e.customer_phone)||"-"}
                    </div>
                    </section>`:""}
            </div>`,R=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span><i class=""></i> ${M(X.name)} | ‡πÇ‡∏ó‡∏£: ${M(X.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${L+1} / ${v.length}</span>
                </div>
            </div>`;let N="";q||(N+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${ne(S,2,!0)}</td></tr>`),b.forEach(F=>{F.isSpacer?N+='<tr class="pdf-room-spacer" style="page-break-inside: avoid; background: #fff !important;"><td colspan="5" style="border: none; padding: 1.5mm 0 !important; line-height: 1.5mm;">&nbsp;</td></tr>':F.isRoomHeader?N+=`<tr class="pdf-room-header" style="page-break-after: avoid;"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${F.roomName}</td></tr>`:(N+=`<tr>
                    <td class="pdf-text-center">${g++}</td>
                    <td>${F.description}</td>
                    <td class="pdf-text-center">${F.quantity}</td>
                    <td class="pdf-text-right">${ne(F.unitPrice,2,!0)}</td>
                    <td class="pdf-text-right">${ne(F.total,2,!0)}</td>
                </tr>`,S+=F.total)});let Y="";P||(Y=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${ne(S,2,!0)}</td></tr></tfoot>`);let le="";a&&X.pdf.notes&&X.pdf.notes.length>0&&(le=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${X.pdf.notes.map(F=>`<li>${M(F)}</li>`).join("")}</ul>
            `);const ae=P?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${le}
                        <div class="pdf-amount-text">( ${Rt(p)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${ne(t,2,!0)}</td></tr>
                            ${i}
                            ${l>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(l*100).toFixed(0)}%</td><td class="pdf-amount">${ne(c,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${ne(p,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>(.................................................)</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(<i class=""></i> ${M(X.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${k}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>(.................................................)</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";O+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${C}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                             <3:
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:45%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${N}</tbody>
                            ${Y}
                        </table>
                        ${ae}
                    </div>
                    ${R}
                </div>
            </div>`});const A=e.customer_name||"quote",T=ht(A);return{html:`<div id="quotation-template">${O}</div>`,fileName:`${H}_${T}`}}function eo(e){const n=_t(e);let l=0;e.discount?.value>0&&(l=e.discount.type==="percent"?n*(e.discount.value/100):e.discount.value);const o=n-l;let a=!1,r=e.rooms.map(s=>{if(s.is_suspended)return"";const i=s.items.filter(c=>c.is_suspended?!1:c.type==="set"||j[c.type]?.templateId==="#areaBasedTpl"?_(c.width_m)>0&&_(c.height_m)>0:c.type==="wallpaper"?(c.widths||[]).reduce((u,f)=>u+_(f),0)>0&&_(c.height_m)>0:!1);if(i.length===0)return"";const d=i.map((c,p)=>{let u="",f="",v="",m="";switch(c.type==="set"?c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(m=Q.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",f=`<h5 class="lookbook-item-title">${M(m)}</h5>`):c.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?(m=Q.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",f=`<h5 class="lookbook-item-title">${M(m)} ${M(c.style)}</h5>`):m=Q.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô":(m=Q[c.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",f=`<h5 class="lookbook-item-title">${M(m)}</h5>`),c.type){case"set":v=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${_(c.width_m).toFixed(2)} x ${_(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${m} (${M(c.fabric_variant||"")})</td></tr>
                            ${c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô</td><td>#${M(c.fabric_code)||"-"}</td></tr>`:""}
                            ${c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${M(c.sheer_fabric_code)||"-"}</td></tr>`:""}
                            <tr><td>‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå</td><td>${M(c.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå")}</td></tr>
                            <tr><td>‡∏û‡∏π‡πà</td><td>${M(c.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤")}</td></tr>
                         `:c.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?u=`
                             <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${M(c.style)} (${M(c.fabric_variant||"")})</td></tr>
                             ${c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${M(c.fabric_code)||"-"}</td></tr>`:""}
                             ${c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${M(c.sheer_fabric_code)||"-"}</td></tr>`:""}
                         `:(u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${M(c.style||"")} (${M(c.fabric_variant||"")})</td></tr>
                            ${c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ó‡∏∂‡∏ö</td><td>#${M(c.fabric_code)||"-"}</td></tr>`:""}
                            ${c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${M(c.sheer_fabric_code)||"-"}</td></tr>`:""}
                        `,c.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${M(c.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")}</td></tr>`:u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${M(c.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")}</td></tr>`);break;case"wallpaper":const h=(c.widths||[]).reduce((k,x)=>k+_(x),0),w=W.wallpaperRolls(h,c.height_m);v=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>‡∏£‡∏ß‡∏° ${h.toFixed(2)} ‡∏°., ‡∏™‡∏π‡∏á ${_(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`
                        <tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${M(c.wallpaper_code)||"-"}</td></tr>
                        <tr><td>‡πÉ‡∏ä‡πâ</td><td>${w} ‡∏°‡πâ‡∏ß‡∏ô</td></tr>
                    `;break;default:j[c.type]?.templateId==="#areaBasedTpl"&&(v=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${_(c.width_m).toFixed(2)} x ${_(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`<tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${M(c.code)||"-"}</td></tr>`,c.opening_style&&(u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${M(c.opening_style)}</td></tr>`),c.adjustment_side&&(u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${M(c.adjustment_side)}</td></tr>`));break}return u&&(a=!0),`
                 <div class="lookbook-details">
                    ${Kt(c,s.id,p)}
                    <div class="spec-table-wrapper">
                        ${f}
                        <table class="spec-table">
                            ${u}
                            ${v}
                            ${c.notes?`<tr><td>‡πÇ‡∏ô‡πâ‡∏ï</td><td>${M(c.notes)}</td></tr>`:""}
                        </table>
                    </div>
                </div>
            `}).join('<hr class="lookbook-hr">');return d.trim()?`
            <div class="lookbook-room">
                <h4><i class="ph ph-map-pin"></i> ${M(s.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</h4>
                ${d}
            </div>
        `:""}).join("");return a?`
        <div class="lookbook-summary">
            <div class="lookbook-customer-info">
                <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${M(e.customer_name)||"-"}<br/>
                <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${M(e.customer_address||"-").replace(/\n/g,"<br/>")}
            </div>
            <div class="lookbook-totals">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î): ${E(n)} ‡∏ö‡∏≤‡∏ó</span>
                ${l>0?`<span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${E(l)} ‡∏ö‡∏≤‡∏ó</span>`:""}
                <span class="grand-total">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${E(o)} ‡∏ö‡∏≤‡∏ó</span>
            </div>
        </div>
    `+r:'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>'}function vt(e={}){const n=document.querySelector(y.roomTpl);if(!n)return console.error("Room template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.id=e.id||`room-${Date.now()}`,o.open=e.is_open!==!1,o.dataset.roomDefaults=JSON.stringify(e.room_defaults||{});const a=o.querySelector(y.roomNameInput),r=o.querySelector("[data-room-name-display]"),t=o.querySelector("[data-room-brief]"),s=o.querySelector(y.allItemsContainer),i=()=>{const p=a.value||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";r&&(r.textContent=p)};a&&a.addEventListener("input",i);const d=o.querySelector("summary");d&&d.addEventListener("click",()=>{});const c=e.room_name||`‡∏´‡πâ‡∏≠‡∏á ${document.querySelectorAll(y.room).length+1}`;if(a){a.value=c;const p=`room_name_${o.id}`;a.id=p;const u=a.closest(".form-group")?.querySelector("label");u&&u.setAttribute("for",p)}return r&&(r.textContent=c),e.is_suspended&&o.classList.add("is-suspended"),o.getItemsContainer=()=>s,o.updateBrief=p=>{t&&(t.innerHTML=p)},o}function _e(e={}){const n=document.querySelector(y.setTpl);if(!n)return console.error("Set template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type="set";const a=o.querySelector('input[name="width_m"]'),r=o.querySelector('input[name="height_m"]'),t=o.querySelector('select[name="set_style"]'),s=o.querySelector('select[name="fabric_variant"]'),i=o.querySelector('select[name="set_price_per_m"]'),d=o.querySelector('select[name="sheer_price_per_m"]'),c=o.querySelector('select[name="louis_price_per_m"]'),p=o.querySelector('input[name="fabric_code"]'),u=o.querySelector('input[name="sheer_fabric_code"]'),f=o.querySelector('select[name="opening_style"]'),v=o.querySelector('select[name="adjustment_side"]'),m=o.querySelector('input[name="notes"]'),h=o.querySelector('[data-set-control="opening_style_wrap"]'),w=o.querySelector('[data-set-control="adjustment_side_wrap"]'),k=o.querySelector('[data-set-control="louis_price_wrap"]'),x=o.querySelector('[data-set-control="fabric_price_wrap"]'),I=o.querySelector('[data-set-control="fabric_code_wrap"]'),B=o.querySelector("[data-sheer-wrap]"),D=o.querySelector("[data-sheer-code-wrap]"),H=o.querySelector("[data-set-summary]"),O=o.querySelector(".item-details-more"),S=o.querySelector('[data-act="toggle-more-details"]'),g=S?.parentElement,A=()=>({width_m:a.value,height_m:r.value,style:t.value,fabric_variant:s.value,price_per_m_raw:i.value,sheer_price_per_m:d.value,louis_price_per_m:c.value,is_suspended:o.classList.contains("is-suspended")}),T=()=>{const C=A(),R=W.calculateSetPrice(C);o.dataset.totalPrice=R.total;let N=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${E(R.total)}</b> ‡∏ö.`;if(C.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const F=[];R.opaque>0&&F.push(`‡∏ó‡∏∂‡∏ö: ${E(R.opaque)}`),R.sheer>0&&F.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(R.sheer)}`),R.louis>0&&F.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${E(R.louis)}`),F.length>0&&(N+=` <small>(${F.join(", ")})</small>`)}else R.opaque>0&&R.sheer>0&&(N+=` <small>(‡∏ó‡∏∂‡∏ö: ${E(R.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(R.sheer)})</small>`);const Y=W.fabricYardage(C.style,C.width_m);Y>0&&(N+=` <small>&bull; ${Y.toFixed(2)} ‡∏´‡∏•‡∏≤</small>`);const le=_(C.height_m);let ae="";if(le>2.8?ae='<div class="height-warning" style="margin-top: 0.5rem; width: fit-content;">(‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡πâ‡∏≤ ‡∏ï‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏¢‡∏≤‡∏ß)</div>':le>2.5&&(ae='<div class="height-warning" style="margin-top: 0.5rem; width: fit-content;">(‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ú‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ 3.20)</div>'),N+=ae,H?H.innerHTML=N:console.warn("Summary element not found for set item."),S){let F=[];const pe=C.style,ke=C.fabric_variant,xe=_(C.price_per_m_raw),et=_(C.sheer_price_per_m),tt=_(C.louis_price_per_m);pe==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?tt>0&&F.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${E(tt)}`):(ke.includes("‡∏ó‡∏∂‡∏ö")&&xe>0&&F.push(`‡∏ó‡∏∂‡∏ö: ${E(xe)}`),ke.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&et>0&&F.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(et)}`));const Re=F.join(" | ");S.dataset.priceSummary=Re;const Fe=S.querySelector("span");O&&Fe&&!O.classList.contains("show")&&(Re?Fe.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${Re})</small>`:Fe.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},b=qe(()=>{T(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),L=()=>{const C=t.value,R=s.value,N=C==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",Y=R.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),le=R==="‡πÇ‡∏õ‡∏£‡πà‡∏á"&&!N,ae=R==="‡∏ó‡∏∂‡∏ö"&&!N;B?.classList.toggle("hidden",!Y||N),D?.classList.toggle("hidden",!Y||N);const F=le||N;i&&(i.disabled=F,F&&(i.value="")),p&&(p.disabled=F,F&&(p.value=""));const pe=ae||N;d&&(d.disabled=pe,pe&&(d.value="")),u&&(u.disabled=pe,F&&(u.value=""))},q=()=>{const C=t.value,R=C==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",N=C==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",Y=R||N||C==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö";h&&h.classList.toggle("hidden",Y),w&&w.classList.toggle("hidden",!R),k&&k.classList.toggle("hidden",!N),x&&x.classList.toggle("hidden",N),I&&I.classList.toggle("hidden",N),L()};o.addEventListener("input",C=>{C.target===s&&L(),C.target===t&&q(),b()});const P=C=>{Ye(C),b()};if(a.addEventListener("blur",P),r.addEventListener("blur",P),O&&g){const C=o.querySelector(".item-grid");C&&C.appendChild(g)}return a.value=K(e.width_m),r.value=K(e.height_m),t.value=e.style||"‡∏•‡∏≠‡∏ô",s.value=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",i.value=e.price_per_m_raw||"",d.value=e.sheer_price_per_m||"",c.value=e.louis_price_per_m||"",p.value=e.fabric_code||"",u.value=e.sheer_fabric_code||"",f.value=e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",v.value=e.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",m.value=e.notes||"",o.querySelector('input[name="track_color"]').value=e.track_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="bracket_color"]').value=e.bracket_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="finial_color"]').value=e.finial_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="grommet_color"]').value=e.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",o.querySelector('input[name="louis_valance"]').value=e.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",o.querySelector('input[name="louis_tassels"]').value=e.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",e.is_suspended&&o.classList.add("is-suspended"),q(),T(),o}function Ge(e={}){const n=document.querySelector(y.wallTpl);if(!n)return null;const o=n.content.cloneNode(!0).firstElementChild,a=o.querySelector('input[name="wall_width_m"]');a.value=K(e.width);const r=`wall_width_${Date.now()}_${Math.random().toString(36).substring(2,7)}`;a.id=r;const t=o.querySelector("label");return t&&t.setAttribute("for",r),o}function ve(e={}){const n=document.querySelector(y.wallpaperTpl);if(!n)return console.error("Wallpaper template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type="wallpaper";const a=o.querySelector('[name="wallpaper_height_m"]'),r=o.querySelector('[name="wallpaper_price_roll"]'),t=o.querySelector('[name="wallpaper_install_cost"]'),s=o.querySelector('[name="wallpaper_code"]'),i=o.querySelector('[name="wallpaper_notes"]'),d=o.querySelector("[data-walls-container]"),c=o.querySelector("[data-wallpaper-summary]"),p=o.querySelector(".item-details-more"),u=o.querySelector('[data-act="toggle-more-details"]'),f=u?.parentElement,v=()=>({height_m:a.value,price_per_roll:r.value,install_cost_per_roll:t.value,widths:Array.from(d.querySelectorAll('input[name="wall_width_m"]')).map(k=>k.value),is_suspended:o.classList.contains("is-suspended")}),m=()=>{const k=v(),x=W.calculateWallpaperPrice(k);o.dataset.totalPrice=x.total;let I=`‡∏£‡∏ß‡∏°: <b>${E(x.total)}</b> ‡∏ö. `;if((x.material>0||x.install>0)&&(I+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${E(x.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${E(x.install)})</small>`),x.rolls>0&&(I+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ne(x.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${x.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),c&&(c.innerHTML=I),u){let B=[];const D=_(k.price_per_roll),H=k.install_cost_per_roll;if(D>0&&B.push(`‡∏°‡πâ‡∏ß‡∏ô: ${E(D)}`),H==="0")B.push("‡∏ä‡πà‡∏≤‡∏á: 0");else{const g=_(H);g>0&&B.push(`‡∏ä‡πà‡∏≤‡∏á: ${E(g)}`)}const O=B.join(" | ");u.dataset.priceSummary=O;const S=u.querySelector("span");p&&S&&!p.classList.contains("show")&&(O?S.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${O})</small>`:S.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},h=qe(()=>{m(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);o.addEventListener("input",h);const w=k=>{Ye(k),h()};if(a.addEventListener("blur",w),o.addEventListener("blur",k=>{k.target.name==="wall_width_m"&&w(k)},!0),p&&f){const k=o.querySelector(".item-grid");k&&k.appendChild(f)}if(e.widths&&e.widths.length>0)e.widths.forEach(k=>{const x=Ge({width:k});x&&d.appendChild(x)});else{const k=Ge();k&&d.appendChild(k)}return a.value=K(e.height_m),r.value=e.price_per_roll>0?E(e.price_per_roll):"",e.hasOwnProperty("install_cost_per_roll")?t.value=e.install_cost_per_roll===0?"0":e.install_cost_per_roll>0?E(e.install_cost_per_roll):"":t.value=t.value,s.value=e.wallpaper_code||"",i.value=e.notes||"",e.is_suspended&&o.classList.add("is-suspended"),m(),o}function ge(e,n={}){const l=document.querySelector(y.areaBasedTpl);if(!l)return console.error("AreaBased template not found"),null;const a=l.content.cloneNode(!0).firstElementChild;a.dataset.type=e;const r=j[e]||{name:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};a.classList.add(`${e.replace(/_/g,"-")}-item`);const t=a.querySelector(".item-type-display"),s=a.querySelector('[name="area_width_m"]'),i=a.querySelector('[name="area_height_m"]'),d=a.querySelector('[name="area_price_sqyd"]'),c=a.querySelector('[name="area_code"]'),p=a.querySelector('[name="area_notes"]'),u=a.querySelector(".btn-favorite"),f=a.querySelector(".btn-show-favs"),v=a.querySelector("[data-area-summary]"),m=a.querySelector(".item-details-more"),h=a.querySelector('[data-act="toggle-more-details"]'),w=h?.parentElement,k=m?.querySelector(".item-grid"),x=k?.querySelector('[name="area_price_sqyd"]')?.closest(".form-group");let I,B;if(k&&x){if(e==="partition"||e==="pleated_screen"){const g=document.createElement("div");g.className="form-group",g.innerHTML=`
                <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î
                    <select name="opening_style">
                        <option value="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á">‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
                    </select>
                </label>
            `,k.insertBefore(g,x),I=g.querySelector("select")}else if(["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(e)){const g=document.createElement("div");g.className="form-group",g.innerHTML=`
                <label>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö
                    <select name="adjustment_side">
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤</option>
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢">‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢</option>
                    </select>
                </label>
            `,k.insertBefore(g,x),B=g.querySelector("select")}(I||B)&&x&&x.classList.remove("full-width-item")}const D=()=>({width_m:s.value,height_m:i.value,price_sqyd:d.value,is_suspended:a.classList.contains("is-suspended")}),H=()=>{const g=D(),A=W.calculateAreaBasedPrice(g);a.dataset.totalPrice=A.total;const T=A.sqyd>0?` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ne(A.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`:"";if(v&&(v.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${E(A.total)}</b> ‡∏ö.${T}`),h){let b="";const L=_(g.price_sqyd);L>0&&(b=`‡∏ï‡∏£.‡∏´‡∏•‡∏≤: ${E(L)}`),h.dataset.priceSummary=b;const q=h.querySelector("span");m&&q&&!m.classList.contains("show")&&(b?q.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${b})</small>`:q.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},O=qe(()=>{H(),a.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);a.addEventListener("input",O);const S=g=>{Ye(g),O()};if(s.addEventListener("blur",S),i.addEventListener("blur",S),m&&w){const g=a.querySelector(".item-grid");g&&g.appendChild(w)}return t&&(t.textContent=r.name),c&&(c.dataset.favoriteType=e),u&&(u.dataset.type=e),f&&(f.dataset.type=e),s.value=K(n.width_m),i.value=K(n.height_m),d.value=n.price_sqyd>0?E(n.price_sqyd):"",c.value=n.code||"",p.value=n.notes||"",I&&(I.value=n.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),B&&(B.value=n.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"),n.is_suspended&&a.classList.add("is-suspended"),H(),a}let Te=!1;async function to(){const e=document.querySelector(y.exportOptionsModal);if(!e)return null;const n=e.querySelector("#pageBreakBuffer"),l=e.querySelector("#pageBreakBufferValue");n&&l&&(l.textContent=n.value,n.oninput=()=>{l.textContent=n.value});const o=await V(y.exportOptionsModal);return n&&(n.oninput=null),!o||o.cancelled?null:{vatOption:e.querySelector('input[name="vat_option"]:checked')?.value||"include",showDetails:(e.querySelector('input[name="item_details_option"]:checked')?.value||"show_details")==="show_details",exportMethod:e.querySelector("#exportMethod")?.value||"direct",pageBreakBuffer:parseInt(n?.value,10)||3}}function oo(e,n){const l=e.querySelector("#discountToggle"),o=e.querySelector("#vatToggle"),a=e.querySelector("#discountInputsGroup"),r=e.querySelector("#discountVatResultRow"),t=e.querySelector("#discountPercent"),s=e.querySelector("#discountAmount"),i=e.querySelector("#discountFinalTotal"),d=e.querySelector("#discountFinalTotalWithVat"),c=h=>{if(Te)return;Te=!0;const w=l.checked,k=o.checked;a.classList.toggle("is-disabled",!w),t.disabled=!w,s.disabled=!w;let x=0;if(w){if(h==="percent"){const B=_(t.value);x=n*(Math.max(0,B)/100),s.value=x>0?E(Math.round(x)):""}else x=_(s.value);if(x=Math.max(0,Math.min(x,n)),h!=="percent"){const B=n>0?x/n*100:0;t.value=B>0&&isFinite(B)?ne(B,2):""}}else t.value="",s.value="";const I=n-x;if(i&&(i.textContent=E(I)),r.classList.toggle("hidden",!k),k){const B=I*(1+X.baseVatRate);d&&(d.textContent=E(B))}setTimeout(()=>{Te=!1},50)},p=()=>c("percent"),u=()=>c("amount"),f=()=>c("toggle"),v=h=>{_(h.target.value)>0&&(h.target.value=_(h.target.value))},m=h=>{const w=_(h.target.value);h.target.value=w>0?E(w):"",c("amount")};return l.addEventListener("change",f),o.addEventListener("change",f),t.addEventListener("input",p),s.addEventListener("input",u),s.addEventListener("focus",v),s.addEventListener("blur",m),{runInitialUpdate:h=>c(h),cleanup:()=>{t.removeEventListener("input",p),s.removeEventListener("input",u),s.removeEventListener("focus",v),s.removeEventListener("blur",m),l.removeEventListener("change",f),o.removeEventListener("change",f),Te=!1}}}async function ao(){const e=document.querySelector("#discountModal");if(!e)return Promise.resolve({cancelled:!0});const n=e.querySelector("#discountSubtotal"),l=e.querySelector("#discountPercent"),o=e.querySelector("#discountAmount");e.querySelector("#discountFinalTotal");const a=e.querySelector("#discountToggle"),r=e.querySelector("#vatToggle"),t=document.querySelector("#discount_type"),s=document.querySelector("#discount_value"),i=document.querySelector("#vat_enabled"),d=_(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);n&&(n.textContent=E(d));const{runInitialUpdate:c,cleanup:p}=oo(e,d),u=t.value,f=_(s.value),v=i.value==="1";l.value="",o.value="",a.checked=f>0,r.checked=v;let m="amount";a.checked&&(u==="percent"?(l.value=f,m="percent"):(o.value=f,o.value=E(f))),c(m);const h=await V("#discountModal");if(p(),h&&!h.cancelled){const w=a.checked,k=_(l.value),x=_(o.value),I=document.activeElement;w?k>0&&(I===l||I!==o)?(t.value="percent",s.value=k):x>0?(t.value="amount",s.value=x):(t.value="amount",s.value=0):(t.value="amount",s.value=0),i.value=r.checked?"1":"0",U()}}async function no(){const e=be();if(!e)return;const n=document.querySelector("#hardwareModal");if(!n)return;const l=e.querySelector('[name="set_style"]'),o=l?l.value:null,a=o==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà",r=o==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",t=o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",s=n.querySelector("#trackColorGroup"),i=n.querySelector("#bracketColorGroup"),d=n.querySelector("#finialColorGroup"),c=n.querySelector("#grommetColorGroup"),p=n.querySelector("#louisValanceGroup"),u=n.querySelector("#louisTasselGroup"),f=n.querySelector("#hardwareApplyToRoom");n.querySelector('[name="modal_track_color"]').value=e.querySelector('[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_bracket_color"]').value=e.querySelector('[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_finial_color"]').value=e.querySelector('[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_grommet_color"]').value=e.querySelector('[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",n.querySelector('[name="modal_louis_valance"]').value=e.querySelector('[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",n.querySelector('[name="modal_louis_tassels"]').value=e.querySelector('[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",s&&(s.style.display=""),i&&(i.style.display=""),d&&(d.style.display=a?"":"none"),c&&(c.style.display=a?"":"none"),p&&(p.style.display=t?"":"none"),u&&(u.style.display=t?"":"none"),f&&(f.disabled=r||t);const v=await V("#hardwareModal");v&&!v.cancelled&&(e.querySelector('[name="track_color"]').value=n.querySelector('[name="modal_track_color"]').value,e.querySelector('[name="bracket_color"]').value=n.querySelector('[name="modal_bracket_color"]').value,a?(e.querySelector('[name="finial_color"]').value=n.querySelector('[name="modal_finial_color"]').value,e.querySelector('[name="grommet_color"]').value=n.querySelector('[name="modal_grommet_color"]').value):t&&(e.querySelector('[name="louis_valance"]').value=n.querySelector('[name="modal_louis_valance"]').value,e.querySelector('[name="louis_tassels"]').value=n.querySelector('[name="modal_louis_tassels"]').value),ee(),$("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß","success"))}async function ct(){const e=document.querySelector("#roomControlCenterModal"),n=Ke();if(!n||!e){console.error("Batch confirm: Cannot find current room or modal context.");return}const l=e.querySelector("#batch-select-device-type-value"),o=e.querySelector("#batch-device-list-container"),a=e.querySelector("#batch-target-device-type-value"),r=l.value,t=a.value,s=Array.from(o.querySelectorAll('input[name="batch_device_select"]:checked')).map(f=>f.value);let i={};if(s.length===0){$("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç","warning");return}if(r===t&&t!=="set"){$("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô)","warning");return}if(t==="set"&&(i.new_style=e.querySelector("#batch-curtain-type").value,!i.new_style)){$("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà","warning");return}const d=j[t]?.name||t;let c=`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ${s.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${d}"`;if(i.new_style&&(c+=` (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ${i.new_style})`),c+="? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï",!await re("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°",c))return;se(G()),z();let p=0,u=null;s.forEach(f=>{const v=n.querySelector(`.item-card[data-batch-id="${f}"]`);if(!v){console.warn(`Item with batch-id "${f}" not found.`);return}const m=Lt(v);if(!m){console.warn(`Could not extract data from item with batch-id "${f}". Skipping.`);return}const h=v.classList.contains("is-suspended");let w={width_m:m.width_m,height_m:m.height_m,notes:m.notes};m.type==="set"&&t==="set"?(w={...m},w.style=i.new_style,i.new_style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||i.new_style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?(w.opening_style="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",i.new_style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(w.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")):i.new_style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&(w.opening_style="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",w.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",w.louis_valance=m.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",w.louis_tassels=m.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"),m.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&i.new_style!=="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&(delete w.louis_valance,delete w.louis_tassels,delete w.louis_price_per_m),m.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&i.new_style!=="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&(w.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")):t==="set"?w.style=i.new_style:t==="wallpaper"?m.type==="wallpaper"?(w.height_m=m.height_m,w.widths=m.widths):(w.widths=[w.width_m],delete w.width_m):j[t]?.templateId==="#areaBasedTpl"&&m.type==="wallpaper"&&delete w.width_m;let k;try{if(t==="set")k=_e(w);else if(t==="wallpaper")k=ve(w);else if(j[t]?.templateId==="#areaBasedTpl")k=ge(t,w);else{console.error(`Unsupported target type "${t}" during batch update.`);return}}catch(x){console.error(`Error creating new item element for batch-id "${f}":`,x);return}k&&(v.replaceWith(k),h&&k.classList.add("is-suspended"),k.classList.add("item-created"),p++,u||(u=k))}),p>0?(oe(),U(),$(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ${p} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,"success"),u&&setTimeout(()=>de(u),150)):$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç","warning"),e&&typeof e.closeModal=="function"&&e.closeModal({confirmed:!0,changed:p>0})}function ro(e,n,l){const o=r=>{const t=r.target,s=t.closest(".defaults-content");if(!s)return;const i=t.checked,d=s.querySelector(".defaults-inputs-grid");s.classList.toggle("is-enabled-content",i),d&&(d.style.display=i?"":"none",d.querySelectorAll('input[type="text"], input[type="number"], select, .btn-show-favs').forEach(c=>{c.disabled=!i,c.matches(".btn-show-favs")&&(c.style.opacity=i?"1":"0.5",c.style.pointerEvents=i?"auto":"none")}))};e.querySelectorAll(".defaults-content").forEach(r=>{const t=r.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(!t)return;const s=t.name,i=n[s]===!0||n[s]==="1";t.checked=i,o({target:t}),t.addEventListener("change",o),l({element:t,event:"change",handler:o});const d=r.querySelector(".defaults-inputs-grid");d&&d.querySelectorAll('input[type="text"], input[type="number"]').forEach(c=>{const p=c.name,u=n[p];c.type==="text"&&c.inputMode==="numeric"?(c.value=u===0?"0":u!=null&&u>0?E(u):"",c.addEventListener("focus",ft),c.addEventListener("blur",mt),l({element:c,event:"focus",handler:ft}),l({element:c,event:"blur",handler:mt})):c.value=u||""})})}function so(e,n,l){const o=e.querySelector("#batch-select-device-type-value"),a=e.querySelector("#batch-device-list-container"),r=e.querySelector("#batch-target-device-type-value"),t=e.querySelector("#batch-curtain-type-options"),s=e.querySelector("#batchEditorConfirmBtn"),i=e.querySelector(".batch-select-all-container"),d=()=>{o&&(o.value="");const m=document.getElementById("batch-select-device-type-display");m&&(m.textContent=m.dataset.placeholderText||"‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"),document.getElementById("batch-select-device-type")?.classList.add("is-placeholder"),a.innerHTML='<p class="placeholder-text">[‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£]</p>',r&&(r.value="");const h=document.getElementById("batch-target-device-type-display");h&&(h.textContent=h.dataset.placeholderText||"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà"),document.getElementById("batch-target-device-type")?.classList.add("is-placeholder"),t.classList.add("hidden"),i&&i.classList.add("hidden"),s.disabled=!0},c=()=>{const m=r.value!=="",h=a.querySelector('input[name="batch_device_select"]:checked')!==null;s.disabled=!(m&&h)},p=m=>{const h=m.detail.type;ut(h,a,n),c()};document.addEventListener("batch-type-filter-change",p),l({element:document,event:"batch-type-filter-change",handler:p});const u=m=>{const h=e.querySelector("#batch-select-all-checkbox");if(m.target.id==="batch-select-all-checkbox"){const w=m.target.checked;a.querySelectorAll('input[name="batch_device_select"]').forEach(k=>{k.checked=w})}else if(m.target.name==="batch_device_select"){const w=a.querySelectorAll('input[name="batch_device_select"]'),k=Array.from(w).every(I=>I.checked),x=Array.from(w).some(I=>I.checked);h&&(h.checked=k,h.indeterminate=!k&&x)}c()};i.addEventListener("change",u),l({element:i,event:"change",handler:u}),a.addEventListener("change",u),l({element:a,event:"change",handler:u});const f=m=>{const w=m.target.value==="set";t.classList.toggle("hidden",!w),c()};r.addEventListener("change",f),l({element:r,event:"change",handler:f}),ze().find(m=>m.element===s&&m.event==="click")||(s.addEventListener("click",ct),l({element:s,event:"click",handler:ct})),d(),ut("",a,n)}async function lo(e){if(!e)return;xt(e);const n=document.querySelector("#roomControlCenterModal"),l=document.querySelector(y.roomDefaultsForm);if(!n||!l)return;ze().forEach(({element:c,event:p,handler:u})=>{c.removeEventListener(p,u)}),Tt();const o=JSON.parse(e.dataset.roomDefaults||"{}"),a=n.querySelectorAll(".rcc-tabs .tab-link"),r=n.querySelectorAll(".rcc-tab-content"),t=n.querySelector("#general-settings"),s=n.querySelector("#batchEditorConfirmBtn"),i=n.querySelectorAll("#roomDefaultsApplyBtn, #roomDefaultsConfirmBtn"),d=c=>{const p=c.currentTarget,u=p.dataset.tab;if(!u)return;a.forEach(m=>m.classList.remove("active")),r.forEach(m=>m.classList.remove("active")),p.classList.add("active");const f=n.querySelector(`#${u}`);f&&f.classList.add("active");const v=u==="batch-editor";s.classList.toggle("hidden",!v),i.forEach(m=>m.classList.toggle("hidden",v))};a.forEach(c=>{c.addEventListener("click",d),He({element:c,event:"click",handler:d})}),ro(t,o,He),so(n,e,He),a.forEach(c=>c.classList.remove("active")),r.forEach(c=>c.classList.remove("active")),n.querySelector('.rcc-tabs .tab-link[data-tab="general-settings"]')?.classList.add("active"),t?.classList.add("active"),s.classList.add("hidden"),i.forEach(c=>c.classList.remove("hidden")),await V("#roomControlCenterModal")}function co(){const e=Ke();if(!e)return;const n=document.querySelector(y.roomDefaultsForm);if(!n)return;const l={};n.querySelectorAll(".defaults-content").forEach(a=>{const r=a.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(r){const t=r.name,s=r.checked;if(l[t]=s,s){const i=a.querySelector(".defaults-inputs-grid");i&&i.querySelectorAll('input[type="text"], input[type="number"]').forEach(d=>{const c=d.name,p=d.value.trim();let u;d.type==="text"&&d.inputMode==="numeric"?u=p===""?void 0:_(p):u=p,(typeof u=="number"&&!isNaN(u)||typeof u=="string"&&u!=="")&&(l[c]=u)})}}}),e.dataset.roomDefaults=JSON.stringify(l),ee();const o=document.querySelector("#roomControlCenterModal");o&&typeof o.closeModal=="function"?(o.closeModal(!0),setTimeout(()=>$("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"),50)):console.error("Could not find room defaults modal or its closer function.")}function io(e,n){if(!e||!n||Object.keys(n).length===0)return 0;let l=0;const o=e.getItemsContainer();return o?(o.querySelectorAll(".item-card").forEach(a=>{const r=a.dataset.type;let t=!1;const s=(i,d)=>{const c=n[d],p=a.querySelector(i);if(!p||c==null)return;const u=p.tagName==="SELECT",f=u?p.value:p.value.trim(),v=u?null:_(f);if(u?!f:!f||p.matches('input[type="text"][inputmode="numeric"]')&&v===0){let h=!1;u?Array.from(p.options).some(w=>w.value==c)&&(p.value=c,h=!0):p.matches('input[type="text"][inputmode="numeric"]')?typeof c=="number"&&!isNaN(c)&&(p.value=c===0?"0":E(c),h=!0):p.matches('input[type="text"]:not([inputmode])')&&(p.value=c,h=!0),h&&(t=!0,p.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),p.matches('input[type="text"][inputmode="numeric"]')&&p.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0})))}};switch(r){case"set":s(y.setFabricCodeInput,"defaults_fabric_code"),s(y.setPricePerMSelect,"defaults_fabric_price"),s(y.setSheerCodeInput,"defaults_sheer_code"),s(y.setSheerPricePerMSelect,"defaults_sheer_price");break;case"wallpaper":s(y.wallCodeInput,"defaults_wallpaper_code"),s(y.wallPriceRollInput,"defaults_wallpaper_price_roll"),s(y.wallInstallCostInput,"defaults_wallpaper_install_cost");break;case"wooden_blind":s(y.areaCodeInput,"defaults_wooden_blind_code"),s(y.areaPriceSqydInput,"defaults_wooden_blind_price_sqyd");break;case"roller_blind":s(y.areaCodeInput,"defaults_roller_blind_code"),s(y.areaPriceSqydInput,"defaults_roller_blind_price_sqyd");break;case"vertical_blind":s(y.areaCodeInput,"defaults_vertical_blind_code"),s(y.areaPriceSqydInput,"defaults_vertical_blind_price_sqyd");break;case"partition":s(y.areaCodeInput,"defaults_partition_code"),s(y.areaPriceSqydInput,"defaults_partition_price_sqyd");break;case"pleated_screen":s(y.areaCodeInput,"defaults_pleated_screen_code"),s(y.areaPriceSqydInput,"defaults_pleated_screen_price_sqyd");break;case"aluminum_blind":s(y.areaCodeInput,"defaults_aluminum_blind_code"),s(y.areaPriceSqydInput,"defaults_aluminum_blind_price_sqyd");break}t&&l++}),l):0}async function uo(){const e=Ke();if(!e)return;const n=document.querySelector("#roomControlCenterModal"),l=document.querySelector(y.roomDefaultsForm);if(!n||!l)return;const o={};if(l.querySelectorAll(".defaults-content").forEach(r=>{const t=r.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(t&&t.checked){const s=r.querySelector(".defaults-inputs-grid");s&&s.querySelectorAll('input[type="text"], input[type="number"]').forEach(i=>{const d=i.name,c=i.type==="text"&&i.inputMode==="numeric"?_(i.value):i.value.trim();(typeof c=="number"&&!isNaN(c)||typeof c=="string"&&c!=="")&&(o[d]=c)})}}),Object.keys(o).length===0){$("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ","warning");return}if(!await re("‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô","‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà *‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ* ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?"))return;se(G()),z();const a=io(e,o);n&&typeof n.closeModal=="function"?n.closeModal({cancelled:!0}):console.error("Could not find room defaults modal or its closer function."),setTimeout(()=>{a>0?(U(),$(`‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ö ${a} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß`,"success")):$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï","default")},50)}async function po(){const e=document.querySelector("#forceApplyModal");if(!e)return;const n=e.querySelector('[name="force_apply_type_hidden"]'),l=e.querySelector("#forceApplySelectedTypeDisplay"),o=e.querySelector('[name="force_apply_code"]'),a=e.querySelector('[name="force_apply_price"]'),r=o?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs");n&&(n.value=""),l&&(l.textContent="-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --"),o&&(o.value="",o.dataset.favoriteType=""),a&&(a.value=""),r&&(r.disabled=!0),await V("#forceApplyModal")}function fo(e,n,l){let o=0;return document.querySelectorAll(".item-card").forEach(r=>{if(r.classList.contains("placeholder-item"))return;const t=r.dataset.type;let s=null,i=null;if(e==="fabric"&&t==="set"?(s=r.querySelector('input[name="fabric_code"]'),i=r.querySelector('select[name="set_price_per_m"]')):e==="sheer"&&t==="set"?(s=r.querySelector('input[name="sheer_fabric_code"]'),i=r.querySelector('select[name="sheer_price_per_m"]')):e==="wallpaper"&&t==="wallpaper"?(s=r.querySelector('input[name="wallpaper_code"]'),i=r.querySelector('input[name="wallpaper_price_roll"]')):t===e&&r.matches(".area-based-item")&&(s=r.querySelector('input[name="area_code"]'),i=r.querySelector('input[name="area_price_sqyd"]')),s&&i){if(s.value=n,s.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),i.tagName==="SELECT")if(Array.from(i.options).some(d=>d.value==l))i.value=l;else{if(console.warn(`Price ${l} not found in options for`,i,". Forcing new option."),!i.querySelector(`option[value="${l}"][data-forced="true"]`)){const c=document.createElement("option");c.value=l,c.textContent=l===0?"0 ‡∏ö‡∏≤‡∏ó":`${E(l)} ‡∏ö‡∏≤‡∏ó (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)`,c.dataset.forced="true",i.appendChild(c)}i.value=l}else i.value=l===0?"0":l!=null&&l>0?E(l):"";i.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),i.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0})),o++,s.classList.add("input-highlight"),i.classList.add("input-highlight"),setTimeout(()=>{s.classList.remove("input-highlight"),i.classList.remove("input-highlight")},1200)}}),o}async function mo(){const e=document.querySelector("#forceApplyModal");if(!e)return;const n=e.querySelector('[name="force_apply_type_hidden"]'),l=e.querySelector('[name="force_apply_code"]'),o=e.querySelector('[name="force_apply_price"]'),a=n.value,r=l.value.trim(),t=_(o.value);if(!a){$("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),e.querySelector("#forceApplySelectTypeBtn")?.focus();return}if(!r){$("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),l.focus();return}if(t<0||t<=0&&!["fabric","sheer","wallpaper"].includes(a)){$("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (> 0)","warning"),o.focus();return}const s=e.querySelector("#forceApplySelectedTypeDisplay");let i=s?s.textContent:a;const d="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ",c=`‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏õ‡πá‡∏ô "${r}" ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ${E(t)} ‡∏ö‡∏≤‡∏ó ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${i}" ***‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£*** ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ`;if(!await re(d,c))return;se(G()),z();const p=fo(a,r,t);p>0?(U(),$(`‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏±‡∏ö ${p} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${i}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,"success"),e&&typeof e.closeModal=="function"&&e.closeModal({cancelled:!0})):$(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${i}" ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï`,"default")}async function gt(e,n=null){const l=document.querySelector("#itemTypeModal");if(!l)return null;l.querySelector("#itemTypeModalTitle").textContent=e;const o=l.querySelector('label[data-item-type="all"]');o&&(o.style.display="none");let a=n||"set";n&&!j[n]&&(a="set");const r=l.querySelector(`input[name="item_type_option"][value="${a}"]`);if(r)r.checked=!0;else{const i=l.querySelector('input[name="item_type_option"][value="set"]');i&&(i.checked=!0)}const t=await V("#itemTypeModal");if(!t||t.cancelled)return null;const s=l.querySelector('input[name="item_type_option"]:checked');return s?s.value:null}function it(){const e=document.createElement("div");return e.className="dimension-input-row",e.innerHTML='<div class="form-group"><label class="visually-hidden">‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°.)</label><input type="number" step="0.01" inputmode="decimal" name="modal_width_m" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á"></div><div class="form-group"><label class="visually-hidden">‡∏™‡∏π‡∏á (‡∏°.)</label><input type="number" step="0.01" inputmode="decimal" name="modal_height_m" placeholder="‡∏™‡∏π‡∏á"></div><button type="button" class="btn-icon btn-icon-small danger btn-remove-dimension-row" data-act="remove-dimension-row" title="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î" aria-label="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ"><i class="ph-bold ph-x"></i></button>',e.querySelectorAll('input[type="number"]').forEach(n=>{n.addEventListener("blur",l=>{const o=_(l.target.value);o>0?l.target.value.includes(".")?l.target.value=K(o):l.target.value=K(o/100):l.target.value=""})}),e}async function dt(e,n=!1){const l=document.querySelector("#itemTypeModal");if(!l)return null;const o=l.querySelector("#itemTypeModalTitle"),a=l.querySelector(".radio-card-group");if(!o||!a)return null;o.textContent=n?"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á":"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á";let r=a.querySelector('label[data-item-type="all"]');n?(r||(r=document.createElement("label"),r.dataset.itemType="all",r.innerHTML='<input type="radio" name="item_type_option" value="all"><span class="radio-card-content"><strong><i class="ph-fill ph-asterisk"></i> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong><small>All Item Types</small></span>',a.prepend(r)),r.style.display=""):r&&(r.style.display="none");let t=n&&(e===null||e==="all"||e==="")?"all":e&&j[e]?e:"set";const s=a.querySelector(`input[name="item_type_option"][value="${t}"]`);if(s)s.checked=!0;else{const f=a.querySelector(`input[name="item_type_option"][value="${n?"all":"set"}"]`);f&&(f.checked=!0)}const i=await V("#itemTypeModal");if(!i||i.cancelled)return null;const d=l.querySelector('input[name="item_type_option"]:checked');if(!d)return null;const c=d.value,p=d.closest("label")?.querySelector("strong"),u=p?p.textContent.trim():c;return{type:c,displayName:u}}function ut(e,n,l){if((!e||e==="all"||e==="")&&(e=""),!n||!l){n&&(n.innerHTML='<p class="placeholder-text">[‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î]</p>');return}const o=document.querySelector(".batch-select-all-container"),a=document.getElementById("batch-select-all-checkbox"),r=document.getElementById("batch-item-count"),t=e?`.item-card[data-type="${e}"]:not(.placeholder-item)`:".item-card:not(.placeholder-item)",s=l.querySelectorAll(t);if(s.length===0){n.innerHTML='<p class="placeholder-text">[‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á]</p>',o&&o.classList.add("hidden");return}else o&&o.classList.remove("hidden"),r&&(r.textContent=`(${s.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`),a&&(a.checked=!1,a.indeterminate=!1);let i="";s.forEach((d,c)=>{const p=d.querySelector("[data-item-title]"),u=d.querySelector('input[name*="_code"]'),f=d.dataset.type,v=j[f]?.name||f,m=d.querySelector('input[name*="_width_m"]'),h=d.querySelector('input[name*="_height_m"]');let w=`${p?p.textContent:c+1}`,k=`-: ${v}`;u&&u.value?k+=` (${M(u.value)})`:m&&h&&m.value&&h.value&&(k+=` (${m.value}x${h.value} ‡∏°.)`);const x=d.id||`batch-item-${f}-${c}`;d.dataset.batchId=x,i+=`<div class="batch-device-list-item" data-item-type="${f}"><label><input type="checkbox" name="batch_device_select" value="${x}" class="visually-hidden"><div class="item-info"><span class="item-name">${M(w)}</span><span class="item-details">${M(k)}</span></div><div class="visual-checkbox"><i class="ph-fill ph-check-circle"></i><i class="ph ph-circle"></i></div></label></div>`}),n.innerHTML=i}function me(e={}){const n=document.querySelector(y.roomsContainer);if(!n)return null;Object.keys(e).length===0&&(se(G()),z());const l=vt(e);return l?(n.appendChild(l),Object.keys(e).length===0&&(l.classList.add("item-created"),de(l),l.querySelector('input[name="room_name"]')?.focus()),Ne(),ce(),$e(),Object.keys(e).length===0&&ee(),l):null}function ho(e,n){if(!n||!e||e.width_m<=0||e.height_m<=0)return;const l=n.getItemsContainer();if(!l)return;const o=document.querySelector("#placeholderItemTpl");if(!o)return console.error("Placeholder template not found"),null;const r=o.content.cloneNode(!0).firstElementChild;r.dataset.widthM=e.width_m,r.dataset.heightM=e.height_m;const t=r.querySelector("[data-placeholder-width]"),s=r.querySelector("[data-placeholder-height]");return t&&(t.textContent=K(e.width_m)),s&&(s.textContent=K(e.height_m)),l.appendChild(r),r.classList.add("item-created"),r}function yo(e,n,l){if(!e||!n||!l)return;const o=e.closest(y.room);if(!o)return;se(G()),z();const a=JSON.parse(o.dataset.roomDefaults||"{}");let r={width_m:l.width_m,height_m:l.height_m};const t=i=>a[`enable_defaults_${i}`]===!0;switch(n){case"set":t("set")&&(r.fabric_code=a.defaults_fabric_code,r.price_per_m_raw=a.defaults_fabric_price,r.sheer_fabric_code=a.defaults_sheer_code,r.sheer_price_per_m=a.defaults_sheer_price);break;case"wallpaper":t("wallpaper")&&(r.wallpaper_code=a.defaults_wallpaper_code,r.price_per_roll=a.defaults_wallpaper_price_roll,r.install_cost_per_roll=a.defaults_wallpaper_install_cost),delete r.width_m;break;case"wooden_blind":t("wooden_blind")&&(r.code=a.defaults_wooden_blind_code,r.price_sqyd=a.defaults_wooden_blind_price_sqyd);break;case"roller_blind":t("roller_blind")&&(r.code=a.defaults_roller_blind_code,r.price_sqyd=a.defaults_roller_blind_price_sqyd);break;case"vertical_blind":t("vertical_blind")&&(r.code=a.defaults_vertical_blind_code,r.price_sqyd=a.defaults_vertical_blind_price_sqyd);break;case"partition":t("partition")&&(r.code=a.defaults_partition_code,r.price_sqyd=a.defaults_partition_price_sqyd);break;case"pleated_screen":t("pleated_screen")&&(r.code=a.defaults_pleated_screen_code,r.price_sqyd=a.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":t("aluminum_blind")&&(r.code=a.defaults_aluminum_blind_code,r.price_sqyd=a.defaults_aluminum_blind_price_sqyd);break}let s;if(n==="set")s=_e(r);else if(n==="wallpaper")s=ve(r);else if(j[n]?.templateId==="#areaBasedTpl")s=ge(n,r);else{$(`‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${n}`,"error");return}s&&(e.replaceWith(s),s.classList.add("item-created"),de(s),s.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),U(),$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${j[n]?.name||"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"} ‡πÅ‡∏•‡πâ‡∏ß`,"success"))}async function _o(e){if(!e||e.classList.contains("placeholder-item"))return;const n=e.dataset.type,l=await gt("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",n);if(!l||l===n||!await re("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;se(G()),z();const o={width_m:_(e.querySelector('input[name$="_width_m"], input[name="width_m"]')?.value),height_m:_(e.querySelector('input[name$="_height_m"], input[name="height_m"]')?.value)};n==="wallpaper"&&(o.height_m=_(e.querySelector(y.wallHeightInput)?.value));const a=e.closest(y.room),r=JSON.parse(a?.dataset.roomDefaults||"{}");let t={width_m:o.width_m>0?o.width_m:void 0,height_m:o.height_m>0?o.height_m:void 0};const s=d=>r[`enable_defaults_${d}`]===!0;switch(l){case"set":s("set")&&(t.fabric_code=r.defaults_fabric_code,t.price_per_m_raw=r.defaults_fabric_price,t.sheer_fabric_code=r.defaults_sheer_code,t.sheer_price_per_m=r.defaults_sheer_price);break;case"wallpaper":s("wallpaper")&&(t.wallpaper_code=r.defaults_wallpaper_code,t.price_per_roll=r.defaults_wallpaper_price_roll,t.install_cost_per_roll=r.defaults_wallpaper_install_cost),delete t.width_m,t.height_m=o.height_m>0?o.height_m:void 0;break;case"wooden_blind":s("wooden_blind")&&(t.code=r.defaults_wooden_blind_code,t.price_sqyd=r.defaults_wooden_blind_price_sqyd);break;case"roller_blind":s("roller_blind")&&(t.code=r.defaults_roller_blind_code,t.price_sqyd=r.defaults_roller_blind_price_sqyd);break;case"vertical_blind":s("vertical_blind")&&(t.code=r.defaults_vertical_blind_code,t.price_sqyd=r.defaults_vertical_blind_price_sqyd);break;case"partition":s("partition")&&(t.code=r.defaults_partition_code,t.price_sqyd=r.defaults_partition_price_sqyd);break;case"pleated_screen":s("pleated_screen")&&(t.code=r.defaults_pleated_screen_code,t.price_sqyd=r.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":s("aluminum_blind")&&(t.code=r.defaults_aluminum_blind_code,t.price_sqyd=r.defaults_aluminum_blind_price_sqyd);break}let i;if(l==="set")i=_e(t);else if(l==="wallpaper")i=ve(t);else if(j[l]?.templateId==="#areaBasedTpl")i=ge(l,t);else return;i&&(e.replaceWith(i),i.classList.add("item-created"),de(i),i.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),U(),$("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}function vo(e){if(!e)return;const n=e.closest(y.room);if(!n||!n.getItemsContainer())return;se(G()),z();let o;if(e.classList.contains("placeholder-item")){const a=document.querySelector("#placeholderItemTpl");if(a){o=a.content.cloneNode(!0).firstElementChild,o.dataset.widthM=e.dataset.widthM,o.dataset.heightM=e.dataset.heightM;const t=o.querySelector("[data-placeholder-width]"),s=o.querySelector("[data-placeholder-height]");t&&(t.textContent=K(e.dataset.widthM)),s&&(s.textContent=K(e.dataset.heightM)),e.classList.contains("is-suspended")&&o.classList.add("is-suspended")}else{$("‡πÑ‡∏°‡πà‡∏û‡∏ö Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder","error");return}}else{const a=Lt(e);if(!a){$("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ","error");return}if(a.type==="set")o=_e(a);else if(a.type==="wallpaper")o=ve(a);else if(j[a.type]?.templateId==="#areaBasedTpl")o=ge(a.type,a);else{$("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","error");return}}if(o){if(e.after(o),o.classList.add("item-created"),!o.classList.contains("placeholder-item")){const a=e.querySelector(y.itemDetailsMore);a&&a.classList.contains("show")&&Ee(o,!0)}de(o),oe(),U(),$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success")}}function go(e){const{roomId:n,itemIndex:l}=e.dataset;if(!n||l===void 0)return;const o=document.getElementById("lookbookModal");o&&typeof o.closeModal=="function"&&o.closeModal({cancelled:!0});const a=document.getElementById(n);if(!a){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}const t=Array.from(a.querySelectorAll(".item-card:not(.item-hidden)"))[parseInt(l,10)];if(!t){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}a.open=!0,ce(),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("scrolling-jump"),setTimeout(()=>t.classList.remove("scrolling-jump"),2500)},150)}async function bo(){const e=document.querySelector("#manageFavsTypeModal"),n=document.querySelector("#manageFavsTypeBody");if(!e||!n)return;const l=Object.keys(ue());let o="",a=null;const r={fabric:"ph-rows",sheer:"ph-waves",wallpaper:"ph-paint-roller",wooden_blind:"ph-table",roller_blind:"ph-scroll",vertical_blind:"ph-sidebar-simple",partition:"ph-columns",pleated_screen:"ph-squares-four",aluminum_blind:"ph-stack-simple"};if(l.includes("fabric")&&(o+=`
             <label data-item-type="fabric">
                 <input type="radio" name="manage_fav_type_option" value="fabric">
                 <span class="radio-card-content">
                     <strong><i class="ph ${r.fabric}"></i> ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö</strong>
                     <small>Fabric Codes</small>
                 </span>
             </label>`,a||(a="fabric")),l.includes("sheer")&&(o+=`
              <label data-item-type="sheer">
                  <input type="radio" name="manage_fav_type_option" value="sheer">
                  <span class="radio-card-content">
                      <strong><i class="ph ${r.sheer}"></i> ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</strong>
                      <small>Sheer Codes</small>
                  </span>
              </label>`,a||(a="sheer")),l.forEach(s=>{if(s==="fabric"||s==="sheer")return;const i=j[s];if(i){const d=i.name,c=r[s]||"ph-star";o+=`
                <label data-item-type="${s}">
                    <input type="radio" name="manage_fav_type_option" value="${s}">
                    <span class="radio-card-content">
                        <strong><i class="ph ${c}"></i> ${M(d)}</strong>
                        <small>${s.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())} Codes</small>
                    </span>
                </label>`,a||(a=s)}}),n.innerHTML=o,a){const s=n.querySelector(`input[value="${a}"]`);s&&(s.checked=!0)}const t=await V("#manageFavsTypeModal");if(t&&!t.cancelled){const s=n.querySelector('input[name="manage_fav_type_option"]:checked')?.value;s&&await bt(s)}}function So(e){const n=ko();if(!n)return;const l=n.closest("#roomDefaultsModal"),o=n.closest(".item-card"),a=n.closest("#forceApplyModal");let r=n,t=null;const s=r.dataset.favoriteType,i=e.dataset.code,d=_(e.dataset.price);if(o){let u;s==="fabric"?u="set_price_per_m":s==="sheer"?u="sheer_price_per_m":s==="wallpaper"?u="wallpaper_price_roll":u="area_price_sqyd",t=o.querySelector(`[name="${u}"]`)}else if(l){const u=r.closest(".defaults-inputs-grid");if(u){let f;s==="fabric"?f="defaults_fabric_price":s==="sheer"?f="defaults_sheer_price":s==="wallpaper"?f="defaults_wallpaper_price_roll":s==="wooden_blind"?f="defaults_wooden_blind_price_sqyd":s==="roller_blind"?f="defaults_roller_blind_price_sqyd":s==="vertical_blind"?f="defaults_vertical_blind_price_sqyd":s==="partition"?f="defaults_partition_price_sqyd":s==="pleated_screen"?f="defaults_pleated_screen_price_sqyd":s==="aluminum_blind"&&(f="defaults_aluminum_blind_price_sqyd"),f&&(t=u.querySelector(`[name="${f}"]`))}}else a&&(t=a.querySelector('[name="force_apply_price"]'));const c=t;r.value=i,r.classList.add("input-highlight"),setTimeout(()=>{r&&r.classList.remove("input-highlight")},1200),c&&d>=0&&(c.tagName==="SELECT"?Array.from(c.options).some(u=>_(u.value)===d)?c.value=d:$(`‡∏£‡∏≤‡∏Ñ‡∏≤ ${E(d)} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`,"warning"):c.value=d===0?"0":d>0?E(d):"",c.classList.add("input-highlight"),setTimeout(()=>{c&&c.classList.remove("input-highlight")},1200)),o?((c||r).dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),c&&c.matches('input[inputmode="numeric"]')&&c.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}))):(l||a)&&c&&c.matches('input[inputmode="numeric"]')&&c.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}));const p=document.querySelector("#favoritesModal");p&&typeof p.closeModal=="function"&&p.closeModal({cancelled:!1,applied:!0})}async function wo(e){if(!e||!e.dataset.favoriteType){console.warn("showFavoritesModal called without a valid input element or favorite type.");return}Je(e);const n=e.dataset.favoriteType;if(!n){$("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô","warning");const v=e.closest("#forceApplyModal");v&&v.querySelector("#forceApplySelectTypeBtn")?.focus(),Je(null);return}const l=document.querySelector("#favoritesModal"),o=l.querySelector("#favoritesModalTitle"),a=l.querySelector("#favoritesModalBody"),r=l.querySelector("#favSearchInput"),t=l.querySelector('[data-act="manage-favorites"]'),s=document.querySelector("#favSelectorItemTpl");if(!l||!o||!a||!r||!t||!s){console.error("Missing elements for favorites modal");return}let i=j[n]?.name||n;n==="fabric"?i="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":n==="sheer"&&(i="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),o.textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '${M(i)}'`;const d=()=>{const m=ue()[n]||[];m.length>0?a.innerHTML=m.map(h=>{let w="-";return h.price>=0&&(w=E(h.price)),s.innerHTML.replace(/{CODE}/g,M(h.code)).replace(/{PRICE}/g,w).replace(/{RAW_PRICE}/g,h.price)}).join(""):a.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>',r.value=""};d();const c=()=>{const v=r.value.toLowerCase();a.querySelectorAll(".fav-selector-item").forEach(m=>{const h=m.dataset.code.toLowerCase();m.classList.toggle("is-hidden",!h.includes(v))})},p=v=>{const m=v.target.closest(".fav-selector-item");m&&So(m)},u=async()=>{await bt(n),$o()&&d()},f=()=>{r.removeEventListener("input",c),a.removeEventListener("click",p),t&&(t.onclick=null)};r.addEventListener("input",c),a.addEventListener("click",p),t.onclick=u,await V("#favoritesModal",f)}function Le(e){const n=document.querySelector("#favManagerBody"),l=document.querySelector("#favManagerItemTpl"),a=ue()[e]||[];if(!n||!l)return;a.length===0?n.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':n.innerHTML=a.map(s=>{let i="-";return s.price>=0&&(i=E(s.price)),l.innerHTML.replace(/{CODE}/g,M(s.code)).replace(/{PRICE}/g,i).replace(/{RAW_PRICE}/g,s.price)}).join(""),Ae(null);const r=document.querySelector('#favManagerModal [data-act="edit-selected-fav"]'),t=document.querySelector('#favManagerModal [data-act="del-selected-fav"]');r&&(r.disabled=!0),t&&(t.disabled=!0)}async function bt(e){const n=document.querySelector("#favManagerModal");if(!n||!e)return;let l=j[e]?.name||e;e==="fabric"?l="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":e==="sheer"&&(l="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),n.dataset.currentType=e,Be(!1),Ae(null),document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${M(l)}'`,Le(e),await V("#favManagerModal")}const J=[];let te=!1,Me=null,he=null;const pt=document.querySelector("#undoBtn"),Ue="marnthara.theme";let St=null;const be=()=>St,qo=e=>{St=e};let wt=!1;const $o=()=>wt,Be=e=>{wt=e};let qt=null;const Z=()=>qt,Ae=e=>{qt=e};let $t=null;const ko=()=>$t,Je=e=>{$t=e};let kt=null;const Ke=()=>kt,xt=e=>{kt=e};let Xe=[];const ze=()=>Xe,Tt=()=>{Xe=[]},He=e=>{Xe.push(e)},Ie={};function xo(e){if(Ie[e])return Ie[e];const n=new Promise((l,o)=>{const a=document.createElement("script");a.src=e,a.onload=()=>l(),a.onerror=()=>{console.error(`Script load error for ${e}`),delete Ie[e],o(new Error(`Script load error for ${e}`))},document.head.appendChild(a)});return Ie[e]=n,n}function Mt(){const e=localStorage.getItem(Ue),n=document.querySelector("#themeToggleBtn");if(!n)return;const l=n.querySelector("i"),o=n.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),l&&(l.className="ph-fill ph-sun"),o&&(o.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),l&&(l.className="ph-fill ph-moon"),o&&(o.textContent=" ‡∏°‡∏∑‡∏î");break;default:l&&(l.className="ph-fill ph-palette"),o&&(o.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function To(){const e=localStorage.getItem(Ue);let n="neutral";!e||e==="light"?n="neutral":e==="neutral"?n="dark":n="light",localStorage.setItem(Ue,n),Mt()}function z(){pt&&(pt.disabled=!jt())}function Mo(){const e=Ot();e&&(Ze(e,!1),$("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),z()}function ye(){const e=document.getElementById("suspendedItemsBtn");if(!e)return;if(he){e.classList.remove("is-visible");return}const n=document.getElementById("suspendedCountBadge"),l=document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length,o=document.querySelectorAll(".room-card.is-suspended");let a=0;o.forEach(t=>{a+=t.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").length});const r=l+a;n&&(n.textContent=r),e.classList.toggle("is-visible",r>0)}function Oe(){he="suspended";const e=document.getElementById("filterStatusBar");let n=0;if(document.querySelectorAll(".room-card").forEach(o=>{let a=!1;const r=o.classList.contains("is-suspended");o.querySelectorAll(".item-card").forEach(s=>{const d=s.classList.contains("is-suspended")||r;s.classList.toggle("item-hidden",!d),d&&(a=!0,s.classList.contains("placeholder-item")||n++)});const t=r||a;o.classList.toggle("item-hidden",!t)}),document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length+Array.from(document.querySelectorAll(".room-card.is-suspended .item-card:not(.is-suspended):not(.placeholder-item)")).length===0){It(),$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success");return}e&&(e.innerHTML=`
            <span><i class="ph ph-warning"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö (${n} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,e.classList.add("is-visible"),e.dataset.filterType="suspended"),oe(),ce(),ye()}function Io(e,n){if(!e)return;he=e;const l=document.getElementById("filterStatusBar");let o=0;document.querySelectorAll(y.room).forEach(a=>{let r=0;a.querySelectorAll(".item-card").forEach(t=>{const s=t.dataset.type===e&&!t.classList.contains("placeholder-item");t.classList.toggle("item-hidden",!s),s&&r++}),a.querySelectorAll(".placeholder-item").forEach(t=>t.classList.toggle("item-hidden",r===0)),a.classList.toggle("item-hidden",r===0),r>0&&(o+=r)}),l&&(l.innerHTML=`
            <span>‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${M(n)}</strong> (${o} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,l.classList.add("is-visible"),l.dataset.filterType=e),oe(),ce(),ye()}function It(){he=null;const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(n=>n.classList.remove("item-hidden")),oe(),ce(),ye()}function $(e,n="default"){const l=document.querySelector(y.toastContainer);if(!l)return;const o={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},a=document.createElement("div");a.className=`toast toast-${n}`,a.innerHTML=`<i class="${o[n]||o.default}"></i> ${M(e)}`,l.appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),a.addEventListener("transitionend",()=>a.remove())},3e3)}function V(e,n){return new Promise(l=>{const o=document.querySelector(e);if(!o){console.error("Modal not found:",e),l(null);return}if(J.length>0){const f=J[J.length-1];f&&f.classList.contains("visible")&&f.classList.add("is-underlay")}J.push(o),o.classList.add("visible");const a=o.querySelector('[id$="Confirm"]'),r=o.querySelector('[id$="Cancel"], [data-act="close-modal"], #roomDefaultsCancelBtn, #manageFavsTypeCancel, #forceApplyCancel, #forceApplyTypeCancel, #dimensionEntryCancel'),t=o.querySelector("#itemTypeModalMultiAdd"),s=Array.from(o.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(f=>!f.disabled&&f.offsetParent!==null),i=s[0],d=s[s.length-1];setTimeout(()=>i?.focus(),50);const c=f=>{o.classList.remove("visible"),document.removeEventListener("keydown",p),o.removeEventListener("click",u),t&&(t.onclick=null),a&&(a.onclick=null),r&&(r.onclick=null),o.closeModal===c&&(o.closeModal=null);const v=J.pop();v!==o&&(console.error(`[cleanup] Modal stack mismatch! Expected #${o.id}, but popped #${v?.id}. Resetting stack.`),J.length=0);const m=J.length>0?J[J.length-1]:null;m&&m.classList.contains("visible")&&m.classList.remove("is-underlay"),e==="#roomControlCenterModal"&&(ze().forEach(({element:h,event:w,handler:k})=>{h.removeEventListener(w,k)}),Tt(),xt(null)),e==="#favoritesModal"&&Je(null),f?.cancelled&&typeof n=="function"&&n(),l(f)};o.closeModal=c;const p=f=>{const v=J.length>0&&J[J.length-1]===o;f.key==="Escape"&&v&&c({cancelled:!0}),f.key==="Tab"&&s.length>1&&(f.shiftKey?document.activeElement===i&&(d.focus(),f.preventDefault()):document.activeElement===d&&(i.focus(),f.preventDefault()))},u=f=>{const v=J.length>0&&J[J.length-1]===o;f.target===o&&v&&(f.stopPropagation(),c({cancelled:!0}))};a&&(a.onclick=()=>c(!0)),r&&(r.onclick=()=>{J.length>0&&J[J.length-1]===o&&c({cancelled:!0})}),document.addEventListener("keydown",p),t&&(t.onclick=()=>c({multiAdd:!0})),o.addEventListener("click",u)})}async function re(e,n){const l=document.querySelector(y.modal);return l?(l.querySelector(y.modalTitle).textContent=e,l.querySelector(y.modalBody).textContent=n,await V(y.modal)===!0):!0}function ft(e){e.target.value!=="0"&&_(e.target.value)>0&&(e.target.value=_(e.target.value))}function mt(e){const n=_(e.target.value);e.target.value=n===0?"0":n!=null&&n>0?E(n):""}function je(e,n){e&&(se(G()),z(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),$(n),Ne(),oe(),U(),$e()},{once:!0}))}function Co(e){if(!e)return;const n=document.querySelector(".main-header");if(!n){e.scrollIntoView({behavior:"smooth",block:"center"});return}const l=n.offsetHeight,o=16,r=(e.querySelector(".item-header")||e).getBoundingClientRect(),t=l+o,s=r.top-t;Math.abs(s)>5&&window.scrollBy({top:s,behavior:"smooth"})}function de(e){if(!e)return;const n=document.querySelector(".main-header"),l=document.querySelector(".summary-footer"),o=n?n.offsetHeight+16:80,a=l?l.offsetHeight+16:100;requestAnimationFrame(()=>{const r=e.getBoundingClientRect(),t=window.innerHeight;if(!(r.top>=o&&r.bottom<=t-a)){const i=t-o-a,d=r.height>i?"start":"center";e.scrollIntoView({behavior:"smooth",block:d})}})}function oe(){document.querySelectorAll(y.room).forEach(e=>{const n=e.querySelectorAll(".item-card:not(.item-hidden)");let l=0;const o=Array.from(n).filter(a=>!a.classList.contains("is-suspended")&&!a.classList.contains("placeholder-item")).length;n.forEach(a=>{const r=a.querySelector("[data-item-title]");r&&(a.classList.contains("placeholder-item")?r.textContent="...":a.classList.contains("is-suspended")?r.textContent="-":(l++,r.textContent=`${l}/${o}`))}),e.querySelectorAll(".item-card.item-hidden").forEach(a=>{const r=a.querySelector("[data-item-title]");r&&(r.textContent="-")})})}function Ct(){const e=document.querySelector(y.orderForm),n=document.querySelector(y.lockBtn);!e||!n||(e.classList.toggle("is-locked",te),n.classList.toggle("is-locked",te),n.querySelector("i").className=te?"ph-bold ph-lock-key":"ph ph-paw-print",e.querySelectorAll('input:not([type="hidden"]), select, textarea, button:not(.unlockable):not([data-act="toggle-more-details"]):not([data-act="collapse-room"])').forEach(l=>{!l.closest(".main-header")&&!l.closest(".summary-footer")&&!l.closest(".modal-wrapper")&&(l.disabled=te)}),document.querySelectorAll(".unlockable").forEach(l=>l.disabled=!1))}function Lo(){te=!te,Ct(),$(te?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",te?"warning":"success")}function ce(){const e=document.querySelectorAll(y.room+":not(.item-hidden)");if(e.length===0){const o=document.querySelector(y.toggleAllRoomsBtn);o&&(o.querySelector("i").className="ph ph-caret-down",o.querySelector("span").textContent="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");return}const n=[...e].some(o=>o.open),l=document.querySelector(y.toggleAllRoomsBtn);l&&(l.querySelector("i").className=n?"ph ph-caret-up":"ph ph-caret-down",l.querySelector("span").textContent=n?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}function Bo(){const e=document.querySelectorAll(y.room+":not(.item-hidden)");if(e.length===0)return;const n=[...e].some(o=>o.open);e.forEach(o=>{o.open=!n});const l=document.querySelector(y.quickNavDropdown);l&&l.classList.contains("show")&&(l.classList.remove("show"),document.querySelector(y.quickNavBtn)?.setAttribute("aria-expanded","false")),setTimeout(()=>{ce(),ee()},50)}function Ne(){const e=document.querySelector(y.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(y.room).forEach(n=>{const l=n.querySelector(y.roomNameInput)?.value||"‡∏´‡πâ‡∏≠‡∏á",o=document.createElement("a");o.href=`#${n.id}`,o.dataset.jumpTo=n.id,o.innerHTML=`<i class="ph ph-share-fat"></i> ${M(l)||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)"}`,e.appendChild(o)}))}function We(e){const n=document.getElementById("quickNavBtnText");n&&(e?n.textContent=e.querySelector('input[name="room_name"]')?.value||"...":n.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function $e(){if(Me&&Me.disconnect(),!document.getElementById("quickNavBtnText"))return;const n={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},l=a=>{const r=a.filter(t=>t.isIntersecting).sort((t,s)=>t.target.getBoundingClientRect().top-s.target.getBoundingClientRect().top);r.length>0&&We(r[0].target)};Me=new IntersectionObserver(l,n),document.querySelectorAll(y.room).forEach(a=>Me.observe(a));const o=Array.from(document.querySelectorAll(y.room));if(o.length>0){o.sort((r,t)=>r.getBoundingClientRect().top-t.getBoundingClientRect().top);const a=o.find(r=>r.getBoundingClientRect().bottom>60);We(a||o[0])}else We(null)}function Ee(e,n=null){if(!e||e.classList.contains("placeholder-item"))return;const l=e.querySelector(".item-details-more"),o=e.querySelector('[data-act="toggle-more-details"]'),a=o?.parentElement;if(!l||!o||!a)return;const r=l.classList.contains("show"),t=n!==null?n:!r;if(r===t)return;l.classList.toggle("show",t),o.classList.toggle("expanded",t);const s=o.querySelector("i"),i=o.querySelector("span");if(s&&(s.className=t?"ph ph-caret-up":"ph ph-caret-down"),i)if(t)i.textContent="‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á";else{const d=o.dataset.priceSummary;d?i.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${d})</small>`:i.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}if(t)l.appendChild(a),setTimeout(()=>Co(e),100);else{const d=e.querySelector(".item-grid");d&&d.appendChild(a)}}function Lt(e){if(!e||!e.matches(y.itemCard)||e.classList.contains("placeholder-item"))return null;const n=e.dataset.type;if(!n)return null;let l={type:n,is_suspended:e.classList.contains("is-suspended")};try{if(n==="set")Object.assign(l,{width_m:_(e.querySelector(y.setWidthInput)?.value),height_m:_(e.querySelector(y.setHeightInput)?.value),style:e.querySelector(y.setStyleSelect)?.value||"",fabric_variant:e.querySelector(y.setFabricVariantSelect)?.value||"",price_per_m_raw:_(e.querySelector(y.setPricePerMSelect)?.value),sheer_price_per_m:_(e.querySelector(y.setSheerPricePerMSelect)?.value),louis_price_per_m:_(e.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:e.querySelector(y.setFabricCodeInput)?.value||"",sheer_fabric_code:e.querySelector(y.setSheerCodeInput)?.value||"",opening_style:e.querySelector(y.setOpeningStyleSelect)?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",adjustment_side:e.querySelector(y.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:e.querySelector('input[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:e.querySelector('input[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:e.querySelector('input[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:e.querySelector('input[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:e.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:e.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:e.querySelector(y.setNotesInput)?.value||""});else if(n==="wallpaper"){const o=e.querySelector(y.wallInstallCostInput),a=o?o.value:"";let r;a==="0"?r=0:typeof savedInstallCost=="number"&&savedInstallCost>0?r=savedInstallCost:_(savedInstallCost)>0&&(r=_(savedInstallCost)),Object.assign(l,{height_m:_(e.querySelector(y.wallHeightInput)?.value),wallpaper_code:e.querySelector(y.wallCodeInput)?.value||"",price_per_roll:_(e.querySelector(y.wallPriceRollInput)?.value),install_cost_per_roll:r,notes:e.querySelector(y.wallNotesInput)?.value||"",widths:Array.from(e.querySelectorAll(y.wallWidthInput)).map(t=>_(t.value))})}else e.matches(y.areaBasedItem)&&(Object.assign(l,{width_m:_(e.querySelector(y.areaWidthInput)?.value),height_m:_(e.querySelector(y.areaHeightInput)?.value),price_sqyd:_(e.querySelector(y.areaPriceSqydInput)?.value),code:e.querySelector(y.areaCodeInput)?.value||"",notes:e.querySelector(y.areaNotesInput)?.value||""}),(n==="partition"||n==="pleated_screen")&&(l.opening_style=e.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(n)&&(l.adjustment_side=e.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));return l}catch(o){return console.error("Failed to extract item data:",o,e),null}}const U=qe(()=>{let e=0;document.querySelectorAll(y.room).forEach(d=>{let c=0,p=0;const u=d.classList.contains("is-suspended");if(u||(d.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").forEach(f=>{const v=_(f.dataset.totalPrice);v>0&&(c+=v,p++)}),e+=c),typeof d.updateBrief=="function"){const f=d.querySelectorAll(".placeholder-item:not(.is-suspended)").length;if(u)d.updateBrief("(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)");else if(p>0){let v=`<span>${p}</span> &bull; ${E(c)} ‡∏ö‡∏≤‡∏ó`;f>0&&(v+=` (+${f} ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)`),d.updateBrief(v)}else f>0?d.updateBrief(`<span>${f}</span> ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó`):d.updateBrief("<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")}});const n=document.querySelector("#discount_type"),l=document.querySelector("#discount_value"),o=n?n.value:"amount",a=l?_(l.value):0;let r=0;a>0&&(r=o==="percent"?e*(a/100):a,r=Math.min(e,r));const t=e-r,s=document.querySelector("#grandTotal"),i=document.querySelector("#originalTotal");s&&(s.textContent=E(t)),i&&(r>0?(i.textContent=E(e),i.dataset.rawTotal=e,i.style.display="block"):(i.style.display="none",i.dataset.rawTotal="")),ye(),ee()},200);async function Ze(e,n=!1){if(!e){$("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error");return}if(e.favorites)if(n){const d=document.querySelector("#favoritesConflictModal");if(d){const c=d.querySelector('input[name="fav_conflict_option"][value="merge"]');c&&(c.checked=!0);const p=await V("#favoritesConflictModal");if(!p||p.cancelled){$("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤","warning");return}const u=d.querySelector('input[name="fav_conflict_option"]:checked').value;let f=0;switch(u){case"overwrite":ot(e.favorites)&&$("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");break;case"merge":f=Ve(e.favorites),$(`‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏° ${f} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)`,"success");break;case"skip":$("‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","default");break}}else Ve(e.favorites)}else ot(e.favorites);const l=document.querySelector(y.roomsContainer);if(!l)return;l.innerHTML="";const o=document.querySelector("#customer_name"),a=document.querySelector("#customer_phone"),r=document.querySelector("#customer_address"),t=document.querySelector("#customerDetailsCard");o&&(o.value=e.customer_name||""),a&&(a.value=e.customer_phone||""),r&&(r.value=e.customer_address||""),t&&(t.open=e.customer_card_open??!0);const s=document.querySelector("#discount_type"),i=document.querySelector("#discount_value");if(e.discount&&s&&i?(s.value=e.discount.type||"amount",i.value=e.discount.value||0):s&&i&&(s.value="amount",i.value=0),!Array.isArray(e.rooms)){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","warning"),l.children.length===0&&me();return}for(const d of e.rooms){const c=vt(d);if(!c)continue;l.appendChild(c);const p=c.getItemsContainer();if(p&&Array.isArray(d.items))for(const u of d.items){let f;if(u.type==="placeholder"){const v=document.querySelector("#placeholderItemTpl");if(v){f=v.content.cloneNode(!0).firstElementChild,f.dataset.widthM=u.width_m||0,f.dataset.heightM=u.height_m||0;const h=f.querySelector("[data-placeholder-width]"),w=f.querySelector("[data-placeholder-height]");h&&(h.textContent=K(u.width_m)),w&&(w.textContent=K(u.height_m)),u.is_suspended&&f.classList.add("is-suspended")}else{console.warn("Placeholder template not found during load.");continue}}else if(u.type==="set")f=_e(u);else if(u.type==="wallpaper")f=ve(u);else if(j[u.type]?.templateId==="#areaBasedTpl")f=ge(u.type,u);else continue;f&&p.appendChild(f)}}oe(),Ne(),ce(),$e(),z(),U(),n&&$("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}async function Eo(e,n){const l=document.querySelector(y.printableContent);if(!l||!e){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}const o=document.title;if(n==="direct"){$("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...","default");let a;try{typeof window.html2pdf>"u"&&($("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await xo("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js")),a=document.createElement("div"),a.style.position="fixed",a.style.left="-300mm",a.style.top="0",a.style.width="210mm",a.style.background="#fff",a.innerHTML=e,document.body.appendChild(a),await new Promise(t=>setTimeout(t,300));const r={margin:0,filename:`${o}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:a.querySelector(".pdf-page")?.scrollWidth||794,windowWidth:a.querySelector(".pdf-page")?.scrollWidth||794},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(a).set(r).save(),$("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(r){console.error("PDF Generation Error:",r),$("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{a&&document.body.contains(a)&&document.body.removeChild(a)}}else n==="print"&&(l.innerHTML=e,setTimeout(()=>{window.print(),setTimeout(()=>{l.innerHTML=""},1e3)},At))}function Ao(e){if(!e||!e.html){$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const n=`<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${e.fileName}</title><link rel="stylesheet" href="./src/styles/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><style>body { background-color: #eee; } #printable-content { display: block !important; max-width: 210mm; margin: 10mm auto; } .pdf-page { border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 10mm; background: #fff; page-break-inside: avoid; } .pdf-page-content { padding: 12mm; } @media print { body { background-color: #fff; } #printable-content { max-width: 100%; margin: 0; } .pdf-page { border: none; box-shadow: none; margin-bottom: 0; page-break-after: always; } .pdf-page:last-child { page-break-after: avoid; } } i.ph { vertical-align: middle; }</style></head><body><div id="printable-content">${e.html}</div></body></html>`,l=new Blob([n],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(l),a=document.createElement("a");a.href=o,a.download=`${e.fileName}.html`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),$("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(n){console.error("HTML Export Error:",n),$("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function Po(){const e=document.querySelector(y.orderForm),n=document.querySelector(y.fileImporter),l=document.querySelector("#favImporter"),o=document.querySelector(y.menuDropdown),a=document.querySelector(y.quickNavDropdown),r=document.querySelector(y.menuBtn),t=document.querySelector(y.quickNavBtn);if(e){if(e.addEventListener("item-update",U),e.addEventListener("input",s=>{if(te){s.preventDefault();return}if(s.target.closest("#customerInfo")&&ee(),s.target.matches(y.roomNameInput)){const d=s.target.closest(".room-card")?.querySelector("[data-room-name-display]");d&&(d.textContent=s.target.value||"‡∏´‡πâ‡∏≠‡∏á"),Ne(),$e(),qe(ee,300)()}s.target.matches('input[name$="_m"], input[name$="price_sqyd"], input[name$="price_roll"], input[name$="install_cost"]')&&U()}),e.addEventListener("change",s=>{if(te){s.preventDefault();return}s.target.matches("select")&&U()}),e.addEventListener("blur",s=>{const i=s.target;i.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?i.name==="wallpaper_install_cost"&&_(i.value)===0?i.value="0":i.value=_(i.value)>0?E(_(i.value)):"":i.matches('input[name$="_m"], input[name^="wall_width_m"], input[name^="modal_"]')&&(i.value=K(i.value)),!i.closest(".modal-wrapper")&&i.matches('input:not([type="hidden"]), select, textarea')&&ee()},!0),e.addEventListener("focusin",s=>{const i=s.target;if(i.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&(i.name==="wallpaper_install_cost"&&i.value==="0"||_(i.value)>0&&(i.value=_(i.value))),i.matches('input:not([type="hidden"]), select, textarea')){const d=document.querySelector(".main-header"),c=document.querySelector(".summary-footer"),p=d?d.offsetHeight+16:80,u=c?c.offsetHeight+16:100,f=window.innerHeight,v=i.getBoundingClientRect();if((v.top<p||v.bottom>f-u)&&!i.closest(".modal-wrapper")){const h=i.closest(".item-card, .room-card");h&&de(h)}}},!0),e.addEventListener("keydown",s=>{if(te){s.preventDefault();return}const i=s.target;if(s.key==="Enter"&&i.matches("input, select")&&!i.closest(".modal-wrapper")){s.preventDefault();const d=i.closest(".item-card, .card");if(d){const c=Array.from(d.querySelectorAll('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])')).filter(u=>u.offsetParent!==null&&!u.closest(".hidden")&&(!u.closest(".item-details-more")||u.closest(".item-details-more.show"))),p=c.indexOf(i);if(p>-1&&p<c.length-1){const u=c[p+1];u.focus(),typeof u.select=="function"&&u.select()}else p===c.length-1&&i.blur()}}else if(s.key==="Enter"&&i.closest("#dimensionEntryModal")){s.preventDefault();const d=i.closest("#dimensionEntryModal"),c=Array.from(d.querySelectorAll('input[name="modal_width_m"], input[name="modal_height_m"]')),p=c.indexOf(i);if(p>-1&&p<c.length-1){const u=c[p+1];u.focus(),u.select()}else p===c.length-1&&(d.querySelector('[data-act="add-dimension-row"]')?.click(),setTimeout(()=>{const f=d.querySelectorAll(".dimension-input-row");f[f.length-1].querySelector('input[name="modal_width_m"]')?.focus()},50))}}),document.addEventListener("click",async s=>{s.target.closest(".menu-container")||(o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),a?.classList.remove("show"),t?.setAttribute("aria-expanded","false")),s.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(p=>p.classList.remove("show"));const i=s.target.closest(".summary-tag[data-filter-type]");if(i&&i.closest("#overviewModal")){const p=i.dataset.filterType,u=i.textContent.trim().replace(/\s*\d+\s*$/,""),f=document.querySelector("#overviewModal");f&&typeof f.closeModal=="function"&&f.closeModal({cancelled:!0}),Io(p,u);return}const d=s.target.closest(".fav-manager-item");if(d){const p=d.closest("#favManagerModal"),u=p?.querySelector(".fav-manager-item.is-selected");u&&u.classList.remove("is-selected"),u!==d?(d.classList.add("is-selected"),Ae({code:d.dataset.code,price:_(d.dataset.price)})):Ae(null),p&&(p.querySelector('[data-act="edit-selected-fav"]').disabled=!Z(),p.querySelector('[data-act="del-selected-fav"]').disabled=!Z());return}if(s.target.closest('[data-act="batch-select-type"]')){const p=s.target.closest('[data-act="batch-select-type"]'),u=document.querySelector(p.dataset.targetDisplay),f=document.getElementById("batch-select-device-type-value"),v=f?.value||"all",m=await dt(v,!0);m&&(f.value=m.type==="all"?"":m.type,u&&(u.textContent=m.displayName),p.classList.toggle("is-placeholder",m.type==="all"||!m.type),document.dispatchEvent(new CustomEvent("batch-type-filter-change",{detail:{type:m.type}})));return}if(s.target.closest('[data-act="batch-select-target-type"]')){const p=s.target.closest('[data-act="batch-select-target-type"]'),u=document.querySelector(p.dataset.targetDisplay),f=document.getElementById("batch-target-device-type-value"),v=f?.value||null,m=await dt(v,!1);m&&(f.value=m.type,u&&(u.textContent=m.displayName),p.classList.remove("is-placeholder"),f.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!1})));return}const c=s.target.closest("[data-act]");if(c){const p=c.dataset.act,u=c.closest(".item-card"),f=c.closest(".room-card"),v=["toggle-more-details","collapse-room","show-discount-modal","show-suspended-items","clear-filter","close-modal","jump-to-item","manage-favorites","show-favorites"];if(te&&!c.closest(".unlockable")&&!v.includes(p)){$("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}switch(["toggle-more-details","close-modal","collapse-room","remove-dimension-row"].includes(p)||s.preventDefault(),p!=="close-modal"&&s.stopPropagation(),p){case"show-discount-modal":ao();break;case"show-suspended-items":Oe();break;case"clear-filter":It();break;case"add-room":me();break;case"add-item":{if(!f)break;const m=document.querySelector("#itemTypeModal");if(!m)break;m.querySelector("#itemTypeModalTitle").textContent="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",m.querySelector('label[data-item-type="all"]')?.style.setProperty("display","none");let h=m.querySelector('input[name="item_type_option"][value="set"]');h&&(h.checked=!0);const w=await V("#itemTypeModal");if(!w||w.cancelled)break;if(w.multiAdd){const k=document.querySelector("#dimensionEntryModal");if(k){const x=k.querySelector("#dimensionRowsContainer");x.innerHTML="";const I=it();x.appendChild(I),I.querySelector('input[name="modal_width_m"]')?.focus();const B=await V("#dimensionEntryModal");if(B&&!B.cancelled){const D=[];if(x.querySelectorAll(".dimension-input-row").forEach(H=>{const O=H.querySelector('input[name="modal_width_m"]'),S=H.querySelector('input[name="modal_height_m"]'),g=_(O.value),A=_(S.value);g>0&&A>0&&D.push({width_m:g,height_m:A})}),D.length>0){se(G()),z();let H=null;D.forEach(O=>{const S=ho(O,f);H||(H=S)}),H&&(oe(),ee(),de(H),$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${D.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)`,"success"))}else $("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏","warning")}}break}if(w===!0){const k=m.querySelector('input[name="item_type_option"]:checked')?.value;if(!k){$("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó","warning");break}se(G()),z();const x=JSON.parse(f.dataset.roomDefaults||"{}");let I={};const B=O=>x[`enable_defaults_${O}`]===!0;switch(k){case"set":B("set")&&(I.fabric_code=x.defaults_fabric_code,I.price_per_m_raw=x.defaults_fabric_price,I.sheer_fabric_code=x.defaults_sheer_code,I.sheer_price_per_m=x.defaults_sheer_price);break;case"wallpaper":B("wallpaper")&&(I.wallpaper_code=x.defaults_wallpaper_code,I.price_per_roll=x.defaults_wallpaper_price_roll,I.install_cost_per_roll=x.defaults_wallpaper_install_cost);break;case"wooden_blind":B("wooden_blind")&&(I.code=x.defaults_wooden_blind_code,I.price_sqyd=x.defaults_wooden_blind_price_sqyd);break;case"roller_blind":B("roller_blind")&&(I.code=x.defaults_roller_blind_code,I.price_sqyd=x.defaults_roller_blind_price_sqyd);break;case"vertical_blind":B("vertical_blind")&&(I.code=x.defaults_vertical_blind_code,I.price_sqyd=x.defaults_vertical_blind_price_sqyd);break;case"partition":B("partition")&&(I.code=x.defaults_partition_code,I.price_sqyd=x.defaults_partition_price_sqyd);break;case"pleated_screen":B("pleated_screen")&&(I.code=x.defaults_pleated_screen_code,I.price_sqyd=x.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":B("aluminum_blind")&&(I.code=x.defaults_aluminum_blind_code,I.price_sqyd=x.defaults_aluminum_blind_price_sqyd);break}let D;if(k==="set")D=_e(I);else if(k==="wallpaper")D=ve(I);else if(j[k]?.templateId==="#areaBasedTpl")D=ge(k,I);else{$(`‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${k}`,"error");break}if(!D)break;const H=f.getItemsContainer();if(H){H.appendChild(D),D.classList.add("item-created"),de(D);let O=D.querySelector('input[name="width_m"], input[name="area_width_m"], input[name="wallpaper_height_m"]');O?O.focus():D.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),U(),$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${j[k]?.name||"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"} ‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡∏ô‡∏≤‡∏î)`,"success")}}break}case"add-dimension-row":{const m=document.querySelector("#dimensionRowsContainer");if(m){const h=it();m.appendChild(h),h.querySelector('input[name="modal_width_m"]')?.focus(),m.scrollTop=m.scrollHeight}break}case"remove-dimension-row":{const m=c.closest(".dimension-input-row"),h=m?.parentElement;m&&h&&h.children.length>1&&m.remove();break}case"select-item-type":if(u&&u.classList.contains("placeholder-item")){const m={width_m:parseFloat(u.dataset.widthM||0),height_m:parseFloat(u.dataset.heightM||0)};if(m.width_m>0&&m.height_m>0){const h=await gt("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");h&&yo(u,h,m)}else $("‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ô Placeholder","error")}break;case"collapse-room":f&&(f.open=!1,setTimeout(()=>{ce(),ee()},50));break;case"toggle-room-menu":c.nextElementSibling?.classList.toggle("show");break;case"open-room-defaults":f&&(lo(f),c.closest(".room-options-menu")?.classList.remove("show"));break;case"apply-room-defaults":uo();break;case"open-force-apply-modal":po();break;case"force-apply-defaults":mo();break;case"toggle-suspend-room":f&&(f.classList.toggle("is-suspended"),c.closest(".room-options-menu")?.classList.remove("show"),U(),he==="suspended"?Oe():ye());break;case"clear-room":f&&await re("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","?")&&(se(G()),z(),f.getItemsContainer().innerHTML="",oe(),U(),$("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"));break;case"del-room":f&&await re("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","?")&&je(f,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"del-item":u&&await re("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")&&je(u,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"duplicate-item":u&&vo(u);break;case"toggle-suspend":u&&(u.classList.toggle("is-suspended"),U(),he==="suspended"?Oe():ye());break;case"change-type":u&&_o(u);break;case"toggle-more-details":u&&!u.querySelector(".item-details-more")?.classList.contains("show")&&document.querySelectorAll(".item-details-more.show").forEach(m=>{m.closest(".item-card")!==u&&Ee(m.closest(".item-card"),!1)}),Ee(u);break;case"open-hardware-modal":qo(u),be()&&no();break;case"apply-hardware-to-room":{const m=c.closest("#hardwareModal"),h=be()?.closest(y.room);if(!m||!h||!be())break;const w=be().querySelector('[name="set_style"]');if(w?.value==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||w?.value==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){$("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå‡πÑ‡∏î‡πâ","warning");break}const k=m.querySelector('[name="modal_track_color"]').value,x=m.querySelector('[name="modal_bracket_color"]').value,I=m.querySelector('[name="modal_finial_color"]').value,B=m.querySelector('[name="modal_grommet_color"]').value;h.querySelectorAll('.set-item:not(:has(select[name="set_style"][value="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"])):not(:has(select[name="set_style"][value="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"]))').forEach(D=>{D.querySelector('[name="track_color"]').value=k,D.querySelector('[name="bracket_color"]').value=x,D.querySelector('select[name="set_style"]')?.value==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"&&(D.querySelector('[name="finial_color"]').value=I,D.querySelector('[name="grommet_color"]').value=B)}),ee(),$("‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success");break}case"add-wall":{const m=c.closest(".walls-section")?.querySelector("[data-walls-container]");if(m){const h=Ge();h&&(m.appendChild(h),h.querySelector("input")?.focus(),U())}break}case"del-wall":{const m=c.closest(".wall-input-row");m&&await re("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","?")&&je(m,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break}case"show-favorites":{const m=c.previousElementSibling?.matches("input[data-favorite-type]")?c.previousElementSibling:c.closest(".form-group-with-favorites")?.querySelector("input[data-favorite-type]");m?wo(m):console.warn("Could not find associated input for show-favorites button:",c);break}case"add-new-fav-form":{const h=c.closest("#favManagerModal")?.dataset.currentType;if(!h)break;const w=document.querySelector("#favAddModal");if(!w)break;let k=j[h]?.name||h;h==="fabric"?k="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":h==="sheer"&&(k="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),w.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${k}'`;const x=w.querySelector('[name="fav_code_add"]'),I=w.querySelector('[name="fav_price_add"]');x.value="",I.value="";const B=await V("#favAddModal");if(B&&!B.cancelled){const D=x.value.trim(),H=_(I.value);D&&H>=0?at(h,D,H)?(Be(!0),Le(h),$("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß","success")):$("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"):$(D?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"edit-selected-fav":{if(!Z())break;const h=c.closest("#favManagerModal")?.dataset.currentType;if(!h)break;const w=document.querySelector("#favEditModal");if(!w)break;w.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${Z().code}'`;const k=w.querySelector('[name="fav_code_edit"]'),x=w.querySelector('[name="fav_price_edit"]');k.value=Z().code,x.value=Z().price!==null&&Z().price>=0?Z().price:"";const I=await V("#favEditModal");if(I&&!I.cancelled){const B=k.value.trim(),D=_(x.value);B&&D>=0?(B!==Z().code&&nt(h,Z().code),at(h,B,D),Be(!0),Le(h),$("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")):$(B?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"del-selected-fav":{if(!Z())break;const h=c.closest("#favManagerModal")?.dataset.currentType;if(!h)break;await re("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`"${Z().code}"?`)&&(nt(h,Z().code)?(Be(!0),Le(h),$("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success")):$("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"));break}case"manage-favorites-from-defaults":await bo();break;case"jump-to-item":go(c);break}}else{const p=s.target.closest("summary");p&&p.closest("details.card")&&setTimeout(()=>{ce(),ee()},50)}}),document.querySelector("#undoBtn")?.addEventListener("click",s=>{s.preventDefault(),Mo()}),document.querySelector(y.lockBtn)?.addEventListener("click",s=>{s.preventDefault(),Lo()}),document.querySelector(y.toggleAllRoomsBtn)?.addEventListener("click",s=>{s.preventDefault(),Bo()}),t&&a){t.addEventListener("click",i=>{i.stopPropagation(),o?.classList.remove("show");const d=!a.classList.contains("show");a.classList.toggle("show",d),t.setAttribute("aria-expanded",d),d&&r?.setAttribute("aria-expanded","false")}),document.querySelector(y.quickNavRoomList)?.addEventListener("click",i=>{const d=i.target.closest("a[data-jump-to]");if(d){i.preventDefault();const c=d.dataset.jumpTo,p=document.getElementById(c);p&&(p.open=!0,p.scrollIntoView({behavior:"smooth",block:"center"}),p.classList.add("scrolling-jump"),setTimeout(()=>p.classList.remove("scrolling-jump"),2500),setTimeout(ce,100)),a.classList.remove("show"),t.setAttribute("aria-expanded","false")}});const s=document.querySelector("#addRoomQuickNavBtn");if(s){const i=Nt(me,700);s.addEventListener("click",d=>{d.stopPropagation(),i(),a.classList.remove("show"),t.setAttribute("aria-expanded","false")})}}r&&o&&r.addEventListener("click",s=>{s.stopPropagation(),a?.classList.remove("show");const i=!o.classList.contains("show");o.classList.toggle("show",i),r.setAttribute("aria-expanded",i),i&&t?.setAttribute("aria-expanded","false")}),document.querySelector("#themeToggleBtn")?.addEventListener("click",s=>{s.preventDefault(),To(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false")}),document.querySelector("#overviewBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const i=G(),d=document.querySelector("#overviewModalHeader"),c=document.querySelector("#overviewModalBody");if(d&&c){const p=i.rooms.reduce((v,m)=>v+(m.is_suspended?0:(m.items||[]).filter(h=>!h.is_placeholder&&!h.is_suspended&&(W.calculateSetPrice(h)?.total>0||W.calculateWallpaperPrice(h)?.total>0||W.calculateAreaBasedPrice(h)?.total>0)).length),0),u=document.querySelector(y.grandTotal)?.textContent||"0",f=i.rooms.filter(v=>!v.is_suspended&&v.items?.some(m=>!m.is_suspended)).length;d.innerHTML=`<div class="overview-stats-grid"><div class="overview-stat-card"><i class="ph-bold ph-map-pin-line"></i><div class="stat-value">${f}</div><div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div></div><div class="overview-stat-card"><i class="ph-bold ph-stack"></i><div class="stat-value">${p}</div><div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div><div class="overview-stat-card"><i class="ph-bold ph-coins"></i><div class="stat-value">${u}</div><div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div></div></div>`,c.innerHTML=zt(i),V("#overviewModal")}}),document.querySelector("#copyTextBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const i=document.querySelector(y.copyOptionsModal);if(!i)return;i.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const d=await V(y.copyOptionsModal);if(d&&!d.cancelled){const c=i.querySelector('input[name="copy_option"]:checked').value,p=Xt(G(),c);try{await navigator.clipboard.writeText(p),$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{$("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector("#visualReportsBtn")?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const i=document.querySelector("#visualReportsModal");if(!i)return;i.querySelector('input[name="report_type_option"][value="lookbook"]').checked=!0;const d=await V("#visualReportsModal");if(d&&!d.cancelled){const c=i.querySelector('input[name="report_type_option"]:checked').value;if(c==="lookbook"){const p=G(),u=eo(p),f=document.querySelector("#lookbookModalBody");u&&f?(f.innerHTML=u,V("#lookbookModal")):$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","warning")}else $(`'${c}' ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°`,"default")}}),document.querySelector(y.exportPdfBtn)?.addEventListener("click",async s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const i=await to();if(!i)return;const d=G(),c=Zt(d,{vatRate:i.vatOption==="include"?X.baseVatRate:0,pageBreakBuffer:i.pageBreakBuffer,showDetails:i.showDetails});if(!c){$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}i.exportMethod==="html"?Ao(c):Eo(c.html,i.exportMethod)}),document.querySelector(y.submitBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await re("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","?")){const i=G();if(!i.customer_name&&!i.customer_phone){$("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå","warning");return}$("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...","default");try{const d=await fetch(Et,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});d.ok?$("‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß!","success"):$(`‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${d.status}`,"error")}catch{$("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","error")}}}),document.querySelector(y.importBtn)?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),n?.click()}),n?.addEventListener("change",s=>{const i=s.target.files?.[0];if(!i)return;const d=new FileReader;d.onload=async c=>{try{const p=JSON.parse(c.target.result);if(p&&typeof p=="object")await Ze(p,!0);else throw new Error("Invalid JSON")}catch(p){$("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error"),console.error(p)}},d.readAsText(i),s.target.value=null}),document.querySelector(y.exportBtn)?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");try{const i=G(),d=JSON.stringify(i,null,4),c=new Blob([d],{type:"application/json"}),p=URL.createObjectURL(c),u=document.createElement("a"),f=new Date,v=`${f.getFullYear()}${(f.getMonth()+1).toString().padStart(2,"0")}${f.getDate().toString().padStart(2,"0")}`,m=`${f.getHours().toString().padStart(2,"0")}${f.getMinutes().toString().padStart(2,"0")}`,h=ht(i.customer_name||"data");u.href=p,u.download=`MTR-${v}${m}-${h}.json`,u.click(),URL.revokeObjectURL(p),$("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{$("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector("#importFavsBtn")?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),l?.click()}),l?.addEventListener("change",s=>{const i=s.target.files?.[0];if(!i)return;const d=new FileReader;d.onload=c=>{try{const p=JSON.parse(c.target.result),u=Ve(p);u>0?$(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${u} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,"success"):$("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà","default")}catch{$("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error")}},d.readAsText(i),s.target.value=null}),document.querySelector("#exportFavsBtn")?.addEventListener("click",s=>{s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");try{const i=ue();if(Object.values(i).every(v=>v.length===0)){$("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}const d=JSON.stringify(i,null,4),c=new Blob([d],{type:"application/json"}),p=URL.createObjectURL(c),u=document.createElement("a"),f=new Date().toISOString().slice(0,10).replace(/-/g,"");u.href=p,u.download=`MTR-Favorites-${f}.json`,u.click(),URL.revokeObjectURL(p),$("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{$("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(y.clearItemsBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await re("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")){se(G()),z(),document.querySelectorAll(y.room).forEach(c=>{c.getItemsContainer().innerHTML=""});const i=document.querySelector("#discount_type"),d=document.querySelector("#discount_value");i&&(i.value="amount"),d&&(d.value="0"),oe(),U(),$("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")}}),document.querySelector(y.clearAllBtn)?.addEventListener("click",async s=>{if(s.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await re("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){const i=document.querySelector(y.roomsContainer);i&&(i.innerHTML=""),localStorage.removeItem(Se),Ft(),$("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î...","success"),setTimeout(()=>window.location.reload(),500)}}),document.querySelector("#roomDefaultsConfirmBtn")?.addEventListener("click",co),window.addEventListener("click",s=>{s.target.closest(".menu-container")||(o?.classList.remove("show"),a?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),t?.setAttribute("aria-expanded","false")),s.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show"));const i=s.target.closest(".item-card");document.querySelectorAll(".item-details-more.show").forEach(d=>{const c=d.closest(".item-card");c!==i&&Ee(c,!1)})}),window.addEventListener("beforeunload",ee),document.querySelector("#forceApplySelectTypeBtn")?.addEventListener("click",async s=>{if(s.preventDefault(),te){$("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}const i=document.querySelector("#forceApplyTypeModal");if(!i)return;const d=document.querySelector('#forceApplyModal [name="force_apply_type_hidden"]')?.value;let c=i.querySelector(`input[name="force_apply_type_option"][value="${d}"]`);c||(c=i.querySelector('input[name="force_apply_type_option"]')),c&&(c.checked=!0);const p=await V("#forceApplyTypeModal");if(p&&!p.cancelled){const u=i.querySelector('input[name="force_apply_type_option"]:checked');if(u){const f=u.value,v=document.querySelector("#forceApplyModal"),m=v?.querySelector('[name="force_apply_type_hidden"]'),h=v?.querySelector("#forceApplySelectedTypeDisplay"),w=v?.querySelector('[name="force_apply_code"]'),k=w?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs"),x=u.closest("label")?.querySelector("strong"),I=x?x.textContent.trim():f;m&&(m.value=f),h&&(h.textContent=I),w&&(w.dataset.favoriteType=f,w.focus()),k&&(k.disabled=!1)}}})}}function Do(){const e=document.querySelector(y.setTpl);if(!e)return;const n=e.content.querySelector(y.setPricePerMSelect),l=e.content.querySelector(y.setSheerPricePerMSelect),o=e.content.querySelector(y.setLouisPricePerMSelect),a=r=>{let t='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(r)?(r.forEach(s=>{t+=`<option value="${s}">${s.toLocaleString("th-TH")}</option>`}),t):(console.error("Price data for dropdown is not available or not an array.",r),t)};n&&(n.innerHTML=a(Ce.fabric)),l&&(l.innerHTML=a(Ce.sheer)),o&&(o.innerHTML=a(Ce.louis))}function No(){Do(),Mt(),Po();try{const e=localStorage.getItem(Se);if(e&&e!=="null"&&e!=="{}"){const n=JSON.parse(e);if(n&&Array.isArray(n.rooms))Ze(n,!1);else{console.warn("Stored data structure seems invalid, starting fresh."),localStorage.removeItem(Se),me();const l=document.querySelector(y.customerCard);l&&(l.open=!0)}}else{me();const n=document.querySelector(y.customerCard);n&&(n.open=!0)}}catch(e){console.error("Failed to load or parse data from localStorage:",e),localStorage.removeItem(Se),me();const n=document.querySelector(y.customerCard);n&&(n.open=!0)}U(),Ct(),ce(),$e(),z(),console.log("Marnthara App Initialized (Vite Refactor)")}document.addEventListener("DOMContentLoaded",No);
